# ç¬¬235ç« ï¼šã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ (æ¤œè¨¼)

ã“ã®ç« ã‚’çµ‚ãˆã‚‹ã¨â€¦ğŸ‘‡

* Playwrightã®`expect`ã§ã€Œç”»é¢ã®çŠ¶æ…‹ãƒã‚§ãƒƒã‚¯ã€ãŒæ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚‹ğŸ˜Š
* ä¸å®‰å®šã«ãªã‚ŠãŒã¡ãªãƒ†ã‚¹ãƒˆã‚’ã€**å®‰å®šï¼ˆãƒ•ãƒ¬ãƒ¼ã‚¯ã—ã«ãã„ï¼‰**ã«ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ğŸ’ª
* ã‚ˆãä½¿ã†ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä¸€é€šã‚Šä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚‹ğŸ§¡

Playwrightã®ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€ãŸã ã®ã€Œåˆ¤å®šã€ã˜ã‚ƒãªãã¦ã€**æ¡ä»¶ãŒæº€ãŸã•ã‚Œã‚‹ã¾ã§å¾…ã£ã¦ãã‚Œã‚‹ï¼ˆãƒªãƒˆãƒ©ã‚¤ã—ã¦ãã‚Œã‚‹ï¼‰**ã®ãŒè¶…ã¤ã‚ˆãƒã‚¤ãƒ³ãƒˆã§ã™ğŸ”¥ ([Playwright][1])

---

## 1) ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã£ã¦ãªã«ï¼ŸğŸ§ğŸ’¡

E2Eãƒ†ã‚¹ãƒˆã£ã¦åŸºæœ¬ã“ã‚“ãªæµã‚ŒğŸ‘‡

```mermaid
flowchart TD
  A[Arrange: æº–å‚™ğŸ§°] --> B[Act: æ“ä½œğŸ–±ï¸]
  B --> C[Assert: æ¤œè¨¼âœ…]
  C --> D[æ¬¡ã®æ“ä½œã¸â¡ï¸]
```

* **Actï¼ˆæ“ä½œï¼‰**ï¼šã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã€å…¥åŠ›ã™ã‚‹ã€ãƒšãƒ¼ã‚¸ç§»å‹•ã™ã‚‹ã€ãªã©
* **Assertï¼ˆæ¤œè¨¼ï¼‰**ï¼š

  * ã€Œè¦‹å‡ºã—ãŒè¡¨ç¤ºã•ã‚Œã¦ã‚‹ã¯ãšï¼ã€
  * ã€Œä¿å­˜ãƒœã‚¿ãƒ³ãŒç„¡åŠ¹ã«ãªã£ã¦ã‚‹ã¯ãšï¼ã€
  * ã€Œã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºã¦ãªã„ã¯ãšï¼ã€
    ã¿ãŸã„ã« **æœŸå¾…ã™ã‚‹çŠ¶æ…‹** ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ğŸ˜Š

---

## 2) Playwrightã®`expect`ã¯2ç¨®é¡ã‚ã‚‹ã‚ˆâœ¨ï¼ˆã“ã“è¶…å¤§äº‹ï¼ï¼‰

### âœ… A. Web-firstï¼ˆè‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ï¼‰ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãŠã™ã™ã‚ï¼‰ğŸŒˆ

ãŸã¨ãˆã°ã“ã‚ŒğŸ‘‡ï¼ˆ**ã“ã‚ŒãŒç‹é“**ï¼‰

```ts
import { test, expect } from '@playwright/test';

test('é€ä¿¡å¾Œã«ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒå‡ºã‚‹', async ({ page }) => {
  await page.goto('http://localhost:5173');

  await page.getByRole('button', { name: 'é€ä¿¡' }).click();

  // âœ… å‡ºã‚‹ã¾ã§å¾…ã£ã¦ãã‚Œã‚‹ï¼ˆæœ€å¤§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã¾ã§ãƒªãƒˆãƒ©ã‚¤ï¼‰
  await expect(page.getByTestId('status')).toHaveText('Submitted');
});
```

ã“ã‚Œã€PlaywrightãŒã€Œã¾ã è¡¨ç¤ºã•ã‚Œã¦ãªã„ã‹ã‚‚ã€ã‚’è€ƒæ…®ã—ã¦ã€**å–ã‚Šç›´ã—ã¦ä½•åº¦ã‚‚ãƒã‚§ãƒƒã‚¯**ã—ã¦ãã‚Œã¾ã™âœ¨ ([Playwright][1])

---

### âš ï¸ B. Non-retryingï¼ˆå¾…ãŸãªã„ï¼‰ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆä¸å®‰å®šã«ãªã‚ŠãŒã¡ï¼‰ğŸ˜µ

ã‚ã‚ŠãŒã¡ãªãƒ€ãƒ¡ä¾‹ğŸ‘‡ï¼ˆå‹•ãã‘ã©ã€ãƒ•ãƒ¬ãƒ¼ã‚¯ã®åŸå› ï¼ï¼‰

```ts
// âŒ ä»Šã“ã®ç¬é–“ã ã‘è¦‹ã¦çµ‚ã‚ã‚Šï¼ˆå¾…ãŸãªã„ï¼‰
expect(await page.getByText('welcome').isVisible()).toBe(true);
```

Playwrightå…¬å¼ã§ã‚‚ã€Œã“ã†ã„ã†æ‰‹å‹•ãƒã‚§ãƒƒã‚¯ã¯é¿ã‘ã¦ã­ã€ã£ã¦è¨€ã£ã¦ã¾ã™âš ï¸
ä»£ã‚ã‚Šã«ğŸ‘‡

```ts
// âœ… Web-firstã§å¾…ã£ã¦ãã‚Œã‚‹
await expect(page.getByText('welcome')).toBeVisible();
```

ã“ã‚ŒãŒå®‰å®šã®ã‚³ãƒ„ã§ã™ğŸ§¡ ([Playwright][2])

---

## 3) ã‚ˆãä½¿ã†ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆã¾ãšã¯ã“ã‚Œã ã‘ã§OKï¼‰ğŸ’âœ¨

### ğŸ‘€ è¡¨ç¤ºç³»

* `toBeVisible()`ï¼šè¦‹ãˆã¦ã‚‹ï¼Ÿ
* `toBeHidden()`ï¼šè¦‹ãˆã¦ãªã„ï¼Ÿ
* `toBeInViewport()`ï¼šç”»é¢å†…ã«å…¥ã£ã¦ã‚‹ï¼Ÿ

([Playwright][1])

### ğŸ“ ãƒ†ã‚­ã‚¹ãƒˆç³»

* `toHaveText('å®Œå…¨ä¸€è‡´')`
* `toContainText('éƒ¨åˆ†ä¸€è‡´')`

([Playwright][1])

### ğŸ”¢ å€‹æ•°ï¼ˆãƒªã‚¹ãƒˆã§è¶…ä½¿ã†ï¼‰

* `toHaveCount(3)`

([Playwright][1])

### âŒ¨ï¸ ãƒ•ã‚©ãƒ¼ãƒ ç³»

* `toHaveValue('å…¥åŠ›å€¤')`
* `toBeChecked()`ï¼ˆãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ï¼‰
* `toBeEnabled()` / `toBeDisabled()`ï¼ˆãƒœã‚¿ãƒ³æœ‰åŠ¹/ç„¡åŠ¹ï¼‰

([Playwright][1])

### ğŸŒ ãƒšãƒ¼ã‚¸å…¨ä½“

* `await expect(page).toHaveURL(/\/login/)`
* `await expect(page).toHaveTitle('ã‚¿ã‚¤ãƒˆãƒ«')`

([Playwright][1])

---

## 4) ã€Œå¾…ã£ã¦ãã‚Œã‚‹ã€ã£ã¦ã©ã†ã„ã†ã“ã¨ï¼Ÿâ³âœ¨ï¼ˆã‚¤ãƒ¡ãƒ¼ã‚¸ï¼‰

![ãƒ—ãƒ¬ã‚¤ãƒ©ã‚¤ãƒˆã®ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ãƒªãƒˆãƒ©ã‚¤æ©Ÿæ§‹](./picture/react_study_235_assertions.png)

```mermaid
flowchart TD
  S["await expect(locator).toBeVisible()"] --> Q{"æ¡ä»¶OK?ğŸ¤”"}
  Q -- ã¯ã„ğŸ‰ --> OK[æˆåŠŸâœ…]
  Q -- ã„ã„ãˆğŸ˜µ --> W[å°‘ã—å¾…ã¤ï¼†å–ã‚Šç›´ã™ğŸ”]
  W --> T{ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ãŸ?â°}
  T -- ã¾ã  --> Q
  T -- ã—ãŸ --> NG[å¤±æ•—âŒ ã„ã„æ„Ÿã˜ã«ãƒ­ã‚°å‡ºã‚‹]
```

ã ã‹ã‚‰ã€**`sleep`ã¿ãŸã„ãªå¾…ã¡**ã‚’è‡ªåˆ†ã§æ›¸ã‹ãªãã¦ã‚ˆããªã‚‹ã‚“ã ã‚ˆã­ğŸ˜Š
ï¼ˆå¾…ã¡ã‚’æ‰‹å‹•ã§æ›¸ãã»ã©ã€ãƒ†ã‚¹ãƒˆã¯å£Šã‚Œã‚„ã™ããªã‚‹â€¦ï¼ï¼‰ ([Playwright][2])

---

## 5) ä¾¿åˆ©ãƒ¯ã‚¶3ã¤âœ¨ï¼ˆãƒ†ã‚¹ãƒˆãŒèª­ã¿ã‚„ã™ããªã‚‹ï¼ï¼‰

### â‘  å¤±æ•—æ™‚ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä»˜ã‘ã‚‹ğŸ“

ãƒ¬ãƒãƒ¼ãƒˆãŒèª­ã¿ã‚„ã™ããªã‚‹ã‚ˆã€œï¼

```ts
await expect(
  page.getByText('ã‚ˆã†ã“ã'),
  'ãƒ­ã‚°ã‚¤ãƒ³å¾Œã¯ã€Œã‚ˆã†ã“ãã€ãŒè¦‹ãˆã‚‹ã¯ãšï¼'
).toBeVisible();
```

å…¬å¼ã®æ©Ÿèƒ½ã§ã™âœ¨ ([Playwright][1])

---

### â‘¡ `expect.soft`ï¼ˆã¾ã¨ã‚ã¦å¤±æ•—ã‚’è¦‹ãŸã„ï¼‰ğŸ§¸

ã€Œ1å€‹å¤±æ•—ã—ãŸã‚‰å³çµ‚äº†ã€ã ã¨ã€ç›´ã™â†’æ¬¡ã§ã¾ãŸå¤±æ•—â†’â€¦ã§ã¤ã‚‰ã„æ™‚ã‚ã‚‹ã‚ˆã­ğŸ¥²
ãã‚“ãªã¨ãã¯ã‚½ãƒ•ãƒˆã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ï¼

```ts
await expect.soft(page.getByTestId('name')).toBeVisible();
await expect.soft(page.getByTestId('email')).toBeVisible();
await expect.soft(page.getByTestId('submit')).toBeDisabled();
```

æœ€å¾Œã«ã¾ã¨ã‚ã¦å¤±æ•—ãŒå‡ºã¾ã™âœ¨ ([Playwright][1])

---

### â‘¢ `expect.poll`ï¼ˆã¡ã‚‡ã„ç‰¹æ®Šãªå¾…ã¡ï¼‰ğŸ“¡

ã€ŒAPIãŒ200ã«ãªã‚‹ã¾ã§å¾…ã¡ãŸã„ã€ã¿ãŸã„ãªæ™‚ã«ä¾¿åˆ©ï¼

```ts
await expect.poll(async () => {
  const res = await page.request.get('https://api.example.com');
  return res.status();
}, {
  message: 'APIãŒæœ€çµ‚çš„ã«200ã«ãªã‚‹ã¯ãšï¼',
  timeout: 10_000,
}).toBe(200);
```

å…¬å¼ã®æ›¸ãæ–¹ã ã‚ˆâœ¨ ([Playwright][1])

---

## 6) ãƒãƒ³ã‚ºã‚ªãƒ³ğŸ®ï¼šTODOã‚¢ãƒ—ãƒªã«â€œæœ€ä½é™ã®æ¤œè¨¼â€ã‚’å…¥ã‚Œã¦ã¿ã‚ˆã†ï¼

ä¾‹ã¨ã—ã¦ã€`tests/todo.spec.ts` ã«ã“ã‚“ãªã®ã‚’æ›¸ã„ã¦ã¿ã¦ã­ğŸ˜Š
ï¼ˆURLã‚„æ–‡è¨€ã¯è‡ªåˆ†ã®ã‚¢ãƒ—ãƒªã«åˆã‚ã›ã¦OKğŸ‘Œï¼‰

```ts
import { test, expect } from '@playwright/test';

test('TODOã®åŸºæœ¬å‹•ä½œã‚’æ¤œè¨¼ã™ã‚‹âœ…', async ({ page }) => {
  await page.goto('http://localhost:5173');

  // 1) ã‚¿ã‚¤ãƒˆãƒ«ãŒè¦‹ãˆã‚‹
  await expect(page.getByRole('heading', { name: /todo/i })).toBeVisible();

  // 2) å…¥åŠ›æ¬„ãŒä½¿ãˆã‚‹
  const input = page.getByRole('textbox', { name: /todo/i });
  await expect(input).toBeEditable();

  // 3) è¿½åŠ ãƒœã‚¿ãƒ³ãŒã‚ã‚‹
  const addButton = page.getByRole('button', { name: /è¿½åŠ /i });
  await expect(addButton).toBeEnabled();

  // 4) å…¥åŠ›ã—ã¦è¿½åŠ 
  await input.fill('ç‰›ä¹³ã‚’è²·ã†ğŸ¼');
  await addButton.click();

  // 5) è¿½åŠ ã•ã‚ŒãŸé …ç›®ãŒè¦‹ãˆã‚‹ï¼ˆéƒ¨åˆ†ä¸€è‡´ã§OKï¼‰
  const item = page.getByRole('listitem').filter({ hasText: 'ç‰›ä¹³ã‚’è²·ã†' });
  await expect(item).toBeVisible();

  // 6) ãƒªã‚¹ãƒˆã®æ•°ãŒ1ä»¥ä¸Šï¼ˆæœ€ä½é™ã®å®‰å¿ƒï¼‰
  await expect(page.getByRole('listitem')).toHaveCount(1);
});
```

ãƒã‚¤ãƒ³ãƒˆã¯ğŸ‘‡

* **`await expect(locator)...`ã‚’ä½¿ã†**ï¼ˆå¾…ã£ã¦ãã‚Œã‚‹ï¼‰
* ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã‚‹ã‚‚ã®ã€ã‚’æ¤œè¨¼ã™ã‚‹ï¼ˆDOMã®ç´°ã‹ã„æ§‹é€ ã«ä¾å­˜ã—ãªã„ï¼‰ ([Playwright][2])

---

## 7) ã‚ˆãã‚ã‚‹è½ã¨ã—ç©´ğŸ˜‡ğŸ’£

### âŒ `isVisible()`ã§ãƒã‚§ãƒƒã‚¯ã—ã¡ã‚ƒã†

å¾…ãŸãªã„ã®ã§ä¸å®‰å®šã«ãªã‚ŠãŒã¡ï¼
â†’ **`await expect(locator).toBeVisible()`**ã«ã—ã‚ˆã†âœ¨ ([Playwright][2])

### âŒ ãªã‚“ã§ã‚‚`toHaveText()`ã§ã‚¬ãƒã‚¬ãƒã«å›ºå®š

æ–‡è¨€ãŒå°‘ã—å¤‰ã‚ã‚‹ã ã‘ã§å£Šã‚Œã‚‹ğŸ¥²
â†’ ã€Œéƒ¨åˆ†ä¸€è‡´ã§OKãªã¨ãã¯`toContainText()`ã€ãŒã‚„ã•ã—ã„ğŸ’•

### âŒ ã‚„ãŸã‚‰ã¨`waitForTimeout(1000)`ã™ã‚‹

ã€ŒãŸã¾ãŸã¾å‹•ãã€ãƒ†ã‚¹ãƒˆã«ãªã‚Šã‚„ã™ã„ğŸ˜µ
â†’ Web-firstã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã§è§£æ±ºã—ãŒã¡âœ¨ ([Playwright][1])

---

## ã¾ã¨ã‚ğŸ‰

* Playwrightã¯**å¾…ã£ã¦ãã‚Œã‚‹ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆWeb-firstï¼‰**ãŒå¼·ã„ï¼ ([Playwright][1])
* åŸºæœ¬ã¯ **`await expect(locator).toBeVisible()`** ã‹ã‚‰ã§OKğŸ˜Š
* ä¾¿åˆ©ãƒ¯ã‚¶ï¼š`expect.soft` / ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä»˜ãexpect / `expect.poll` âœ¨ ([Playwright][1])

---

## æ¬¡ç« ãƒãƒ©è¦‹ã›ğŸ‘€âœ¨ï¼ˆç¬¬236ç« ï¼‰

å¤±æ•—ã—ãŸã¨ãã«ã€Œä½•ãŒèµ·ããŸã®ï¼Ÿã€ã‚’æ™‚ç©ºç§»å‹•ã—ã¦è¦‹ã‚Œã‚‹ **Trace Viewer** ã«è¡Œãã‚ˆã€œï¼ğŸ•µï¸â€â™€ï¸ğŸŒ€

[1]: https://playwright.dev/docs/test-assertions "Assertions | Playwright"
[2]: https://playwright.dev/docs/best-practices "Best Practices | Playwright"
