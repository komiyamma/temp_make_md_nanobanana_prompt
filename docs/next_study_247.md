# ç¬¬247ç« ï¼šå®‰å…¨ãªã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆæ‰‹é †ã¨ codemod ğŸ¤–

ã“ã®ç« ã¯ã€ŒNext.jsã®æ›´æ–°ãŒæ€–ããªããªã‚‹ã€ãŸã‚ã®ã€**å®‰å…¨ãªæ‰‹é †ï¼ˆå‹ï¼‰**ã¨ã€**è‡ªå‹•ã§ç›´ã—ã¦ãã‚Œã‚‹ codemod ã®ä½¿ã„æ–¹**ã‚’è¦šãˆã‚‹å›ã ã‚ˆã€œï¼ğŸ§¸ğŸ’»âœ¨
â€»Next.jsã¯é »ç¹ã«æ›´æ–°ï¼†ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æƒ…å ±ã‚‚å‡ºã‚‹ã®ã§ã€**å®‰å…¨ã«ç´ æ—©ãæ›´æ–°ã§ãã‚‹åŠ›**ãŒã‚ã¡ã‚ƒå¤§äº‹ã ã‚ˆğŸ›¡ï¸ğŸ”¥ ([Next.js][1])

---

## 1) ã¾ãšçŸ¥ã‚ã†ï¼šcodemodã£ã¦ä½•ï¼ŸğŸ¤–ğŸ§¹

![next_study_247_codemod_robot.png](./picture/next_study_247_codemod_robot.png)


**codemod = ã‚³ãƒ¼ãƒ‰ã‚’è‡ªå‹•ã§æ›¸ãæ›ãˆã‚‹ãŠæƒé™¤ãƒ­ãƒœ**ã ã‚ˆâœ¨
Next.jsã®å…¬å¼codemodã¯ã€ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ™‚ã«ã‚ã‚ŠãŒã¡ãªã€Œè¨­å®šã®ç§»è¡Œã€ã€Œå»ƒæ­¢APIã®ç½®ãæ›ãˆã€ãªã©ã‚’æ‰‹ä¼ã£ã¦ãã‚Œã‚‹ã‚ˆğŸ§©

ä¾‹ï¼š`ImageResponse` ã® import ã‚’è‡ªå‹•ã§ç›´ã™codemodï¼ˆ`next-og-import`ï¼‰ã¿ãŸã„ãªã‚„ã¤ãŒã‚ã‚‹ã‚ˆğŸ“¸
`next/server` â†’ `next/og` ã«å¤‰æ›ã—ã¦ãã‚Œã‚‹æ„Ÿã˜ï¼ ([Next.js][2])

---

## 2) â€œå®‰å…¨ã«æ›´æ–°ã™ã‚‹å‹â€ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ âœ…ğŸ§Š

![next_study_247_upgrade_checklist.png](./picture/next_study_247_upgrade_checklist.png)


æ›´æ–°ã£ã¦ã€å®Ÿã¯ã€Œä½œæ¥­ã€ã‚ˆã‚Šã€Œé †ç•ªã€ãŒå‘½ã ã‚ˆã€œï¼ğŸ”âœ¨
ï¼ˆã“ã®é †ç•ªã«ã™ã‚‹ã¨ã€å¤±æ•—ã—ã¦ã‚‚æˆ»ã‚Œã‚‹ğŸ’ªï¼‰

### âœ… å®‰å…¨ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆæ‰‹é †ï¼ˆãŠã™ã™ã‚ãƒ†ãƒ³ãƒ—ãƒ¬ï¼‰

1. **ä½œæ¥­ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œã‚‹**ğŸŒ¿ï¼ˆæˆ»ã‚Œã‚‹ã‚ˆã†ã«ï¼‰
2. **ã„ã¾ã®çŠ¶æ…‹ã‚’å›ºå®š**ğŸ“Œï¼ˆ`npm install`æ¸ˆã¿ï¼†lockfileã‚³ãƒŸãƒƒãƒˆï¼‰
3. **æ›´æ–°ã®æ–¹æ³•ã‚’é¸ã¶**ï¼ˆ`next upgrade` ã‹ `codemod upgrade`ï¼‰ğŸ¤–
4. **codemodã‚’å®Ÿè¡Œ**ï¼ˆå¿…è¦ãªã‚‰ï¼‰ğŸ§¹
5. **lint / test / build ã‚’é€šã™**ğŸ§ªğŸ—ï¸
6. **å·®åˆ†ã‚’èª­ã‚€**ğŸ‘€ï¼ˆè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãƒ»middlewareå‘¨ã‚Šã¯è¦ãƒã‚§ãƒƒã‚¯ï¼‰
7. **å‹•ä½œç¢ºèª**ï¼ˆä¸»è¦ç”»é¢ã ã‘ã§OKï¼‰ğŸ§­
8. **ã‚³ãƒŸãƒƒãƒˆã—ã¦PR**ğŸ€ï¼ˆãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒæœ€å¼·ã®ä¿é™ºï¼‰

---

## 3) å›³è§£ï¼šå®‰å…¨ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã®æµã‚Œ ğŸ—ºï¸âœ¨ï¼ˆMermaidï¼‰

![next_study_247_upgrade_flow.png](./picture/next_study_247_upgrade_flow.png)


```mermaid
flowchart TD
  A["mainãƒ–ãƒ©ãƒ³ãƒ"] --> B["æ›´æ–°ç”¨ãƒ–ãƒ©ãƒ³ãƒä½œæˆ"]
  B --> C["lockfileå«ã‚ã¦ç¾çŠ¶ã‚³ãƒŸãƒƒãƒˆ"]
  C --> D{"æ›´æ–°æ–¹æ³•ã‚’é¸ã¶"}
  D -->|"Next 16+"| E["next upgrade å®Ÿè¡Œ"]
  D -->|"Next 15ä»¥å‰"| F["npx @next/codemod upgrade å®Ÿè¡Œ"]
  E --> G["codemod/è‡ªå‹•ç§»è¡ŒãŒèµ°ã‚‹å ´åˆã‚ã‚Š"]
  F --> G
  G --> H["lint/test/build"]
  H --> I{"OKï¼Ÿ"}
  I -->|"Yes"| J["å·®åˆ†ãƒ¬ãƒ“ãƒ¥ãƒ¼â†’PR"]
  I -->|"No"| K["ã‚¨ãƒ©ãƒ¼ä¿®æ­£â†’å†å®Ÿè¡Œ"]
  K --> H
```

![Codemod ã«ã‚ˆã‚‹è‡ªå‹•ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ”¯æ´](./picture/next_study_247_codemod.png)

---

## 4) å®Ÿéš›ã®ã‚³ãƒãƒ³ãƒ‰ï¼ˆWindowsã§OKï¼‰ğŸªŸâœ¨

![next_study_247_upgrade_command.png](./picture/next_study_247_upgrade_command.png)


### A. ã¾ãšã€Œè‡ªåˆ†ã®Next.jsã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€ã‚’è¦‹ã‚‹ğŸ‘€

* `package.json` ã® `dependencies` ã« `next` ãŒæ›¸ã„ã¦ã‚ã‚‹ã‹ã‚‰ç¢ºèªã—ã¦ã­ğŸ“¦

---

### B. Next.js ã‚’ â€œæœ€æ–°â€ ã«ä¸Šã’ã‚‹æ–¹æ³•ï¼ˆ2ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰â¬†ï¸

#### âœ… ãƒ‘ã‚¿ãƒ¼ãƒ³1ï¼š`next upgrade`ï¼ˆä½¿ãˆã‚‹ãªã‚‰ã“ã‚ŒãŒãƒ©ã‚¯ï¼‰âœ¨

Next.jsã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€æœ€æ–°ã¸ä¸Šã’ã‚‹æ–¹æ³•ã¨ã—ã¦ `next upgrade` ãŒæ¡ˆå†…ã•ã‚Œã¦ã‚‹ã‚ˆğŸ§¸ ([Next.js][3])

```bash
next upgrade
```

> ã“ã‚Œã¯ **Next.js 16ä»¥é™ã§ä½¿ãˆã‚‹**æƒ³å®šã®ã‚³ãƒãƒ³ãƒ‰ã ã‚ˆï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¸Šã€15ä»¥å‰ã¯åˆ¥æ‰‹æ®µãŒå¿…è¦ã¨æ˜è¨˜ã•ã‚Œã¦ã‚‹ï¼‰ ([Next.js][3])

---

#### âœ… ãƒ‘ã‚¿ãƒ¼ãƒ³2ï¼šcodemodã§ã€Œã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ä¸€å¼ã€ï¼ˆNext.js 15ä»¥å‰ãªã©ï¼‰ğŸ¤–

Next.js 15ä»¥å‰ã¯ `next upgrade` ãŒä½¿ãˆãªã„ã®ã§ã€å…¬å¼ã¯ã“ã®å½¢ã‚’æ¡ˆå†…ã—ã¦ã‚‹ã‚ˆğŸ‘‡ ([Next.js][3])

```bash
npx @next/codemod@canary upgrade latest
```

ã“ã® upgrade codemod ã¯ã€ä¾‹ãˆã°ã“ã‚“ãªç§»è¡Œã‚’æ‰‹ä¼ã£ã¦ãã‚Œã‚‹ã‚ˆğŸ§°

* `next.config.js` ã‚’æ–°ã—ã„ `turbopack` è¨­å®šã¸å¯„ã›ã‚‹
* `next lint` â†’ ESLint CLI ã¸ã®ç§»è¡Œ
* deprecated ãª middleware æ…£ç¿’ã®ç§»è¡Œ
* `unstable_` ãŒå¤–ã‚ŒãŸAPIã®æ›´æ–°
  â€¦ãªã©ãªã©ï¼ ([Next.js][4])

---

## 5) â€œå€‹åˆ¥codemodâ€ã‚‚ã‚ã‚‹ã‚ˆï¼ˆå¿…è¦ãªæ™‚ã ã‘ï¼‰ğŸ§©âœ¨

![next_study_247_specific_codemod.png](./picture/next_study_247_specific_codemod.png)


ã€Œå…¨éƒ¨ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã€ã˜ã‚ƒãªãã¦ã€**ç‰¹å®šã®å¤‰æ›´ã ã‘ç›´ã—ãŸã„**ã¨ãã«ä½¿ã†ã‚ˆã€œï¼

ä¾‹ï¼š`next-og-import`ï¼ˆDynamic OGç”»åƒé–¢é€£ã® import ç§»è¡Œï¼‰ğŸ“¸ ([Next.js][2])

```bash
npx @next/codemod@latest next-og-import .
```

---

## 6) ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆå¾Œã«å¿…ãšã‚„ã‚‹3ç‚¹ã‚»ãƒƒãƒˆ ğŸ§ªğŸ—ï¸âœ¨

![next_study_247_post_upgrade_checks.png](./picture/next_study_247_post_upgrade_checks.png)


æœ€ä½é™ã“ã‚Œã ã‘ã‚„ã‚‹ã¨å®‰å¿ƒåº¦ãŒä¸€æ°—ã«ä¸ŠãŒã‚‹ã‚ˆã€œï¼ğŸ«¶

```bash
npm run lint
npm run test
npm run build
```

* **`build` ãŒé€šã‚‹ï¼æœ¬ç•ªã«ã‹ãªã‚Šè¿‘ã„ãƒã‚§ãƒƒã‚¯**âœ…
* é€†ã«ã€Œdevã¯å‹•ãã‘ã©buildã§æ­»ã¬ã€ã£ã¦ã‚ˆãã‚ã‚‹ã‚ã‚‹ğŸ˜‡ğŸ’¥

---

## 7) ã‚ˆãã‚ã‚‹ãƒãƒã‚Šã©ã“ã‚ï¼ˆå…ˆã«çŸ¥ã£ã¦ãŠãã¨å‹ã¡ï¼‰ğŸª¤ğŸ˜º

![next_study_247_common_pitfalls.png](./picture/next_study_247_common_pitfalls.png)


* **è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å·®åˆ†ãŒå¤§ãã„**ï¼ˆ`next.config.*` å‘¨ã‚Šï¼‰â†’ ã„ã£ãŸã‚“è½ã¡ç€ã„ã¦å·®åˆ†ã‚’è¦‹ã‚‹ğŸ‘€
* **lintã‚³ãƒãƒ³ãƒ‰å‘¨ã‚ŠãŒå¤‰ã‚ã‚‹**â†’ codemodãŒç›´ã—ã¦ãã‚Œã‚‹ã“ã¨ãŒã‚ã‚‹ï¼ˆã§ã‚‚æœ€çµ‚ç¢ºèªã¯äººé–“ï¼‰ğŸ¤ ([Next.js][4])
* **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ›´æ–°ãŒæ¥ã‚‹**â†’ â€œå¾Œã§ã‚„ã‚ã†â€ãŒä¸€ç•ªå±ãªã„ã‚„ã¤ğŸ˜µ
  ä¾‹ï¼š2025-12-11 ã« Next.js ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒå‡ºã¦ã‚‹ã‚ˆï¼ˆRSCãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®è„†å¼±æ€§é–¢é€£ï¼‰ğŸ›¡ï¸ ([Next.js][1])

---

## 8) ãƒŸãƒ‹ç·´ç¿’ï¼šå®‰å…¨ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚’â€œå‹é€šã‚Šâ€ã«ã‚„ã£ã¦ã¿ã‚ˆã† ğŸ®âœ¨

### âœ… ã‚„ã‚‹ã“ã¨ï¼ˆ20ã€œ30åˆ†ãã‚‰ã„ã®æ°—æŒã¡ã§ï¼‰

1. Gitã§æ›´æ–°ç”¨ãƒ–ãƒ©ãƒ³ãƒä½œã‚‹ğŸŒ¿
2. `npx @next/codemod@canary upgrade latest` ã‚’å®Ÿè¡ŒğŸ¤–
3. `npm run build` ã¾ã§é€šã™ğŸ—ï¸
4. å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«TOP3ã‚’ãƒ¡ãƒ¢ğŸ“ï¼ˆä¾‹ï¼š`next.config.*`, `eslint` ç³», middlewareç³»ï¼‰

---

## ã¾ã¨ã‚ ğŸ€âœ¨

* **å®‰å…¨ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã¯ã€Œé †ç•ªã‚²ãƒ¼ã€**ã ã‚ˆğŸ”
* **codemodã¯å…¬å¼ã®ãŠåŠ©ã‘ãƒ­ãƒœ**ğŸ¤–ğŸ§¹
* ã¾ãšã¯ **ãƒ–ãƒ©ãƒ³ãƒ â†’ lockfile â†’ upgrade/codemod â†’ build** ã®å‹ã ã‘è¦šãˆã‚Œã°OKï¼ğŸ«¶
* Next.jsã¯ 2025-12-18 ã« 16.1 ã®ç™ºè¡¨ã‚‚å‡ºã¦ã‚‹ã®ã§ã€æ›´æ–°ã®æ³¢ã¯ã“ã‚Œã‹ã‚‰ã‚‚æ¥ã‚‹ã‚ˆã€œğŸŒŠâœ¨ ([Next.js][5])

---

æ¬¡ã®ç« ï¼ˆç¬¬248ç« ï¼‰ã¯ **`revalidatePath` vs `revalidateTag`** ğŸ”âœ¨
ã€Œæ›´æ–°ã®ä»•çµ„ã¿ã€ã‚’ä½¿ã„åˆ†ã‘ã‚‰ã‚Œã‚‹ã¨ã€é‹ç”¨ãŒä¸€æ°—ã«ä¸Šæ‰‹ããªã‚‹ã‚ˆã€œï¼ğŸ˜Š

[1]: https://nextjs.org/blog/security-update-2025-12-11?utm_source=chatgpt.com "Next.js Security Update: December 11, 2025"
[2]: https://nextjs.org/docs/app/guides/upgrading/codemods?utm_source=chatgpt.com "Upgrading: Codemods"
[3]: https://nextjs.org/docs/app/getting-started/upgrading?utm_source=chatgpt.com "Getting Started: Upgrading"
[4]: https://nextjs.org/docs/app/guides/upgrading/version-16?utm_source=chatgpt.com "Upgrading: Version 16"
[5]: https://nextjs.org/blog/next-16-1?utm_source=chatgpt.com "Next.js 16.1"
