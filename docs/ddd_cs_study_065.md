# ç¬¬65ç« ï¼šãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç† ğŸ’³ğŸ”âœ¨

![ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†](./picture/ddd_cs_study_065_transaction.png)

**è¤‡æ•°ã®é›†ç´„ã‚’ã„ã£ãºã‚“ã«æ›´æ–°ã™ã‚‹ã¨ãã®ã€Œäº‹æ•…ã‚‰ãªã„ä½œæ³•ã€**ã§ã™ğŸ˜Š

---

## ã¾ãšçµè«–ï¼šãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã£ã¦ä½•ï¼ŸğŸ¤”

ä¸€è¨€ã§ã„ã†ã¨ **ã€Œå…¨éƒ¨æˆåŠŸã—ãŸã‚‰ç¢ºå®šâœ…ï¼é€”ä¸­ã§ã‚³ã‚±ãŸã‚‰å…¨éƒ¨ãªã‹ã£ãŸã“ã¨ã«ã™ã‚‹ğŸ§¯ã€** ä»•çµ„ã¿ã§ã™ã€‚

ãŸã¨ãˆã°æ³¨æ–‡ç¢ºå®šã§â€¦

* æ³¨æ–‡ï¼ˆOrderï¼‰ã‚’ã€Œç¢ºå®šã€ã«ã™ã‚‹ âœ…
* åœ¨åº«ï¼ˆInventoryï¼‰ã‚’ã€Œå¼•ãå½“ã¦ã€ã«ã™ã‚‹ âœ…

ã“ã®2ã¤ãŒ **ã‚»ãƒƒãƒˆã§å¿…ãšåŒæ™‚ã«æˆç«‹**ã—ã¦ã»ã—ã„ã§ã™ã‚ˆã­ï¼Ÿ
ç‰‡æ–¹ã ã‘æˆåŠŸã™ã‚‹ã¨ã€æ¬¡ã¿ãŸã„ãªåœ°ç„ãŒèµ·ãã¾ã™â€¦ğŸ˜‡ğŸ”¥

* æ³¨æ–‡ã¯ç¢ºå®šã—ãŸã®ã«åœ¨åº«ãŒæ¸›ã£ã¦ãªã„ â†’ å£²ã‚Šã™ãäº‹æ•…ğŸ’¥
* åœ¨åº«ã¯æ¸›ã£ãŸã®ã«æ³¨æ–‡ãŒç¢ºå®šã—ã¦ãªã„ â†’ åœ¨åº«ã ã‘æ¶ˆãˆã‚‹ğŸ’¥

---

## DDDã®è¶…å¤§äº‹ãƒ«ãƒ¼ãƒ«ï¼šé›†ç´„ã¯ã€Œä¸€è²«æ€§ã®å¢ƒç•Œã€ğŸ§±âœ¨

DDDã§ã¯åŸºæœ¬ã“ã†è€ƒãˆã¾ã™ğŸ‘‡

* **1ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã§å®ˆã‚Œã‚‹å¼·ã„ä¸€è²«æ€§ã¯ã€åŸå‰‡ã€Œ1é›†ç´„ã®ä¸­ã€**ãŒå®‰å…¨ ğŸ’ª
* **è¤‡æ•°é›†ç´„ã‚’1å›ã§æ›´æ–°**ã—ãŸããªã‚‹ã¨ãã¯ã€è¨­è¨ˆãŒé›£ã—ããªã‚‹ã‚¾ãƒ¼ãƒ³âš ï¸

ã§ã‚‚ï¼ç¾å®Ÿã¯ã€Œè¤‡æ•°é›†ç´„ã‚’åŒæ™‚ã«æ›´æ–°ã—ãŸã„ã€å ´é¢ãŒæ™®é€šã«ã‚ã‚Šã¾ã™ğŸ˜Š
ã ã‹ã‚‰ã“ã®ç« ã§ã¯ **â€œè¿·ã‚ãªã„ãŸã‚ã®åˆ¤æ–­ãƒ«ãƒ¼ãƒ«â€**ã‚’ä½œã‚Šã¾ã™ğŸ¯

---

## è¿·ã‚ãªã„åˆ¤æ–­ãƒ«ãƒ¼ãƒ«ğŸš¦âœ¨ï¼ˆã“ã‚Œã ã‘è¦šãˆã¦OKï¼‰

### ãƒ«ãƒ¼ãƒ«Aï¼šåŒã˜DBãƒ»åŒã˜DbContextã§ã€åŒæ™‚ã«ç¢ºå®šã—ãŸã„

â¡ï¸ **DBãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã§ã¾ã¨ã‚ã¦OK** ğŸ˜„
ï¼ˆEF Core ã® `BeginTransactionAsync()` ã‚’ä½¿ã†ã‚„ã¤ï¼‰ ([Microsoft Learn][1])

### ãƒ«ãƒ¼ãƒ«Bï¼šå¤–éƒ¨APIãƒ»ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãƒ»åˆ¥DBãªã©ã€ŒDBã®å¤–ã€ãŒæ··ã–ã‚‹

â¡ï¸ **ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã§ä¸€æ°—ã«ç¢ºå®šã—ã‚ˆã†ã¨ã—ãªã„** ğŸ™…â€â™€ï¸
ä»£ã‚ã‚Šã«ğŸ‘‡

* **Outboxï¼ˆé€ä¿¡ç®±ï¼‰ãƒ‘ã‚¿ãƒ¼ãƒ³**ã§ã€Œã‚ã¨ã§ç¢ºå®Ÿã«é€ã‚‹ã€ğŸ“®âœ¨ ([Microsoft Learn][2])
* ã‚‚ã—ãã¯ã€Œå¾Œè¿½ã„ã§æ•´åˆã€ã™ã‚‹ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ãƒ»æœ€çµ‚çš„æ•´åˆæ€§ï¼‰ğŸ•Šï¸

---

## EF Coreã§ã®åŸºæœ¬ï¼šã©ã†æ›¸ãã®ãŒâ€œå®‰å…¨â€ï¼ŸğŸ§·ğŸ˜Š

EF Core ã§ã¯ `DbContext.Database` ã‹ã‚‰ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã§ãã¾ã™ã€‚ ([Microsoft Learn][1])
**ãƒã‚¤ãƒ³ãƒˆã¯ã€Œãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ï¼ˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ï¼‰ã§å›²ã†ã€**ã“ã¨ã§ã™âœ¨
ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã«ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’æŒã¡è¾¼ã¾ãªã„ã®ãŒã‚­ãƒ¬ã‚¤ã§ã™ğŸ§¼

---

## å®Ÿè£…ä¾‹ï¼šæ³¨æ–‡ç¢ºå®šï¼ˆOrder + Inventoryï¼‰ã‚’1å›ã§ç¢ºå®šã™ã‚‹ ğŸ›’ğŸ“¦âœ…

> ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼š
>
> * Orderé›†ç´„ï¼šæ³¨æ–‡ã‚’ä½œã£ã¦ç¢ºå®šã«ã™ã‚‹
> * Inventoryé›†ç´„ï¼šåœ¨åº«ã‚’å¼•ãå½“ã¦ã‚‹
> * æœ€å¾Œã«ã¾ã¨ã‚ã¦ `SaveChanges` ã—ã¦ã‚³ãƒŸãƒƒãƒˆğŸ‰
 
 ```mermaid
 sequenceDiagram
    participant App as AppService
    participant DB as DB(Transaction)
    participant Order as Orderé›†ç´„
    participant Inv as Inventoryé›†ç´„
    
    App->>DB: Begin Transaction ğŸ¬
    
    App->>Order: Create Order ğŸ†•
    App->>Inv: Reserve Stock ğŸ“¦
    
    rect rgb(240, 240, 240)
        Note over App, Inv: ã“ã“ã¾ã§ãƒ¡ãƒ¢ãƒªä¸Šã®å¤‰åŒ–
    end
    
    App->>DB: SaveChanges (SQLé€ä¿¡)
    App->>DB: Commit! âœ…
    
    Note over DB: ã“ã“ã§åˆã‚ã¦ç¢ºå®šï¼
 ```
 
 ```csharp
public sealed class PlaceOrderService
{
    private readonly ShopDbContext _db;
    private readonly IOrderRepository _orders;
    private readonly IInventoryRepository _inventories;

    public PlaceOrderService(ShopDbContext db, IOrderRepository orders, IInventoryRepository inventories)
    {
        _db = db;
        _orders = orders;
        _inventories = inventories;
    }

    public async Task<Result<OrderId>> PlaceAsync(PlaceOrderCommand cmd, CancellationToken ct)
    {
        await using var tx = await _db.Database.BeginTransactionAsync(ct);

        try
        {
            // 1) é›†ç´„ã‚’ç”¨æ„ã—ã¦ãƒ«ãƒ¼ãƒ«ã‚’é©ç”¨ ğŸ§ âœ¨
            var order = Order.Create(cmd.CustomerId, cmd.Lines);

            var inventory = await _inventories.GetAsync(cmd.Lines.Select(x => x.ProductId).ToList(), ct);
            inventory.Reserve(order.Id, cmd.Lines); // åœ¨åº«å¼•ãå½“ã¦ï¼ˆãƒ«ãƒ¼ãƒ«ã¯é›†ç´„å†…ã«ï¼ï¼‰

            // 2) å¤‰æ›´ã‚’ç™»éŒ² ğŸ§¾
            _orders.Add(order);
            _inventories.Update(inventory);

            // 3) ã¾ã¨ã‚ã¦ä¿å­˜ã—ã¦ã‚³ãƒŸãƒƒãƒˆ ğŸ‰
            await _db.SaveChangesAsync(ct);
            await tx.CommitAsync(ct);

            return Result.Ok(order.Id);
        }
        catch (Exception ex)
        {
            // é€”ä¸­ã§ã‚³ã‚±ãŸã‚‰å…¨éƒ¨ãªã‹ã£ãŸã“ã¨ã«ã™ã‚‹ ğŸ§¯
            await tx.RollbackAsync(ct);
            return Result.Fail<OrderId>($"æ³¨æ–‡ç¢ºå®šã«å¤±æ•—ã—ã¾ã—ãŸ: {ex.Message}");
        }
    }
}
```

### ã“ã“ãŒãˆã‚‰ã„ãƒã‚¤ãƒ³ãƒˆğŸŒŸ

* ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®é–‹å§‹ãƒ»çµ‚äº†ãŒ **ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹1ã¤ã«å¯¾å¿œ**ã—ã¦ã‚‹ âœ…
* ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆOrder/Inventoryï¼‰ã®ä¸­ã« **EFã‚„ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãŒå‡ºã¦ã“ãªã„** âœ…
* ä¾‹å¤–ãŒèµ·ããŸã‚‰ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§ **ã€Œä¸­é€”åŠç«¯ã€ã‚’æ®‹ã•ãªã„** âœ…

---

## ã‚ˆãã‚ã‚‹åœ°é›·ğŸ’£ï¼ˆã“ã“ã ã‘ã¯é¿ã‘ã¦ï¼ï¼‰

### â¶ ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ä¸­ã«å¤–éƒ¨APIã‚’å‘¼ã¶ ğŸŒğŸ˜±

* æ±ºæ¸ˆAPIã€ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã€WebHookâ€¦
  ã“ã‚Œã‚’ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®ä¸­ã§ã‚„ã‚‹ã¨ğŸ‘‡
* ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãŒé•·ããªã‚‹
* ãƒ­ãƒƒã‚¯ãŒé•·å¼•ã
* ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚„ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ãŒå¢—ãˆã‚‹
  ã§ã€é‹ç”¨ãŒã¤ã‚‰ããªã‚ŠãŒã¡ã§ã™ğŸ˜­

â¡ï¸ å¤–éƒ¨é€šä¿¡ã¯ **åŸºæœ¬ã€Œã‚³ãƒŸãƒƒãƒˆå¾Œã€**ã«å¯„ã›ã¾ã—ã‚‡ã†ğŸ˜Š
ã©ã†ã—ã¦ã‚‚ã€Œç¢ºå®Ÿã«é€ã‚‹ã€ãŒå¿…è¦ãªã‚‰ **Outbox** ã¸ğŸ“®âœ¨ï¼ˆå¾Œè¿°ï¼‰

### â· DbContextã‚’ä¸¦åˆ—ã§ä½¿ã†ï¼ˆTask.WhenAllã¨ã‹ï¼‰ğŸƒâ€â™€ï¸ğŸƒâ€â™€ï¸ğŸ’¥

åŒã˜ `DbContext` ã§ä¸¦åˆ—å®Ÿè¡Œã¯å±é™ºã§ã™âš ï¸
EF Core ã¯åŒä¸€ `DbContext` ã®ä¸¦åˆ—æ“ä½œã‚’ã‚µãƒãƒ¼ãƒˆã—ãªã„ã®ã§ã€åŸºæœ¬ã¯ã€Œã™ãawaitã€ãŒãŠä½œæ³•ã§ã™ã€‚ ([Microsoft Learn][3])

---

## ã‚‚ã†ä¸€æ­©ï¼šTransactionScope ã¯ã„ã¤ä½¿ã†ï¼ŸğŸ§µğŸ¤

`TransactionScope` ã¯ã€Œã‚¹ã‚³ãƒ¼ãƒ—ã«å…¥ã£ã¦ã‚‹å‡¦ç†ã‚’ã¾ã¨ã‚ã¦ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã«ã™ã‚‹ã€é“å…·ã§ã™ã€‚
ãŸã ã— **async/awaitã¨ä¸€ç·’ã«ä½¿ã†ãªã‚‰è¨­å®šãŒå¿…é ˆ**ã§ã€`TransactionScopeAsyncFlowOption.Enabled` ãŒå¿…è¦ã§ã™ã€‚ ([Microsoft Learn][4])

```csharp
using var scope = new TransactionScope(TransactionScopeAsyncFlowOption.Enabled);

// ã“ã“ã§DBå‡¦ç†ãªã©
// await ... (asyncã§ã‚‚æµã‚Œã‚‹)

scope.Complete();
```

ã§ã‚‚åˆå¿ƒè€…ã®ã†ã¡ã¯ã€ã¾ãšã¯ **EF Coreã® BeginTransactionAsync** ã‚’ãŠã™ã™ã‚ã—ã¾ã™ğŸ˜Š
ï¼ˆTransactionScopeã¯çŠ¶æ³ã«ã‚ˆã£ã¦åˆ†æ•£ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¯„ã‚Šã®è©±ã«ãªã£ã¦æ€¥ã«é›£ã—ããªã‚‹ã®ã§â€¦ğŸ˜µâ€ğŸ’«ï¼‰

---

## DBã®å¤–ã¨ã€Œå®‰å…¨ã«ä»²è‰¯ãã™ã‚‹ã€ï¼šOutboxãƒ‘ã‚¿ãƒ¼ãƒ³ ğŸ“®âœ¨

ã€ŒDBæ›´æ–°ã€ã¨ã€Œã‚¤ãƒ™ãƒ³ãƒˆé€ä¿¡ï¼ˆãƒ¡ãƒ¼ãƒ«ãƒ»ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ»é€šçŸ¥ï¼‰ã€ã‚’åŒæ™‚ã«ç¢ºå®Ÿã«ã‚„ã‚ŠãŸã„ã¨ãã€
**â€œDBãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã ã‘â€ã§ã¯ä¿è¨¼ã§ãã¾ã›ã‚“**ã€‚

ãã“ã§ğŸ‘‡

* DBæ›´æ–°ã¨ä¸€ç·’ã« **Outboxãƒ†ãƒ¼ãƒ–ãƒ«ã«â€œé€ã‚‹äºˆå®šâ€ã‚’ä¿å­˜**ã™ã‚‹ï¼ˆåŒã˜ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ï¼‰
* ã‚³ãƒŸãƒƒãƒˆå¾Œã€åˆ¥ãƒ—ãƒ­ã‚»ã‚¹/ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ãŒOutboxã‚’èª­ã‚“ã§é€ä¿¡ã™ã‚‹

ã“ã®è€ƒãˆæ–¹ãŒ **Transactional Outbox** ã§ã™ğŸ“®âœ¨ ([Microsoft Learn][2])

> ã€ŒDBã«ã¯å…¥ã£ãŸã®ã«ã€é€ä¿¡ã ã‘å¤±æ•—ã—ãŸâ€¦ã€ã‚’æ¸›ã‚‰ã™ãŸã‚ã®è¶…å®šç•ªãŠå®ˆã‚Šã§ã™ğŸ§¿

---

## AIã«é ¼ã‚€ã¨ãã® â€œã„ã„æ„Ÿã˜ã®æŒ‡ç¤ºâ€ ğŸ’¬ğŸ¤–âœ¨

ãã®ã¾ã¾ã‚³ãƒ”ãƒšã§ä½¿ãˆã‚‹ã‚„ã¤ç½®ã„ã¨ãã¾ã™ğŸ˜ŠğŸ’•

### â‘  ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•Œã¤ãå®Ÿè£…ã‚’ä½œã‚‰ã›ã‚‹

* ã€Œãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã§ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³é–‹å§‹ã€
* ã€Œãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã«EFä¾å­˜ã‚’æ··ãœãªã„ã€
* ã€Œå¤–éƒ¨APIã¯ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®å¤–ã€
  ã“ã®3ç‚¹ã‚’å¼·ã‚ã«è¨€ã†ã®ãŒã‚³ãƒ„ã§ã™ğŸ§ âœ¨

```text
æ³¨æ–‡ç¢ºå®šã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚’C# + EF Coreã§å®Ÿè£…ã—ã¦ã€‚
æ¡ä»¶:
- ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã§ BeginTransactionAsync ã‚’ä½¿ã£ã¦ç®¡ç†
- ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ï¼ˆé›†ç´„ï¼‰ã« DbContext / EF Core ã®å‹ã‚’å‡ºã•ãªã„
- å¤–éƒ¨APIå‘¼ã³å‡ºã—ã¯ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®å¤–ã«å‡ºã™
- å¤±æ•—æ™‚ã¯ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã—ã¦ Result ãƒ‘ã‚¿ãƒ¼ãƒ³ã§è¿”ã™
```

### â‘¡ äº‹æ•…ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ã•ã›ã‚‹ï¼ˆã‹ãªã‚ŠåŠ¹ãâœ¨ï¼‰

```text
ã“ã®ã‚³ãƒ¼ãƒ‰ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•ŒãŒå±é™ºãªç‚¹ã‚’æŒ‡æ‘˜ã—ã¦ã€‚
ç‰¹ã«ã€Œå¤–éƒ¨é€šä¿¡ã€ã€Œãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãŒé•·ã„ã€ã€ŒDbContextä¸¦åˆ—ã€ã€Œè¤‡æ•°SaveChangesã€ã®è¦³ç‚¹ã§ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ã€‚
æ”¹å–„æ¡ˆã‚‚å‡ºã—ã¦ã€‚
```

---

## ãƒŸãƒ‹æ¼”ç¿’âœï¸ğŸ“âœ¨ï¼ˆ15ã€œ30åˆ†ï¼‰

### ãŠé¡Œï¼šè³¼å…¥ã§ãƒã‚¤ãƒ³ãƒˆä»˜ä¸ ğŸâ­

è³¼å…¥ç¢ºå®šã§ğŸ‘‡ã‚’ã‚„ã‚ŠãŸã„ï¼

1. Orderé›†ç´„ï¼šæ³¨æ–‡ã‚’ç¢ºå®š âœ…
2. Customeré›†ç´„ï¼šãƒã‚¤ãƒ³ãƒˆåŠ ç®— âœ…
3. ã¤ã„ã§ã«ã€Œè³¼å…¥å®Œäº†ãƒ¡ãƒ¼ãƒ«ã€é€ä¿¡ âœ‰ï¸

**ã‚ãªãŸãªã‚‰ã©ã†ã™ã‚‹ï¼Ÿ**ï¼ˆç­”ãˆã¯1ã¤ã˜ã‚ƒãªã„ã‚ˆğŸ˜Šï¼‰

* â‘  Order + Customer ãŒåŒã˜DBãªã‚‰

  * DBãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã§ã¾ã¨ã‚ã‚‹âœ…
* â‘¡ ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã¯

  * ã‚³ãƒŸãƒƒãƒˆå¾Œã«é€ã‚‹ or Outboxã«ç©ã‚€ğŸ“®âœ¨

---

## ä»Šæ—¥ã®ã¾ã¨ã‚ğŸ€âœ¨

* ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã¯ã€Œå…¨éƒ¨OKã‹ã€å…¨éƒ¨ãªã‹ã£ãŸã“ã¨ã€ğŸ”
* DDDã§ã¯æœ¬æ¥ã€Œ1é›†ç´„ï¼ä¸€è²«æ€§ã®å˜ä½ã€ğŸ§±
* ã§ã‚‚ç¾å®Ÿã¯è¤‡æ•°é›†ç´„æ›´æ–°ãŒã‚ã‚‹ â†’ ã ã‹ã‚‰åˆ¤æ–­ãƒ«ãƒ¼ãƒ«ğŸš¦
* åŒä¸€DBå†…ã¯ `BeginTransactionAsync` ãŒåŸºæœ¬ã§å®‰å¿ƒ ([Microsoft Learn][1])
* å¤–éƒ¨é€šä¿¡ãŒæ··ã–ã‚‹ãªã‚‰ Outbox ã§äº‹æ•…ã‚’æ¸›ã‚‰ã™ğŸ“®âœ¨ ([Microsoft Learn][2])

---

æ¬¡ã®ç¬¬66ç« ï¼ˆCQRSè¶…å…¥é–€ï¼‰ã«è¡Œãå‰ã«ã€ã‚‚ã—ã‚ˆã‘ã‚Œã°âœ¨
ã€Œã„ã¾ä½œã‚ŠãŸã„ã‚¢ãƒ—ãƒªã®â€œè¤‡æ•°é›†ç´„æ›´æ–°ã£ã½ã„å‡¦ç†â€ã€ã‚’1ã¤æŒ™ã’ã¦ãã‚ŒãŸã‚‰ã€**ã“ã®ç« ã®ãƒ«ãƒ¼ãƒ«ã§æœ€çŸ­ãƒ«ãƒ¼ãƒˆã®è¨­è¨ˆ**ã«è½ã¨ã—è¾¼ã¿ã¾ã™ã‚ˆğŸ˜ŠğŸ§ ğŸ’–

[1]: https://learn.microsoft.com/ja-jp/ef/core/saving/transactions?utm_source=chatgpt.com "EF Core - ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®ä½¿ç”¨"
[2]: https://learn.microsoft.com/en-us/azure/architecture/databases/guide/transactional-outbox-cosmos?utm_source=chatgpt.com "Transactional Outbox pattern with Azure Cosmos DB"
[3]: https://learn.microsoft.com/en-us/dotnet/api/microsoft.entityframeworkcore.infrastructure.databasefacade.begintransactionasync?view=efcore-10.0&utm_source=chatgpt.com "DatabaseFacade.BeginTransactionAsync ..."
[4]: https://learn.microsoft.com/en-us/dotnet/api/system.transactions.transactionscopeasyncflowoption?view=net-10.0&utm_source=chatgpt.com "TransactionScopeAsyncFlowOpti..."
