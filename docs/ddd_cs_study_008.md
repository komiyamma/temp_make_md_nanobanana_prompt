# ç¬¬8ç« ï¼šã€Œæ±šãæ›¸ã„ã¦å¾Œã§ç›´ã™ã€ãŒ1äººé–‹ç™ºã§å¤±æ•—ã™ã‚‹ç†ç”± ğŸ§¨ğŸ§¹

![Messy Failure](./picture/ddd_cs_study_008_messy_failure.png)

ã€Œã¨ã‚Šã‚ãˆãšå‹•ã‘ã°OKï¼ã‚ã¨ã§ã‚­ãƒ¬ã‚¤ã«ã—ã‚ˆã€œğŸ˜„ã€ã£ã¦ã€æœ€åˆã¯ã‚ã£ã¡ã‚ƒé­…åŠ›çš„ã«è¦‹ãˆã‚‹ã‚“ã ã‚ˆã­âœ¨
ã§ã‚‚1äººé–‹ç™ºã ã¨ã€ã“ã‚ŒãŒé«˜ç¢ºç‡ã§**â€œè©°ã¿ãƒ«ãƒ¼ãƒˆâ€**ã«ãªã‚Šã¾ã™â€¦ğŸ˜µâ€ğŸ’«

---

## 1. ã¾ãšçµè«–ï¼š**â€œå¾Œã§ç›´ã™â€ã¯ã ã„ãŸã„æ¥ãªã„** â°ğŸ’¥

![ddd cs study 008 later never comes](./picture/ddd_cs_study_008_later_never_comes.png)

ç†ç”±ã¯ã‚·ãƒ³ãƒ—ãƒ«ã§ã€

* è¿½åŠ æ©Ÿèƒ½ãŒæ¥ã‚‹ğŸ“ˆ
* ãƒã‚°ãŒæ¥ã‚‹ğŸ›
* æœŸé™ãŒæ¥ã‚‹ğŸ—“ï¸
* ã‚„ã‚‹æ°—ãŒæ¶ˆãˆã‚‹ğŸ« ï¼ˆã‚ã‚‹ã‚ã‚‹ï¼‰

çµæœã€æ±šã„ã‚³ãƒ¼ãƒ‰ã®ä¸Šã«æ–°æ©Ÿèƒ½ã‚’ç©ã¿ä¸Šã’ã¦â€¦
**ã€Œç›´ã›ãªã„å·¨å¤§ãƒ–ãƒ­ãƒƒã‚¯ã€**ãŒå®Œæˆã—ã¡ã‚ƒã†ã®ğŸ¥²

---

## 2. å¤±æ•—ã™ã‚‹ç†ç”±â‘ ï¼šæ±šã„éƒ¨åˆ†ã¯â€œå¢—æ®–â€ã™ã‚‹ ğŸ§Ÿâ€â™€ï¸â•â•â•

![ddd cs study 008 dirty spread](./picture/ddd_cs_study_008_dirty_spread.png)

æ±šã„ã‚³ãƒ¼ãƒ‰ã£ã¦ã€ãã“ã ã‘æ±šã„ã¾ã¾çµ‚ã‚ã‚‰ãªã„ã®ãŒæ€–ã„ã¨ã“ã‚ğŸ˜±

* ã€Œã“ã®æ›¸ãæ–¹ã§ã„ã„ã‹ã€â†’ ä¼¼ãŸã‚³ãƒ¼ãƒ‰ãŒå¢—ãˆã‚‹
* ã€Œã“ã“ã‚‚åŒã˜ã‚ˆã†ã«ã€â†’ ã‚³ãƒ”ãƒšãŒå¢—ãˆã‚‹
* ã€Œä¾‹å¤–å‡¦ç†ã‚ã¨ã§ã€â†’ ä¾‹å¤–å‡¦ç†ãŒæ°¸é ã«ãªã„

ãã—ã¦æ°—ã¥ãã¨ã€ã©ã“ã‚’ç›´ã—ã¦ã‚‚ã©ã“ã‹ãŒå£Šã‚Œã‚‹â€¦ğŸ’£

---

## 3. å¤±æ•—ã™ã‚‹ç†ç”±â‘¡ï¼šæœªæ¥ã®è‡ªåˆ†ã¯â€œä»–äººâ€ã«ãªã‚‹ ğŸ‘¤ğŸ“‰

![ddd cs study 008 future stranger](./picture/ddd_cs_study_008_future_stranger.png)

1é€±é–“å¾Œã®è‡ªåˆ†ã€Œãˆâ€¦ã“ã‚Œä½•â€¦ï¼Ÿã€
1ãƒ¶æœˆå¾Œã®è‡ªåˆ†ã€Œèª°ãŒæ›¸ã„ãŸã®ï¼Ÿï¼ˆè‡ªåˆ†ï¼‰ã€
3ãƒ¶æœˆå¾Œã®è‡ªåˆ†ã€Œè§¦ã‚ŠãŸããªã„â€¦ã€ğŸ™ˆ

1äººé–‹ç™ºã®æœ€å¤§ã®æ•µã¯ã€**è¨˜æ†¶ã®é¢¨åŒ–**ğŸ§ ğŸ’¨
ã€Œå¾Œã§ç›´ã™ã€ã£ã¦ã€å®Ÿã¯
**â€œå¾Œã§æ€ã„å‡ºã—ãªãŒã‚‰ç›´ã™â€**ã£ã¦æ„å‘³ã«ãªã‚‹ã‹ã‚‰ã€ã‚³ã‚¹ãƒˆãŒè·³ã­ä¸ŠãŒã‚‹ã®ğŸ˜­

---

## 4. å¤±æ•—ã™ã‚‹ç†ç”±â‘¢ï¼šå¤§ãƒªãƒ•ã‚¡ã‚¯ã‚¿ã¯â€œä»•æ§˜å¤‰æ›´â€ã¨åŒã˜ ğŸ­âš ï¸

![ddd cs study 008 refactor risk](./picture/ddd_cs_study_008_refactor_risk.png)

æ±šã„ã‚³ãƒ¼ãƒ‰ã‚’å¾Œã‹ã‚‰ä¸€æ°—ã«ç›´ãã†ã¨ã™ã‚‹ã¨ã€ã“ã†ãªã‚‹ï¼š

* ã©ã“ãŒæ­£ã—ã„å‹•ãã‹åˆ†ã‹ã‚‰ãªã„ğŸ¤·â€â™€ï¸
* å¤‰æ›´ã—ãŸã‚‰ä½•ãŒå£Šã‚ŒãŸã‹åˆ†ã‹ã‚‰ãªã„ğŸ˜µ
* ãƒ†ã‚¹ãƒˆãŒãªã„ã¨ç¢ºèªã§ããªã„ğŸ§ªâŒ
* çµå±€ã€Œã‚„ã‚ã‚ˆâ€¦ã€ã£ã¦ãªã‚‹ğŸ« 

ã¤ã¾ã‚Šå¤§ãƒªãƒ•ã‚¡ã‚¯ã‚¿ã£ã¦ã€å®Ÿè³ª **â€œåˆ¥ã‚¢ãƒ—ãƒªä½œã‚Šç›´ã—â€** ã«è¿‘ã„ã®ã‚ˆâ€¦ğŸ˜‡

---

## 5. AIæ™‚ä»£ã®è½ã¨ã—ç©´ï¼šæ±šã„ã‚³ãƒ¼ãƒ‰ã¯AIã§â€œé«˜é€Ÿå¢—æ®–â€ã™ã‚‹ ğŸ¤–ğŸ’¨ğŸ§¨

![ddd cs study 008 ai fast dirty](./picture/ddd_cs_study_008_ai_fast_dirty.png)

AIã«ã€Œæ©Ÿèƒ½è¿½åŠ ã—ã¦ï¼ã€ã£ã¦é ¼ã‚€ã¨ã€ã™ãè¿½åŠ ã—ã¦ãã‚Œã‚‹âœ¨
ã§ã‚‚â€¦**æ±šã„è¨­è¨ˆã®ã¾ã¾ã ã¨**AIã¯ã“ã†ãªã‚‹ï¼š

* æ—¢å­˜ã®æ±šã•ã«åˆã‚ã›ã¦æ‹¡å¼µã™ã‚‹ï¼ˆï¼æ±šã•å¼·åŒ–ï¼‰ğŸ§Ÿâ€â™‚ï¸
* ãã®å ´ã—ã®ãã®åˆ†å²ãŒå¢—ãˆã‚‹ğŸŒ¿
* â€œå…¨ä½“ã®æ•´åˆæ€§â€ã‚ˆã‚Šâ€œéƒ¨åˆ†ã®å®Ÿè£…â€ã‚’å„ªå…ˆã™ã‚‹ğŸ§©

ã ã‹ã‚‰AIæ™‚ä»£ã»ã©ã€**æœ€åˆã®éª¨çµ„ã¿ï¼ˆå¢ƒç•Œç·šãƒ»ãƒ«ãƒ¼ãƒ«ï¼‰**ãŒå¤§äº‹ã«ãªã‚‹ã‚ˆğŸ§±âœ¨

---

## 6. ãƒŸãƒ‹ä¾‹ï¼šã“ã†ã‚„ã£ã¦â€œæ±šã•â€ã¯è‚²ã¤ ğŸŒ±ğŸ˜µâ€ğŸ’«

ãŸã¨ãˆã°ã€Œä¼šå“¡ãƒ©ãƒ³ã‚¯ã§å‰²å¼•ãŒå¤‰ã‚ã‚‹ã€ã¿ãŸã„ãªå‡¦ç†ã€‚

```mermaid
flowchart TD
    Start["ä¾¡æ ¼è¨ˆç®—"] --> Rank{"ä¼šå“¡ãƒ©ãƒ³ã‚¯ã¯ï¼Ÿ"}
    Rank -- Gold --> Gold["10% OFF"]
    Rank -- Silver --> Silver["5% OFF"]
    
    Gold & Silver --> Camp{"ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ä¸­ï¼Ÿ"}
    Camp -- Yes --> CampOff["20% OFF"]
    
    CampOff --> Age{"å¹´é½¢ < 18 ?"}
    Age -- Yes --> Disc["-100å††"]
    
    Disc --> End["...ç¶šãğŸ˜‡"]
    
    style End fill:#ffcccc,stroke:#ff0000
```

### ğŸ™…â€â™€ï¸ æ±šããªã‚Šã‚„ã™ã„ä¾‹ï¼ˆåˆ†å²ãŒè‚²ã¤â€¦ï¼‰

```csharp
decimal CalcPrice(decimal basePrice, string rank, bool isCampaign, int age)
{
    var price = basePrice;

    if (rank == "Gold") price *= 0.9m;
    else if (rank == "Silver") price *= 0.95m;

    if (isCampaign) price *= 0.8m;

    if (age < 18) price -= 100;

    // ãã®ã†ã¡ã€Œåœ°åŸŸã€ã€Œè³¼å…¥å›æ•°ã€ã€Œæ›œæ—¥ã€â€¦ãŒå¢—ãˆã‚‹ğŸ˜‡
    return price;
}
```

ã“ã‚Œã€æœ€åˆã¯å‹•ãã—é€Ÿã„ğŸ‘
ã§ã‚‚æ©Ÿèƒ½ãŒå¢—ãˆã‚‹ã¨ã€`if` ãŒã‚¸ãƒ£ãƒ³ã‚°ãƒ«åŒ–ã—ã¦ **èª°ã‚‚è§¦ã‚Œãªããªã‚‹**ğŸŒ³ğŸ˜‡

---

## 7. ã˜ã‚ƒã‚ã©ã†ã™ã‚‹ï¼Ÿã€Œå®Œç’§ã€ã˜ã‚ƒãªãã¦ã€Œå°ã•ãæ•´ãˆã‚‹ã€ğŸ§¹âœ¨

ãƒã‚¤ãƒ³ãƒˆã¯ã“ã‚ŒğŸ‘‡

### âœ… ãƒ«ãƒ¼ãƒ«1ï¼š**â€œå¾Œã§ã¾ã¨ã‚ã¦â€ã˜ã‚ƒãªãã€â€œä»Šã¡ã‚‡ã£ã¨ã ã‘â€**

* è¿½åŠ ã®ã¤ã„ã§ã«ã€è¿‘ãã®æ±šã‚Œã‚’1å€‹ã ã‘æƒé™¤ğŸ§½
* 1å›ã§å…¨éƒ¨ç›´ã•ãªã„ï¼ˆç ´å£Šã®å…ƒï¼‰ğŸ’¥

### âœ… ãƒ«ãƒ¼ãƒ«2ï¼š**å¢ƒç•Œç·šã ã‘ã¯å…ˆã«å¼•ã**ï¼ˆã–ã£ãã‚Šã§OKï¼‰

ãŸã¨ãˆã°æœ€å°ã§ã‚‚ã“ã†åˆ†ã‘ã‚‹ã ã‘ã§åŠ¹æœå¤§ï¼š

* `Domain`ï¼šãƒ«ãƒ¼ãƒ«ï¼ˆå€¤ãƒ»è¨ˆç®—ãƒ»åˆ¶ç´„ï¼‰ğŸ§ 
* `Application`ï¼šã‚„ã‚ŠãŸã„ã“ã¨ï¼ˆãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ï¼‰ğŸ§­
* `Infrastructure`ï¼šDBã‚„å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ğŸ—„ï¸
* `Web`ï¼šç”»é¢/APIğŸŒ

ã€Œæ±šãã—ã¦ã„ã„å ´æ‰€ã€ã‚’ä½œã‚‰ãªã„ã®ãŒå¤§äº‹ğŸ’¡
â€»æœ€åˆã¯ãƒ•ã‚©ãƒ«ãƒ€ã ã‘ã§ã‚‚OKã ã‚ˆğŸ“âœ¨

### âœ… ãƒ«ãƒ¼ãƒ«3ï¼šå¤§äº‹ãªãƒ­ã‚¸ãƒƒã‚¯ã«ã¯**è¶…ãƒŸãƒ‹ãƒ†ã‚¹ãƒˆ**ã‚’ç½®ã ğŸ§ªğŸ§¸

![ddd cs study 008 small test](./picture/ddd_cs_study_008_small_test.png)

* â€œä¾¡æ ¼è¨ˆç®—â€ã¨ã‹â€œãƒ«ãƒ¼ãƒ«â€ã ã‘ãƒ†ã‚¹ãƒˆã™ã‚‹
* DBã‚„ç”»é¢ã¯å¾Œå›ã—ã§OK

ãƒ†ã‚¹ãƒˆãŒã‚ã‚‹ã¨ã€ã€Œç›´ã™ã€ãŒæ€–ããªããªã‚‹ã‚ˆğŸ˜Œâœ¨

---

## 8. 1äººé–‹ç™ºå‘ã‘ï¼š**ã€Œå¾Œã§ç›´ã™ã€ã‚’å°ã˜ã‚‹ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ** âœ…ğŸ§ 

![ddd cs study 008 checklist](./picture/ddd_cs_study_008_checklist.png)

æ–°æ©Ÿèƒ½ã‚’è¶³ã™å‰ã«ã€30ç§’ã ã‘ã“ã‚Œè¦‹ã‚‹ğŸ‘€âœ¨

* [ ] å¤‰æ•°åãŒã€Œaã€ã€Œtmpã€ã«ãªã£ã¦ãªã„ï¼ŸğŸ«£
* [ ] 1ã¤ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒâ€œ2ã¤ä»¥ä¸Šã®ã“ã¨â€ã—ã¦ãªã„ï¼ŸğŸ­
* [ ] `if` ãŒå¢—ãˆã™ãã¦ãªã„ï¼ŸğŸŒ¿
* [ ] åŒã˜å‡¦ç†ã‚’ã‚³ãƒ”ãƒšã—ã¦ãªã„ï¼ŸğŸ“‹
* [ ] â€œã“ã®ãƒ«ãƒ¼ãƒ«â€ã¯Domainã«ç½®ãã¹ãã˜ã‚ƒãªã„ï¼ŸğŸ§ 

å…¨éƒ¨ã‚„ã‚‰ãªãã¦OKï¼
**1å€‹ã ã‘ç›´ã—ã¦é€²ã‚€**ã®ãŒå‹ã¡ğŸ†âœ¨

---

## 9. AIã«é ¼ã‚€ã¨ãã®ã‚³ãƒ„ï¼šã„ããªã‚Šç›´ã•ã›ãªã„ ğŸ¤–ğŸ§¯

AIã«ãŠé¡˜ã„ã™ã‚‹ã¨ãã¯ã€ã“ã†ã™ã‚‹ã¨äº‹æ•…ãŒæ¸›ã‚‹ã‚ˆğŸ‘‡âœ¨

### ğŸ§¾ ãŠã™ã™ã‚ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ï¼‰

ï¼ˆãã®ã¾ã¾ã‚³ãƒ”ãƒšã§OKğŸ’–ï¼‰

```text
ã“ã®C#ã‚³ãƒ¼ãƒ‰ã‚’ãƒªãƒ•ã‚¡ã‚¯ã‚¿ã—ãŸã„ã§ã™ã€‚
ç›®çš„ï¼šå¯èª­æ€§ã‚’ä¸Šã’ã€å¤‰æ›´ã«å¼·ãã—ãŸã„ã€‚
åˆ¶ç´„ï¼š
- å¤–éƒ¨ã‹ã‚‰è¦‹ãŸæŒ¯ã‚‹èˆã„ï¼ˆä»•æ§˜ï¼‰ã‚’å¤‰ãˆãªã„
- ã¾ãšã€Œå£Šã‚Œã¦ãªã„ã“ã¨ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã®æœ€å°ãƒ†ã‚¹ãƒˆæ¡ˆã€ã‚’å‡ºã™
- å¤‰æ›´ã¯æ®µéšçš„ã«ï¼ˆ1ã‚¹ãƒ†ãƒƒãƒ—ãšã¤ï¼‰ææ¡ˆã—ã¦ã€å„ã‚¹ãƒ†ãƒƒãƒ—ã®æ„å›³ã‚‚èª¬æ˜ã—ã¦
- ã§ãã‚Œã° Domain/Application ã®å¢ƒç•Œã‚’æ„è­˜ã—ãŸåˆ†å‰²ã«ã—ã¦
å¯¾è±¡ã‚³ãƒ¼ãƒ‰ï¼š
ï¼ˆã“ã“ã«è²¼ã‚‹ï¼‰
```

ãƒã‚¤ãƒ³ãƒˆã¯ã€Œã¾ãšãƒ†ã‚¹ãƒˆã€ã€Œæ®µéšçš„ã€ğŸ§ªâ¡ï¸ğŸ§±âœ¨
ã“ã‚Œã ã‘ã§äº‹æ•…ç‡ãŒã‚°ãƒƒã¨ä¸‹ãŒã‚‹ã‚ˆã€œğŸ™Œ

---

## 10. ãƒŸãƒ‹æ¼”ç¿’ï¼šã‚ãªãŸã®ã‚³ãƒ¼ãƒ‰ã§â€œå¾Œã§ç›´ã™â€ã‚’å’æ¥­ ğŸ“ğŸ§¹âœ¨

éå»ã®è‡ªä½œã‚³ãƒ¼ãƒ‰ã‹ã‚‰ã€æ¬¡ã®ã©ã‚Œã‹ã‚’1ã¤é¸ã‚“ã§ã­ğŸ‘‡

* `if` ãŒå¤šã„ãƒ¡ã‚½ãƒƒãƒ‰ğŸŒ¿
* å¤‰æ•°åãŒã‚ã„ã¾ã„ãªå ´æ‰€ğŸ«¥
* ã‚³ãƒ”ãƒšãŒã‚ã‚‹å ´æ‰€ğŸ“‹

ãã—ã¦ã‚„ã‚‹ã“ã¨ã¯ã“ã‚Œã ã‘ï¼

1. **ãã®å‡¦ç†ã®â€œæœŸå¾…ã™ã‚‹çµæœâ€ã‚’3ã¤æ›¸ã**ğŸ“
   ï¼ˆä¾‹ï¼šGoldãªã‚‰10%å¼•ãã€ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ãªã‚‰ã•ã‚‰ã«20%å¼•ãâ€¦ï¼‰
2. AIã«ã€Œæœ€å°ãƒ†ã‚¹ãƒˆæ¡ˆã€ã‚’å‡ºã•ã›ã‚‹ğŸ§ª
3. ç›´ã™ã®ã¯ **1å›ã§1ã‹æ‰€ã ã‘**ğŸ§¹âœ¨

æˆåŠŸã—ãŸã‚‰ã€ã‚ãªãŸã¯ã‚‚ã†
ã€Œå¾Œã§ç›´ã™ã€ã˜ã‚ƒãªãã¦ **ã€Œé€²ã¿ãªãŒã‚‰æ•´ãˆã‚‹ã€äºº**ã ã‚ˆğŸ’–ğŸ‰

---

å¿…è¦ãªã‚‰ã€ã“ã®ç¬¬8ç« ã«åˆã‚ã›ã¦ã€Œã‚ãªãŸãŒä½œã£ã¦ã‚‹ã‚¢ãƒ—ãƒªã®ä¾‹ã€ã§ã€**â€œæ±šãè‚²ã¤ãƒ‘ã‚¿ãƒ¼ãƒ³â€â†’â€œå°ã•ãæ•´ãˆã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³â€**ã‚’å…·ä½“çš„ã«ä½œã£ã¦ä¸€ç·’ã«ç·´ç¿’ã§ãã‚‹ã‚ˆğŸ˜Šâœ¨
ï¼ˆã‚³ãƒ¼ãƒ‰è²¼ã£ã¦ãã‚ŒãŸã‚‰ã€ãã®å ´ã§æ•™æåŒ–ã‚‚ã§ãã‚‹ğŸ“šğŸ’ªï¼‰
