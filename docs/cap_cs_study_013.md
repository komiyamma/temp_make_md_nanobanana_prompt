# ç¬¬13ç« ï¼šåŒæœŸã¨éåŒæœŸã®åˆ†ã‘æ–¹ï¼ˆè¿·ã£ãŸã‚‰ã“ã“ï¼‰ğŸ”€ğŸ“¬

## ã“ã®ç« ã§ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã“ã¨ğŸ¯âœ¨

* ã€ŒåŒæœŸã§è¿”ã™ã¹ãã“ã¨ã€ã¨ã€ŒéåŒæœŸã«é€ƒãŒã™ã¹ãã“ã¨ã€ã‚’ã€**UXã¨å¤±æ•—ãƒ‘ã‚¿ãƒ¼ãƒ³**ã§åˆ¤æ–­ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ğŸ˜Š
* ã€Œæ³¨æ–‡APIã€ã®ä¸­èº«ã‚’ã€**åŒæœŸãƒ‘ã‚¹ï¼ˆçŸ­ãï¼‰**ã¨**éåŒæœŸãƒ‘ã‚¹ï¼ˆå¼·ãï¼‰**ã«åˆ†ã‘ã¦è¨­è¨ˆã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ğŸ’ª
* 2026æ™‚ç‚¹ã® .NET 10ï¼ˆLTSï¼‰ã§ã€**æœ€å°ã®â€œç–‘ä¼¼ã‚­ãƒ¥ãƒ¼ï¼‹ãƒ¯ãƒ¼ã‚«ãƒ¼â€**ã‚’å‹•ã‹ã—ã¦ä½“æ„Ÿã§ãã‚‹â˜•ğŸ§ª ([Microsoft][1])

---

## ã¾ãšè¶…å¤§äº‹ï¼šã“ã“ã§è¨€ã†ã€ŒåŒæœŸ/éåŒæœŸã€ã£ã¦ä½•ï¼ŸğŸ§ ğŸ’¡

![cap_cs_study_013_phone_vs_mail](./picture/cap_cs_study_013_phone_vs_mail.png)

![cap_cs_study_013_sync_async_call](./picture/cap_cs_study_013_sync_async_call.png)

ã“ã®ç« ã®ã€ŒéåŒæœŸã€ã¯ã€C# ã® async/awaitï¼ˆåŒã˜ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’å¾…ãŸãšã«é€²ã‚ã‚‹ã‚„ã¤ï¼‰**ã ã‘ã®è©±ã˜ã‚ƒãªã„**ã‚ˆğŸ™…â€â™€ï¸
ã“ã“ã§æ‰±ã†ã®ã¯ **â€œã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆã¨ã—ã¦ã®åŒæœŸ/éåŒæœŸâ€**ğŸ‘‡

* **åŒæœŸï¼ˆSyncï¼‰**ï¼šãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæ¥ãŸã‚‰ã€ãã®å ´ã§å‡¦ç†ã—ã¦çµæœã‚’è¿”ã™ï¼ˆå‘¼ã³å‡ºã—å…ƒã¯å¾…ã¤ï¼‰â±ï¸
* **éåŒæœŸï¼ˆAsyncï¼‰**ï¼šã„ã£ãŸã‚“å—ã‘ä»˜ã‘ã¦ã™ãè¿”ã™ã€‚é‡ã„å‡¦ç†ã¯å¾Œã§ã‚„ã‚‹ï¼ˆçµæœã¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç…§ä¼šã‚„é€šçŸ¥ã§çŸ¥ã‚‹ï¼‰ğŸ“¨

åˆ†æ•£ã‚·ã‚¹ãƒ†ãƒ ã§ã¤ã‚‰ã„ã®ã¯ã€**ãƒãƒƒãƒˆãŒåˆ‡ã‚Œã‚‹/é…ã„/é †ç•ªãŒã‚ºãƒ¬ã‚‹/é‡è¤‡ã™ã‚‹**ãŒæ™®é€šã«èµ·ãã‚‹ã“ã¨ğŸ˜µâ€ğŸ’«
ã ã‹ã‚‰ã€Œå…¨éƒ¨åŒæœŸã§ã¤ãªãã€ã¯ã€æ„å¤–ã¨ç°¡å˜ã«è©°ã‚€â€¦ğŸ’¥

---

## è¿·ã£ãŸã‚‰ã“ã®â€œè³ªå•ãƒªã‚¹ãƒˆâ€ã§æ±ºã‚ã‚‹âœ…ğŸ“

```mermaid
flowchart TD
    A[å‡¦ç†ã®æ€§è³ªã‚’ãƒã‚§ãƒƒã‚¯] --> B{ä»Šã™ãã®ç¢ºå®šãŒ<br/>çµ¶å¯¾ã«å¿…è¦?}
    B -- Yes --> C{å¤±æ•—ã—ã¦ã‚‚<br/>ã‚ã¨ã§ç›´ã›ã‚‹?}
    C -- No --> D[åŒæœŸãƒ‘ã‚¹âœ…<br/>çŸ­ã/é€Ÿã!]
    C -- Yes --> E{å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã«<br/>ä¾å­˜ã—ã¦ã„ã‚‹?}
    
    B -- No --> F[éåŒæœŸãƒ‘ã‚¹ğŸ“¨<br/>å¾Œã§é€šçŸ¥/åæ˜ ]
    E -- Yes --> F
    E -- No --> D
    
    F --> G[202 Accepted + çŠ¶æ…‹ç…§ä¼š]
```


åŒæœŸã«ã™ã‚‹ã‹éåŒæœŸã«ã™ã‚‹ã‹ã¯ã€æŠ€è¡“ã˜ã‚ƒãªãã¦ **ã€Œä»•æ§˜ï¼‹UXã€**ã§æ±ºã¾ã‚‹ã‚ˆğŸŒ¸

### â‘  ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯â€œä»Šã“ã®ç¬é–“ã®ç¢ºå®šâ€ãŒå¿…è¦ï¼ŸğŸ‘€

* å¿…è¦ â†’ åŒæœŸå¯„ã‚Šï¼ˆä¾‹ï¼šå…¥åŠ›ãƒŸã‚¹ã€åœ¨åº«ãŒçµ¶å¯¾å¿…è¦ãªæœ€å¾Œã®1å€‹ãªã©ï¼‰
* ãã“ã¾ã§ã˜ã‚ƒãªã„ â†’ éåŒæœŸå¯„ã‚Šï¼ˆä¾‹ï¼šé€šçŸ¥é€ä¿¡ã€é›†è¨ˆåæ˜ ï¼‰

### â‘¡ å¤±æ•—ã—ãŸã‚‰â€œã‚ã¨ã§å–ã‚Šæ¶ˆã›ã‚‹/ã‚„ã‚Šç›´ã›ã‚‹â€ï¼Ÿâ†©ï¸

* ã§ãã‚‹ï¼ˆè£œå„Ÿã§ãã‚‹ï¼‰â†’ éåŒæœŸã«ã—ã‚„ã™ã„
* ã§ããªã„ï¼ˆæˆ»ã›ãªã„ï¼‰â†’ åŒæœŸã§ç¢ºå®Ÿã«æ±ºã‚ãŸã„

### â‘¢ ãã®å‡¦ç†ã€é…ã„/ä¸å®‰å®šãªå¤–éƒ¨ã«ä¾å­˜ã—ã¦ã‚‹ï¼ŸğŸŒ©ï¸

* ä¾å­˜ã—ã¦ã‚‹ â†’ åŒæœŸã«å…¥ã‚Œã‚‹ã»ã©ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆåœ°ç„ã«ãªã‚Šã‚„ã™ã„ğŸ¥²
  â†’ éåŒæœŸã§éš”é›¢ã—ã‚„ã™ã„

### â‘£ â€œä»Šã™ãè¿”ã™â€ãŸã‚ã«ã€ä½•ã‚’æœ€å°ã«ã™ã¹ãï¼Ÿâœ‚ï¸

åŒæœŸãƒ‘ã‚¹ã¯ **çŸ­ããƒ»å°‘ãªããƒ»é€Ÿã**ãŒæ­£ç¾©ğŸƒâ€â™€ï¸ğŸ’¨
å¾Œã§ã‚„ã‚Œã‚‹ã‚‚ã®ã¯å¾Œã§ã‚„ã‚‹ï¼

### â‘¤ åˆ†æ–­ï¼ˆPï¼‰ãŒèµ·ããŸã‚‰ã©ã†ã™ã‚‹ï¼ŸğŸ“¡

* åŒæœŸã§å¼·ãã¤ãªãã»ã©ã€Œè¿”ã›ãªã„ï¼æ­¢ã¾ã‚‹ã€ã«ãªã‚Šã‚„ã™ã„ï¼ˆAãŒè½ã¡ã‚‹ï¼‰
* éåŒæœŸã«é€ƒãŒã™ã»ã©ã€Œå—ã‘ä»˜ã‘ã‚‹ï¼æ­¢ã¾ã‚Šã«ãã„ã€ã«ãªã‚Šã‚„ã™ã„ï¼ˆAã‚’å®ˆã‚Œã‚‹ï¼‰

---

## CampusCafeï¼ˆå­¦é£Ÿãƒ¢ãƒã‚¤ãƒ«ã‚ªãƒ¼ãƒ€ãƒ¼ï¼‰ã§ç·šå¼•ãã—ã¦ã¿ã‚ˆâ˜•ğŸ°ğŸ“±

### ä¾‹ï¼šæ³¨æ–‡ï¼ˆPlace Orderï¼‰ã§ã‚ˆãã‚ã‚‹â€œã‚„ã‚ŠãŸã„ã“ã¨â€

1. å…¥åŠ›ãƒã‚§ãƒƒã‚¯ï¼ˆå•†å“ã‚ã‚‹ï¼Ÿæ•°é‡ãŠã‹ã—ã„ï¼Ÿï¼‰
2. æ³¨æ–‡ã®å—ä»˜ï¼ˆæ³¨æ–‡ç•ªå·ç™ºè¡Œï¼‰
3. åœ¨åº«ã®ç¢ºä¿ï¼ˆå¸­æ•°ãƒ»å€‹æ•°ã®ç¢ºä¿ï¼‰
4. æ±ºæ¸ˆï¼ˆå¤–éƒ¨æ±ºæ¸ˆï¼‰
5. é€šçŸ¥ï¼ˆå¨æˆ¿ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ï¼‰

### ã“ã“ã§ã®ãŠã™ã™ã‚ç·šå¼•ãï¼ˆåŸºæœ¬å½¢ï¼‰ğŸ›ï¸âœ¨

![cap_cs_study_013_sync_async_table](./picture/cap_cs_study_013_sync_async_table.png)

| å‡¦ç†           | åŒæœŸ/éåŒæœŸ         | ç†ç”±            | ç”»é¢ã®è¦‹ã›æ–¹ï¼ˆUXï¼‰   |
| ------------ | -------------- | ------------- | ------------ |
| å…¥åŠ›ãƒã‚§ãƒƒã‚¯       | åŒæœŸâœ…            | ãã®å ´ã§ç›´ã—ã¦ã»ã—ã„    | ã€Œå…¥åŠ›ã‚¨ãƒ©ãƒ¼ã€ã‚’å³è¿”ã™  |
| æ³¨æ–‡å—ä»˜ï¼ˆæ³¨æ–‡IDç™ºè¡Œï¼‰ | åŒæœŸâœ…            | â€œå—ã‘ä»˜ã‘ãŸâ€ã¯ã™ãè¿”ã›ã‚‹ | ã€Œå—ä»˜å®Œäº†ï¼šæº–å‚™ä¸­ã€   |
| åœ¨åº«ç¢ºä¿         | éåŒæœŸğŸ“¨ï¼ˆå ´åˆã«ã‚ˆã‚ŠåŒæœŸï¼‰ | ç«¶åˆãƒ»é…å»¶ãŒèµ·ãã‚„ã™ã„   | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€Œåœ¨åº«ç¢ºèªä¸­ã€ |
| æ±ºæ¸ˆ           | éåŒæœŸğŸ“¨ï¼ˆãŸã ã—æ³¨æ„ï¼‰   | å¤–éƒ¨ãŒé…ã„/è½ã¡ã‚‹     | ã€Œæ±ºæ¸ˆå‡¦ç†ä¸­ã€â†’å®Œäº†é€šçŸ¥ |
| é€šçŸ¥           | éåŒæœŸğŸ“¨          | å¤±æ•—ã—ã¦ã‚‚å†é€ã§ãã‚‹    | å¾Œã§å±Šãï¼ˆå†é€OKï¼‰   |

ğŸ’¡ãƒã‚¤ãƒ³ãƒˆï¼šåŒæœŸã§â€œå®Œäº†â€ã¾ã§æ±‚ã‚ã‚‹ã¨ã€**å¤–éƒ¨ãŒé…ã„ã ã‘ã§æ³¨æ–‡ãŒé€šã‚‰ãªã„**ã«ãªã‚ŠãŒã¡ğŸ˜‡
ã¾ãšã¯ã€Œå—ä»˜ã€ã¾ã§åŒæœŸã§è¿”ã—ã¦ã€æ®‹ã‚Šã‚’éåŒæœŸã§å …ãã™ã‚‹ã®ãŒåˆ†æ•£ã§ã¯å¼·ã„ã‚ˆğŸ’ªâœ¨

---

## APIã®å½¢ï¼šéåŒæœŸã‚’â€œã¡ã‚ƒã‚“ã¨APIã¨ã—ã¦è¡¨ç¾â€ã™ã‚‹ğŸ“®

![cap_cs_study_013_accepted_ticket](./picture/cap_cs_study_013_accepted_ticket.png)

éåŒæœŸã«ã—ãŸã„ãªã‚‰ã€HTTPçš„ã«ã¯ã“ã®å½¢ãŒå®šç•ªğŸ‘‡

* **202 Accepted**ï¼šå—ã‘ä»˜ã‘ãŸã‘ã©ã€å‡¦ç†ã¯ã¾ã çµ‚ã‚ã£ã¦ãªã„ã‚ˆğŸ™†â€â™€ï¸
* **çŠ¶æ…‹ã‚’è¦‹ã‚‹URLï¼ˆLocationã‚„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹APIï¼‰**ï¼šã‚ã¨ã§çŠ¶æ³ã‚’è¦‹ã«è¡Œã‘ã‚‹ğŸ‘€

Microsoftã®APIè¨­è¨ˆã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ã§ã‚‚ã€æ™‚é–“ãŒã‹ã‹ã‚‹å‡¦ç†ã¯ 202 ã‚’è¿”ã™ã®ãŒæ¨å¥¨ã•ã‚Œã¦ã‚‹ã‚ˆğŸ“˜âœ¨ ([Microsoft Learn][2])

---

## ãƒŸãƒ‹æ¼”ç¿’â‘ ï¼šæ³¨æ–‡APIã®ä¸­ã§ã€ŒåŒæœŸ/éåŒæœŸã€ã‚’ç·šå¼•ãã—ã‚ˆğŸ§©âœï¸

![cap_cs_study_013_drag_drop_exercise](./picture/cap_cs_study_013_drag_drop_exercise.png)

æ¬¡ã®è³ªå•ã«ç­”ãˆã¦ã€ç·šå¼•ãã—ã¦ã¿ã¦ã­ğŸ˜Š

### å•1ï¼šåŒæœŸã«æ®‹ã™â€œæœ€å°ã‚»ãƒƒãƒˆâ€ã¯ã©ã‚Œï¼Ÿâœ…

* A. å…¥åŠ›ãƒã‚§ãƒƒã‚¯ï¼‹æ³¨æ–‡IDç™ºè¡Œ
* B. ã•ã‚‰ã«åœ¨åº«ç¢ºä¿ã¾ã§
* C. æ±ºæ¸ˆã¾ã§å…¨éƒ¨
  ï¼ˆãŠã™ã™ã‚ã¯ A ã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆã—ã‚„ã™ã„ã‚ˆâ˜•ï¼‰

### å•2ï¼šéåŒæœŸã«ã—ãŸå‡¦ç†ã®â€œçµæœã®ä¼ãˆæ–¹â€ã¯ï¼ŸğŸ“£

* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç…§ä¼šï¼ˆæ³¨æ–‡è©³ç´°ã§ã€Œå‡¦ç†ä¸­/æˆåŠŸ/å¤±æ•—ã€ï¼‰
* ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥
* ãƒ¡ãƒ¼ãƒ«ï¼ˆå­¦å†…ãªã‚‰ã‚„ã‚‰ãªã„ã‹ã‚‚ï¼‰

### å•3ï¼šå¤±æ•—ã—ãŸã‚‰ã©ã†ã™ã‚‹ï¼ŸğŸ˜µâ€ğŸ’«

* åœ¨åº«ç¢ºä¿å¤±æ•— â†’ æ³¨æ–‡ã‚’ã€Œå¤±æ•—ã€ã«ã—ã¦ç†ç”±ã‚’è¡¨ç¤º
* æ±ºæ¸ˆå¤±æ•— â†’ æ³¨æ–‡ã‚’ã€Œå¤±æ•—ã€ã«ã—ã¦å†è©¦è¡Œå°ç·šï¼ˆã¾ãŸã¯è‡ªå‹•å†è©¦è¡Œï¼‰

---

## ãƒãƒ³ã‚ºã‚ªãƒ³ï¼šæœ€å°ã®â€œåŒæœŸå—ä»˜ï¼‹éåŒæœŸå‡¦ç†â€ã‚’å‹•ã‹ã™ğŸ§ªâœ¨

![cap_cs_study_013_architecture_flow](./picture/cap_cs_study_013_architecture_flow.png)

ã“ã“ã§ã¯ã€**æœ¬ç‰©ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ–ãƒ­ãƒ¼ã‚«ãƒ¼ã®ä»£ã‚ã‚Šã«**ã€.NETã® Channel ã‚’ä½¿ã£ã¦ã€Œç–‘ä¼¼ã‚­ãƒ¥ãƒ¼ã€ã‚’ä½œã‚‹ã‚ˆğŸ“¬
Channel ã¯ã€Œç”Ÿç”£è€…â†’æ¶ˆè²»è€…ã¸ã€éåŒæœŸã«ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™ã€ãŸã‚ã®ä»•çµ„ã¿ã ã‚ˆğŸ“¦âœ¨ ([Microsoft Learn][3])

ãƒ¯ãƒ¼ã‚«ãƒ¼ã¯ BackgroundService ã§å‹•ã‹ã™ã‚ˆï¼ˆé•·ãå‹•ããƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å‡¦ç†ã®åŸºæœ¬ï¼‰ğŸš¶â€â™€ï¸ğŸ” ([Microsoft Learn][4])

> ç›®æ¨™ï¼šPOST ã—ãŸç›´å¾Œã¯ã€ŒPendingã€ã§è¿”ã£ã¦ãã¦ã€å°‘ã—å¾…ã¤ã¨ã€ŒCompletedã€ã«ãªã‚‹ã®ã‚’ä½“æ„Ÿã™ã‚‹â³ğŸ‰

### 1) ã‚³ãƒ¼ãƒ‰ï¼ˆ1ãƒ•ã‚¡ã‚¤ãƒ«ã§OKï¼‰ğŸ“„âœ¨

ãƒ•ã‚¡ã‚¤ãƒ«ã€ŒProgram.csã€ã‚’ã“ã‚Œã«ã™ã‚‹ã‚ˆğŸ‘‡

```csharp
using System.Collections.Concurrent;
using System.Threading.Channels;
using Microsoft.AspNetCore.Http.HttpResults;
using Microsoft.Extensions.Hosting;

var builder = WebApplication.CreateBuilder(args);

builder.Services.AddEndpointsApiExplorer();
builder.Services.AddSwaggerGen();

// ã‹ã‚“ãŸã‚“DBï¼ˆæœ¬å½“ã¯DBã‚’ä½¿ã†ã‚ˆï¼ï¼‰
var orders = new ConcurrentDictionary<Guid, Order>();

// ç–‘ä¼¼ã‚­ãƒ¥ãƒ¼ï¼ˆç”Ÿç”£è€…: API / æ¶ˆè²»è€…: ãƒ¯ãƒ¼ã‚«ãƒ¼ï¼‰
var channel = Channel.CreateUnbounded<OrderWorkItem>();
builder.Services.AddSingleton(channel);

// ãƒ¯ãƒ¼ã‚«ãƒ¼ç™»éŒ²
builder.Services.AddHostedService(sp => new OrderWorker(
    sp.GetRequiredService<Channel<OrderWorkItem>>(),
    orders
));

var app = builder.Build();

app.UseSwagger();
app.UseSwaggerUI();

app.MapPost("/orders", (CreateOrderRequest req) =>
{
    // âœ… åŒæœŸã§ã‚„ã‚‹ï¼šå…¥åŠ›ãƒã‚§ãƒƒã‚¯ï¼ˆæœ€å°ï¼ï¼‰
    if (req.Items is null || req.Items.Count == 0)
        return Results.BadRequest(new { message = "å•†å“ã‚’1ã¤ä»¥ä¸Šå…¥ã‚Œã¦ã­ğŸ°" });

    if (req.Items.Any(x => x.Quantity <= 0))
        return Results.BadRequest(new { message = "æ•°é‡ã¯1ä»¥ä¸Šã«ã—ã¦ã­ğŸ´" });

    // âœ… åŒæœŸã§ã‚„ã‚‹ï¼šæ³¨æ–‡IDç™ºè¡Œï¼†å—ä»˜ä¿å­˜ï¼ˆæœ€å°ï¼ï¼‰
    var id = Guid.NewGuid();
    var order = new Order(
        Id: id,
        Status: OrderStatus.Pending,
        CreatedAtUtc: DateTime.UtcNow,
        Message: "å—ä»˜ã—ãŸã‚ˆï¼ã“ã‚Œã‹ã‚‰æº–å‚™ã™ã‚‹ã­â˜•âœ¨"
    );

    orders[id] = order;

    // ğŸ“© éåŒæœŸã«é€ƒãŒã™ï¼šåœ¨åº«ç¢ºä¿ãƒ»æ±ºæ¸ˆãƒ»é€šçŸ¥ï¼ˆä»Šå›ã¯ç–‘ä¼¼ï¼‰
    channel.Writer.TryWrite(new OrderWorkItem(id));

    // âœ… éåŒæœŸAPIã®å®šç•ªï¼š202 Accepted + çŠ¶æ…‹ç¢ºèªURL
    return Results.Accepted($"/orders/{id}", new { id, status = order.Status.ToString() });
});

app.MapGet("/orders/{id:guid}", (Guid id) =>
{
    if (!orders.TryGetValue(id, out var order))
        return Results.NotFound(new { message = "ãã®æ³¨æ–‡ã¯è¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸã‚ˆğŸ¥²" });

    return Results.Ok(order);
});

app.Run();

record CreateOrderRequest(List<OrderItem> Items);
record OrderItem(string MenuId, int Quantity);

enum OrderStatus
{
    Pending,
    Processing,
    Completed,
    Failed
}

record Order(Guid Id, OrderStatus Status, DateTime CreatedAtUtc, string Message);

record OrderWorkItem(Guid OrderId);

sealed class OrderWorker : BackgroundService
{
    private readonly Channel<OrderWorkItem> _channel;
    private readonly ConcurrentDictionary<Guid, Order> _orders;
    private readonly Random _random = new();

    public OrderWorker(Channel<OrderWorkItem> channel, ConcurrentDictionary<Guid, Order> orders)
    {
        _channel = channel;
        _orders = orders;
    }

    protected override async Task ExecuteAsync(CancellationToken stoppingToken)
    {
        await foreach (var work in _channel.Reader.ReadAllAsync(stoppingToken))
        {
            if (!_orders.TryGetValue(work.OrderId, out var current))
                continue;

            _orders[work.OrderId] = current with
            {
                Status = OrderStatus.Processing,
                Message = "åœ¨åº«ç¢ºèªï¼†æ±ºæ¸ˆä¸­ã ã‚ˆâ€¦ã¡ã‚‡ã£ã¨å¾…ã£ã¦ã­â³ğŸ’³"
            };

            // ç–‘ä¼¼ï¼šå¤–éƒ¨ãŒé…ã„ä¸–ç•Œã‚’å†ç¾
            await Task.Delay(TimeSpan.FromSeconds(_random.Next(2, 6)), stoppingToken);

            // ç–‘ä¼¼ï¼šãŸã¾ã«å¤±æ•—ã•ã›ã‚‹ï¼ˆåˆ†æ•£ã®ãƒªã‚¢ãƒ«ğŸ˜‡ï¼‰
            var ok = _random.NextDouble() >= 0.2;

            _orders[work.OrderId] = ok
                ? current with { Status = OrderStatus.Completed, Message = "æ³¨æ–‡å®Œäº†ï¼å—ã‘å–ã‚Šã«æ¥ã¦ã­ğŸ‰ğŸ±" }
                : current with { Status = OrderStatus.Failed, Message = "ã”ã‚ã‚“ã­ã€å‡¦ç†ã«å¤±æ•—â€¦å†è©¦è¡Œã—ã¦ã­ğŸ¥²ğŸ”" };
        }
    }
}
```

### 2) å‹•ã‹ã—ã¦ç¢ºèªğŸ‘€âœ¨

* Swagger UI ã‚’é–‹ã
* POST /orders ã‚’å®Ÿè¡Œ
* è¿”ã£ã¦ããŸ id ã‚’ä½¿ã£ã¦ GET /orders/{id} ã‚’ä½•å›ã‹å©ã

æœ€åˆã¯ Pending â†’ Processing â†’ Completed / Failed ã£ã¦å¤‰ã‚ã‚‹ã¯ãšã ã‚ˆğŸ”ğŸ®

---

## ãƒŸãƒ‹æ¼”ç¿’â‘¡ï¼šåŒæœŸãƒ‘ã‚¹ã‚’ã‚‚ã£ã¨â€œçŸ­ãâ€ã—ã¦ã¿ã‚ˆâœ‚ï¸âš¡

æ¬¡ã®ã†ã¡ã€**åŒæœŸãƒ‘ã‚¹ã‹ã‚‰è¿½ã„å‡ºã—ãŸã„**ã®ã¯ã©ã‚Œï¼Ÿï¼ˆç†ç”±ã‚‚æ›¸ã„ã¦ã­ğŸ˜Šï¼‰

* (a) åœ¨åº«ç¢ºä¿
* (b) æ±ºæ¸ˆ
* (c) é€šçŸ¥
* (d) æ³¨æ–‡IDç™ºè¡Œ
* (e) å…¥åŠ›ãƒã‚§ãƒƒã‚¯

ğŸ’¡ãƒ’ãƒ³ãƒˆï¼šåŒæœŸãƒ‘ã‚¹ã¯ã€Œæœ€å°ã®å—ä»˜ã€ã ã‘ã«å¯„ã›ã‚‹ã¨ã€Pï¼ˆåˆ†æ–­ï¼‰ã«å¼·ããªã‚ŠãŒã¡ğŸ“¡ğŸ§±

---

## AIæ´»ç”¨ï¼ˆCopilot / Codexï¼‰ã§â€œç·šå¼•ããƒ¬ãƒ“ãƒ¥ãƒ¼â€ã—ã‚ˆğŸ¤–âœ…

ãã®ã¾ã¾è²¼ã£ã¦ä½¿ãˆã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹ã ã‚ˆğŸ’¬âœ¨

### 1) ç·šå¼•ããƒ¬ãƒ“ãƒ¥ãƒ¼ğŸ”€

* ã€ŒCampusCafeã®æ³¨æ–‡å‡¦ç†ã§ã€åŒæœŸã«æ®‹ã™ã¹ãå‡¦ç†ã¨éåŒæœŸã«å›ã™ã¹ãå‡¦ç†ã‚’ã€UXã¨å¤±æ•—æ™‚ã®è£œå„Ÿï¼ˆå–ã‚Šæ¶ˆã—/å†è©¦è¡Œï¼‰è¾¼ã¿ã§ææ¡ˆã—ã¦ã€

### 2) 202 Acceptedã®APIè¨­è¨ˆãƒ¬ãƒ“ãƒ¥ãƒ¼ğŸ“®

* ã€ŒéåŒæœŸå‡¦ç†ã®APIã¨ã—ã¦ã€202 Accepted ã¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å–å¾—ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®è¨­è¨ˆã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ã€‚ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹ã‚‚å‡ºã—ã¦ã€

### 3) åŒæœŸãƒ‘ã‚¹çŸ­ç¸®ã®ã‚¢ã‚¤ãƒ‡ã‚¢âš¡

* ã€Œã“ã®æ³¨æ–‡APIã®åŒæœŸãƒ‘ã‚¹ã‚’ 200ms ä»¥å†…ã‚’ç›®æ¨™ã«çŸ­ãã™ã‚‹ãªã‚‰ã€ã©ã‚“ãªåˆ†å‰²ï¼ˆéåŒæœŸåŒ–/ã‚­ãƒ£ãƒƒã‚·ãƒ¥/äº‹å‰è¨ˆç®—ï¼‰ãŒåŠ¹ãï¼Ÿã€

---

## ã‚ˆãã‚ã‚‹è½ã¨ã—ç©´ã‚ã‚‹ã‚ã‚‹ğŸ˜‡ğŸ•³ï¸

* **â€œå…¨éƒ¨åŒæœŸâ€ã§å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã‚’ç›´åˆ—ã«å‘¼ã¶** â†’ ã©ã‚Œã‹é…ã„ã ã‘ã§å…¨æ»…ğŸ’¥
* **éåŒæœŸã«ã—ãŸã®ã«ã€çµæœã®è¦‹ã›æ–¹ãŒãªã„** â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä¸å®‰ã§é€£æ‰“â†’é‡è¤‡åœ°ç„ğŸ“¨ğŸ“¨ğŸ“¨
* **éåŒæœŸã«é€ƒãŒã—ãŸã®ã«ã€å¤±æ•—æ™‚ã®æ‰±ã„ãŒæœªå®š** â†’ ã€Œå¤±æ•—ã—ãŸã‘ã©ä½•ã‚‚ã§ããªã„ã€ã«ãªã‚‹ğŸ¥²
* **â€œéåŒæœŸï¼è¨­è¨ˆãŒæ¥½â€ã¨æ€ã†** â†’ å®Ÿã¯å†ªç­‰æ€§ãƒ»é‡è¤‡ãƒ»é †åºãŒå¾Œã§åŠ¹ã„ã¦ãã‚‹ï¼ˆæ¬¡ã®ç« ã§å¼·ããªã‚‹ã‚ˆğŸ›¡ï¸ï¼‰

---

## ç†è§£ãƒã‚§ãƒƒã‚¯âœ…ğŸ“

### Q1ï¼šåŒæœŸã«å‘ã„ã¦ã‚‹ã®ã¯ã©ã£ã¡ï¼ŸğŸ¤”

* A. é€šçŸ¥é€ä¿¡
* B. å…¥åŠ›ãƒã‚§ãƒƒã‚¯ï¼ˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰

### Q2ï¼šéåŒæœŸAPIã§ã‚ˆãä½¿ã†ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ï¼ŸğŸ“®

* A. 200 OK
* B. 202 Accepted

### Q3ï¼šåŒæœŸãƒ‘ã‚¹ã®åˆè¨€è‘‰ã¯ï¼ŸğŸƒâ€â™€ï¸ğŸ’¨

* ã€ŒçŸ­ããƒ»å°‘ãªããƒ»é€Ÿãã€â†ã“ã‚Œè¨€ãˆãŸã‚‰å‹ã¡ğŸ‰

---

## ã¾ã¨ã‚âœ¨

* åŒæœŸ/éåŒæœŸã¯ã€ŒæŠ€è¡“ã€ã˜ã‚ƒãªã **UXï¼‹å¤±æ•—æ™‚ã®æ‰±ã„**ã§æ±ºã‚ã‚‹ã‚ˆğŸ˜Š
* åŒæœŸã¯â€œå—ä»˜ã‚’æœ€çŸ­ã§è¿”ã™â€ã®ãŒå¼·ã„âš¡
* éåŒæœŸã¯â€œçµæœã®ä¼ãˆæ–¹ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹/é€šçŸ¥ï¼‰â€ã¾ã§ã‚»ãƒƒãƒˆã§è¨­è¨ˆã™ã‚‹ğŸ“¬
* .NET 10ï¼ˆLTSï¼‰ã§ Minimal APIï¼‹BackgroundService ãªã‚‰ã€ä½“æ„Ÿã—ãªãŒã‚‰å­¦ã¹ã‚‹ã‚ˆğŸ§ªâœ¨ ([Microsoft][1])

[1]: https://dotnet.microsoft.com/en-us/platform/support/policy/dotnet-core?utm_source=chatgpt.com "NET and .NET Core official support policy"
[2]: https://learn.microsoft.com/en-us/azure/architecture/best-practices/api-design?utm_source=chatgpt.com "Best practices for RESTful web API design - Azure"
[3]: https://learn.microsoft.com/en-us/dotnet/core/extensions/channels?utm_source=chatgpt.com "Channels - .NET"
[4]: https://learn.microsoft.com/en-us/aspnet/core/fundamentals/host/hosted-services?view=aspnetcore-10.0&utm_source=chatgpt.com "Background tasks with hosted services in ASP.NET Core"
