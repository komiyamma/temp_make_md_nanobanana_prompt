# ç¬¬13ç« ï¼šãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•Œ è¶…å…¥é–€ï¼ˆ1å›ã§æ•´åˆã™ã‚‹ç¯„å›²ï¼‰ğŸ§ªğŸ“¦

## ã“ã®ç« ã§ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã“ã¨ğŸ¯âœ¨

* ã€Œãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•Œã€ã£ã¦ä½•ã‹ã‚’ã€**â€œå…¨éƒ¨æˆåŠŸ or å…¨éƒ¨ãªã‹ã£ãŸã“ã¨â€**ã®æ„Ÿè¦šã§èª¬æ˜ã§ãã‚‹ğŸ˜Š
* ãƒŸãƒ‹ECï¼ˆæ³¨æ–‡ğŸ›’ãƒ»åœ¨åº«ğŸ“¦ãƒ»æ”¯æ‰•ã„ğŸ’³ï¼‰ã§ã€**æˆåŠŸ/å¤±æ•—ã‚·ãƒŠãƒªã‚ª**ã‚’æ›¸ã‘ã‚‹âœï¸
* TypeScriptã§ã€**å¤±æ•—ã—ãŸã‚‰å…¨éƒ¨æˆ»ã‚‹**ã‚’ãƒŸãƒ‹å®Ÿè£…ã§ä½“é¨“ã§ãã‚‹ğŸ§ªğŸ”¥

---

## 13.1 ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•Œã£ã¦ãªã«ï¼ŸğŸ§±âš›ï¸

![Study Image](./picture/ab_tcb_ts_study_013_transaction.png)

ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•Œã¯ä¸€è¨€ã§ã„ã†ã¨â€¦

**ã€Œã“ã“ã‹ã‚‰ã“ã“ã¾ã§ã‚’â€œã²ã¨ã¾ã¨ã¾ã‚Šâ€ã¨ã—ã¦ã€æˆåŠŸãªã‚‰å…¨éƒ¨åæ˜ âœ…ï¼å¤±æ•—ãªã‚‰å…¨éƒ¨å–ã‚Šæ¶ˆã—â†©ï¸ ã™ã‚‹ç¯„å›²ã€**ã ã‚ˆã€œï¼ğŸ˜Šâœ¨

```mermaid
graph TD
    subgraph OK [æˆåŠŸæ™‚ âœ…]
        S1[æ“ä½œ1] --> S2[æ“ä½œ2] --> S3[æ“ä½œ3]
        S3 --> Final["å…¨éƒ¨åæ˜ ï¼ğŸ‰"]
    end
    
    subgraph NG [å¤±æ•—æ™‚ âŒ]
        F1[æ“ä½œ1] --> F2[æ“ä½œ2] -- "ã‚¨ãƒ©ãƒ¼!! ğŸ’¥" --> F3["(ä¸­æ–­)"]
        F3 --> Rollback["å…¨éƒ¨å–ã‚Šæ¶ˆã—ï¼â†©ï¸<br/>(æœ€åˆã«æˆ»ã‚‹)"]
    end
```

---
ãŸã¨ãˆã°ã€æ³¨æ–‡ç¢ºå®šã§ã“ã‚“ãªæ›´æ–°ãŒèµ·ãã‚‹ã‚ˆã­ğŸ‘‡

* æ³¨æ–‡ã‚’ä½œã‚‹ï¼ˆordersã«INSERTï¼‰ğŸ§¾
* æ³¨æ–‡æ˜ç´°ã‚’å…¥ã‚Œã‚‹ï¼ˆorder_itemsã«INSERTï¼‰ğŸ§º
* åœ¨åº«ã‚’æ¸›ã‚‰ã™ï¼ˆstockã‚’UPDATEï¼‰ğŸ“¦â¬‡ï¸

ã“ã®3ã¤ã®ã†ã¡ **1ã¤ã§ã‚‚å¤±æ•—ã—ãŸã‚‰**ã€ä¸­é€”åŠç«¯ã«ä¿å­˜ã•ã‚Œã‚‹ã¨äº‹æ•…ã‚‹ğŸ˜±ğŸ’¥
ã ã‹ã‚‰ã€Œã“ã®3ã¤ã¯åŒã˜é‹å‘½ï¼ˆã¾ã¨ã‚ã¦æˆåŠŸ/å¤±æ•—ï¼‰ã«ã—ã‚ˆã†ã­ã€ã£ã¦æ±ºã‚ã‚‹ã®ãŒå¢ƒç•Œã®è©±ï¼

---

## 13.2 ãƒŸãƒ‹ECã§ã€Œäº‹æ•…ã‚‹ä¸–ç•Œã€ã¨ã€Œå®ˆã‚‰ã‚ŒãŸä¸–ç•Œã€ğŸŒğŸ§¯

### äº‹æ•…ã‚‹ä¸–ç•Œï¼ˆãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•ŒãŒãªã„ï¼‰ğŸ˜±

![Study Image](./picture/ab_tcb_ts_study_013_partial_failure.png)

* æ³¨æ–‡ã¯ä½œã‚ŒãŸâœ…
* ã§ã‚‚åœ¨åº«æ›´æ–°ã§ã‚¨ãƒ©ãƒ¼ğŸ’¥
* çµæœï¼š**æ³¨æ–‡ã ã‘æ®‹ã‚‹**ï¼ˆåœ¨åº«ã¯æ¸›ã£ã¦ãªã„/æ˜ç´°ãŒæ¬ ã‘ã¦ã‚‹ ãªã©ï¼‰ğŸ§Ÿâ€â™€ï¸

ã“ã‚Œã€å¾Œã‹ã‚‰è¦‹ãŸäººãŒæ··ä¹±ã™ã‚‹ã‚„ã¤ã€œï¼
ã€Œæ³¨æ–‡ã‚ã‚‹ã®ã«æ˜ç´°ãªã„ã‚“ã ã‘ã©ï¼Ÿã€ã€Œå‡ºè·ã§ããªã„ã‚“ã ã‘ã©ï¼Ÿã€ã¿ãŸã„ãªâ€¦ğŸ˜‡

### å®ˆã‚‰ã‚ŒãŸä¸–ç•Œï¼ˆå¢ƒç•ŒãŒã‚ã‚‹ï¼‰ğŸ›¡ï¸âœ¨

![Study Image](./picture/ab_tcb_ts_study_013_rollback_rewind.png)

* é€”ä¸­ã§å¤±æ•—ã—ãŸã‚‰ **å…¨éƒ¨ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯â†©ï¸**
* ã€Œæ³¨æ–‡ã‚‚æ˜ç´°ã‚‚åœ¨åº«ã‚‚ã€æœ€åˆã‹ã‚‰ç„¡ã‹ã£ãŸã“ã¨ã€ã«ãªã‚‹
* ãƒ‡ãƒ¼ã‚¿ãŒå¸¸ã«â€œç­‹ãŒé€šã‚‹â€âœ…

SQLiteã‚‚ã€Œãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ï¼ACIDï¼ˆåŸå­æ€§ãªã©ï¼‰ã‚’æº€ãŸã™ã€ã“ã¨ã‚’å‰æã«èª¬æ˜ã—ã¦ã‚‹ã‚ˆã€‚([sqlite.org][1])

---

## 13.3 ACIDã‚’â€œè‚Œæ„Ÿè¦šâ€ã§è¦šãˆã‚‹ğŸ§ªï¼ˆç‰¹ã«AãŒè¶…å¤§äº‹ï¼ï¼‰âš›ï¸

![Study Image](./picture/ab_tcb_ts_study_013_acid_pillars.png)

ACIDã¯ã‚ˆãå‡ºã‚‹ã‘ã©ã€ã¾ãšã¯ã“ã®ãƒãƒªã§OKã ã‚ˆğŸ˜Šâœ¨

* **Aï¼ˆAtomicity / åŸå­æ€§ï¼‰âš›ï¸**
  â†’ **å…¨éƒ¨æˆåŠŸ or å…¨éƒ¨å¤±æ•—**ï¼ˆâ€œé€”ä¸­ã ã‘æˆåŠŸâ€ã¯ç¦æ­¢ğŸš«ï¼‰
* **Cï¼ˆConsistency / ä¸€è²«æ€§ï¼‰âœ…**
  â†’ ãƒ«ãƒ¼ãƒ«ï¼ˆåˆ¶ç´„ï¼‰ã‚’å£Šã•ãªã„ï¼ˆä¾‹ï¼šåœ¨åº«ã¯ãƒã‚¤ãƒŠã‚¹ä¸å¯ï¼‰
* **Iï¼ˆIsolation / åˆ†é›¢ï¼‰ğŸš§**
  â†’ åŒæ™‚å®Ÿè¡Œã§ã‚‚å¤‰ãªè¦‹ãˆæ–¹ã«ãªã‚‰ãªã„ï¼ˆã“ã“ã¯å¾Œã®ç« ã§æ·±æ˜ã‚Šã™ã‚‹ã‚ˆï¼‰
* **Dï¼ˆDurability / æ°¸ç¶šæ€§ï¼‰ğŸ’¾**
  â†’ ã‚³ãƒŸãƒƒãƒˆã—ãŸã‚‰è½ã¡ã¦ã‚‚æ®‹ã‚‹

SQLiteã¯ã€ŒAtomic / Consistent / Isolated / Durableã€ã‚’æº€ãŸã™èª¬æ˜ã‚’å…¬å¼ã§ã—ã¦ã‚‹ã‚ˆã€‚([sqlite.org][1])

---

## 13.4 DBã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã¯ã“ã®3ã¤ã§è¦šãˆã‚‹ğŸ”

![Study Image](./picture/ab_tcb_ts_study_013_director_cut.png)

SQLã®åŸºæœ¬ã¯ã“ã‚ŒğŸ‘‡

* `BEGIN`ï¼šãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³é–‹å§‹ğŸ¬
* `COMMIT`ï¼šæˆåŠŸï¼ç¢ºå®šï¼âœ…
* `ROLLBACK`ï¼šå¤±æ•—â€¦å–ã‚Šæ¶ˆã—â†©ï¸

SQLiteã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã‚‚ã€ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³æ–‡ï¼ˆBEGINãªã©ï¼‰ã‚’ã¾ã¨ã‚ã¦èª¬æ˜ã—ã¦ã‚‹ã‚ˆã€‚([sqlite.org][2])

```mermaid
flowchart TD
    Start["BEGIN (é–‹å§‹ğŸ¬)"] --> Process{å‡¦ç†ã„ã‚ã„ã‚}
    Process -- "å•é¡Œãªã—âœ…" --> Commit["COMMIT (ç¢ºå®šï¼âœ¨)"]
    Process -- "ã‚¨ãƒ©ãƒ¼ç™ºç”ŸğŸ’¥" --> Rollback["ROLLBACK (å–æ¶ˆâ†©ï¸)"]
    Commit --> End[çµ‚äº†]
    Rollback --> End
```

---

## 13.5 ã¾ãšã¯æ–‡ç« ã§ã€ŒæˆåŠŸ/å¤±æ•—ã€ã‚’æ›¸ã„ã¦ã¿ã‚ˆâœï¸ğŸ§ 

ã“ã“ã€ã‚ã¡ã‚ƒå¤§äº‹ï¼ã„ããªã‚Šã‚³ãƒ¼ãƒ‰ã‚ˆã‚Šå…ˆã« **â€œä½•ã‚’åŒã˜é‹å‘½ã«ã™ã‚‹ã‹â€**ã‚’è¨€è‘‰ã«ã™ã‚‹ã‚ˆğŸ˜Šâœ¨

### ãŠé¡Œï¼šæ³¨æ–‡ç¢ºå®šï¼ˆplaceOrderï¼‰ğŸ›’

æ¬¡ã®2ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ›¸ã„ã¦ã¿ã¦ğŸ‘‡ï¼ˆçŸ­ãã¦OKï¼ï¼‰

#### âœ… æˆåŠŸã‚·ãƒŠãƒªã‚ª

* åœ¨åº«ãŒè¶³ã‚Šã¦ã‚‹ğŸ“¦
* æ³¨æ–‡ã¨æ˜ç´°ã‚’ä¿å­˜ğŸ§¾
* åœ¨åº«ã‚’æ¸›ã‚‰ã™ğŸ“‰
* æ³¨æ–‡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’CONFIRMEDã«ã™ã‚‹âœ…

#### âŒ å¤±æ•—ã‚·ãƒŠãƒªã‚ªï¼ˆä¾‹ï¼šåœ¨åº«ä¸è¶³ï¼‰

* æ³¨æ–‡ã‚’ä½œã‚Šã‹ã‘ãŸğŸ§¾
* ã§ã‚‚åœ¨åº«ãŒè¶³ã‚Šãªã„ğŸ˜µ
* â†’ **æ³¨æ–‡ã‚‚æ˜ç´°ã‚‚åœ¨åº«æ¸›å°‘ã‚‚ã€å…¨éƒ¨ãªã‹ã£ãŸã“ã¨**â†©ï¸âœ¨

---

## 13.6 AIã§ Given-When-Then ã«æ•´å½¢ã—ã‚ˆğŸ¤–ğŸ§

æ–‡ç« ã‚’ãƒ†ã‚¹ãƒˆã£ã½ãã™ã‚‹ã¨ã€å¢ƒç•ŒãŒã‚¯ãƒªã‚¢ã«ãªã‚‹ã‚ˆã€œï¼ğŸ˜Š

AIã«ã“ã†ãŠé¡˜ã„ã—ã¦ã¿ã¦ğŸ‘‡

```text
æ¬¡ã®æ—¥æœ¬èªã‚·ãƒŠãƒªã‚ªã‚’ Given-When-Then å½¢å¼ã«ã—ã¦ã€‚
ã€ŒGivenã€ã¯å‰æã€ã€ŒWhenã€ã¯æ“ä½œã€ã€ŒThenã€ã¯æœŸå¾…çµæœã€‚
å¤±æ•—ã‚·ãƒŠãƒªã‚ªã¯ã€ŒThenã€ã«â€œãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã•ã‚Œã‚‹ï¼ˆéƒ¨åˆ†åæ˜ ãŒãªã„ï¼‰â€ã‚‚å¿…ãšå…¥ã‚Œã¦ã€‚

--- ã‚·ãƒŠãƒªã‚ª ---
ï¼ˆã“ã“ã«è‡ªåˆ†ã®æ–‡ç« ã‚’è²¼ã‚‹ï¼‰
```

ã§ãã‚ãŒã£ãŸ Given-When-Then ã¯ã€å¾Œã®ç« ã®ãƒ†ã‚¹ãƒˆã«ã‚‚ãã®ã¾ã¾ä½¿ãˆã‚‹ã‚ˆğŸ§ªâœ¨

---

## 13.7 ãƒãƒ³ã‚ºã‚ªãƒ³ï¼šå¤±æ•—ã—ãŸã‚‰å…¨éƒ¨æˆ»ã‚‹ã€ã‚’TypeScriptã§ä½“é¨“ğŸ§ªğŸ”¥

![Study Image](./picture/ab_tcb_ts_study_013_lab_experiment.png)

ä»Šå›ã¯ â€œä½“é¨“â€ ãŒç›®çš„ã ã‹ã‚‰ã€SQLiteã‚’è¶…å°ã•ãä½¿ã†ã‚ˆğŸ˜Š
ï¼ˆSQLiteãŒACIDãªãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’æä¾›ã™ã‚‹ã®ã¯å…¬å¼ã«èª¬æ˜ã•ã‚Œã¦ã‚‹ã‚ˆã€‚([sqlite.org][1])ï¼‰

### ä½¿ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼šbetter-sqlite3ğŸ“¦

* Node.js v14.21.1ä»¥é™ãŒå¿…è¦
* LTSå‘ã‘ã« prebuilt ãŒã‚ã‚‹ï¼ˆã¤ã¾ã‚Šå…¥ã‚Œã‚„ã™ã„ã“ã¨ãŒå¤šã„ï¼‰
* ES Modulesã®importä¾‹ã‚‚READMEã«è¼‰ã£ã¦ã‚‹ã‚ˆ([GitHub][3])

> Node.jsã¯LTSã‚’é¸ã¶ã¨å®‰å®šã—ã‚„ã™ã„ã‚ˆã€‚2026-01-27æ™‚ç‚¹ã®LTSãƒ©ã‚¤ãƒ³ã¯ v24 ç³»ã§æ¡ˆå†…ã•ã‚Œã¦ã‚‹ã‚ˆã€‚([Node.js][4])

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ğŸ“¥

```powershell
npm i better-sqlite3
npm i -D @types/better-sqlite3
```

### ã‚µãƒ³ãƒ—ãƒ«ï¼š`src/tx-demo.ts` ğŸ§ª

ã“ã®ã‚³ãƒ¼ãƒ‰ã®ãƒã‚¤ãƒ³ãƒˆã¯ã€Œ**ä¾‹å¤–ãŒæŠ•ã’ã‚‰ã‚ŒãŸã‚‰ã€å…¨éƒ¨ãªã‹ã£ãŸã“ã¨**ã€ã£ã¦ä½“é¨“ã™ã‚‹ã“ã¨ã ã‚ˆğŸ˜Šâœ¨
ï¼ˆ`CHECK(qty >= 0)` ã¿ãŸã„ãªåˆ¶ç´„ã§ â€œãŠã‹ã—ãªçŠ¶æ…‹â€ ã‚‚é˜²ã’ã‚‹ï¼âœ…ï¼‰

```ts
import Database from "better-sqlite3";

type Line = { sku: string; qty: number };

const db = new Database("tx-demo.db");

// WALã¯ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç†ç”±ã§æ¨å¥¨ã•ã‚Œã‚‹ã“ã¨ãŒå¤šã„ã‚ˆï¼ˆREADMEã§ã‚‚è§¦ã‚Œã¦ã‚‹ï¼‰ğŸ§ 
db.pragma("journal_mode = WAL");

db.exec(`
  PRAGMA foreign_keys = ON;

  CREATE TABLE IF NOT EXISTS stock (
    sku TEXT PRIMARY KEY,
    qty INTEGER NOT NULL CHECK(qty >= 0)
  );

  CREATE TABLE IF NOT EXISTS orders (
    id TEXT PRIMARY KEY,
    status TEXT NOT NULL
  );

  CREATE TABLE IF NOT EXISTS order_items (
    order_id TEXT NOT NULL,
    sku TEXT NOT NULL,
    qty INTEGER NOT NULL CHECK(qty > 0),
    PRIMARY KEY (order_id, sku),
    FOREIGN KEY(order_id) REFERENCES orders(id) ON DELETE CASCADE
  );
`);

db.prepare("INSERT OR IGNORE INTO stock(sku, qty) VALUES (?, ?)").run("APPLE", 3);

const placeOrder = db.transaction((orderId: string, lines: Line[]) => {
  db.prepare("INSERT INTO orders(id, status) VALUES (?, ?)").run(orderId, "CREATED");

  const getStock = db.prepare("SELECT qty FROM stock WHERE sku = ?");
  const decStock = db.prepare("UPDATE stock SET qty = qty - ? WHERE sku = ?");
  const insertItem = db.prepare(
    "INSERT INTO order_items(order_id, sku, qty) VALUES (?, ?, ?)"
  );

  for (const line of lines) {
    const row = getStock.get(line.sku) as { qty: number } | undefined;

    if (!row) throw new Error(`unknown sku: ${line.sku}`);
    if (row.qty < line.qty) throw new Error(`out of stock: ${line.sku} (${row.qty} < ${line.qty})`);

    decStock.run(line.qty, line.sku);
    insertItem.run(orderId, line.sku, line.qty);
  }

  db.prepare("UPDATE orders SET status = ? WHERE id = ?").run("CONFIRMED", orderId);
});

function dump() {
  const stock = db.prepare("SELECT * FROM stock").all();
  const orders = db.prepare("SELECT * FROM orders ORDER BY id").all();
  const items = db.prepare("SELECT * FROM order_items ORDER BY order_id, sku").all();

  console.log("stock:", stock);
  console.log("orders:", orders);
  console.log("items:", items);
  console.log("----");
}

console.log("âœ… success order");
placeOrder("O-1", [{ sku: "APPLE", qty: 2 }]);
dump();

console.log("âŒ failed order (should rollback)");
try {
  placeOrder("O-2", [{ sku: "APPLE", qty: 10 }]); // åœ¨åº«ä¸è¶³ã§ä¾‹å¤–
} catch (e) {
  console.log("error:", (e as Error).message);
}
dump();
```

### æœŸå¾…ã™ã‚‹è¦³å¯Ÿãƒã‚¤ãƒ³ãƒˆğŸ‘€âœ¨

* âœ… `O-1` ã¯ **orders ã¨ items ãŒå¢—ãˆã¦**ã€stock ãŒæ¸›ã‚‹
* âŒ `O-2` ã¯ **ä¾‹å¤–ãŒå‡ºã‚‹ã‘ã©**ã€orders ã« `O-2` ãŒæ®‹ã‚‰ãªã„ï¼ˆï¼ä¸­é€”åŠç«¯åæ˜ ãŒãªã„ï¼‰
* stock ã‚‚ `O-2` ã®ã›ã„ã§ã¯æ¸›ã£ã¦ãªã„

ã“ã‚ŒãŒã€Œãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•Œã€ã®ä½“é¨“ã ã‚ˆã€œï¼ğŸ§ªâš›ï¸

> ã¡ãªã¿ã« `better-sqlite3` ã®READMEã«ã¯ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«è¦ä»¶ã‚„ESM importä¾‹ã€WAL pragma ã®è©±ãŒè¼‰ã£ã¦ã‚‹ã‚ˆã€‚([GitHub][3])

---

## 13.8 ã‚ˆãã‚ã‚‹å‹˜é•ã„ãƒˆãƒƒãƒ—3ğŸ˜‡âš ï¸

### â‘  ã€Œtry/catchã™ã‚Œã°ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã¿ãŸã„ãªã‚‚ã‚“ã§ã—ã‚‡ï¼Ÿã€ğŸ™…â€â™€ï¸

![Study Image](./picture/ab_tcb_ts_study_013_catch_vs_rollback.png)

try/catch ã¯ â€œã‚¨ãƒ©ãƒ¼å‡¦ç†â€ ã§ã‚ã£ã¦ã€**DBã®æ›´æ–°ã‚’å·»ãæˆ»ã™åŠ›**ã¯ãªã„ã‚ˆã€œï¼
å·»ãæˆ»ã—ã¯ **BEGIN/ROLLBACK ã®ä¸–ç•Œ**ã€‚([sqlite.org][2])

### â‘¡ ã€Œå¤–éƒ¨APIå‘¼ã³å‡ºã—ã‚‚åŒã˜ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã§åŒ…ã‚ã°å®Œç’§ï¼ã€ğŸ™…â€â™€ï¸

å¤–éƒ¨APIã¯DBã¨é•ã£ã¦ **ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§ããªã„**ã“ã¨ãŒå¤šã„ã‚ˆğŸ˜µ
ã ã‹ã‚‰ã€Œå¢ƒç•Œã‚’ã©ã†è¨­è¨ˆã™ã‚‹ã‹ã€ãŒå¾Œã®ç« ã§è¶…å¤§äº‹ã«ãªã‚‹ï¼ˆã“ã“ã¯ä¼ç·šğŸ’£âœ¨ï¼‰

### â‘¢ ã€Œå¢ƒç•ŒãŒãƒ‡ã‚«ã„ã»ã©å®‰å…¨ï¼ã€ğŸ™…â€â™€ï¸

ãƒ‡ã‚«ã™ãã‚‹ã¨ãƒ­ãƒƒã‚¯/å¾…ã¡/è¡çªãŒå¢—ãˆãŒã¡ğŸ˜±
ã¾ãšã¯ **å¿…è¦æœ€å°**ã§è€ƒãˆã‚‹ã®ãŒã‚³ãƒ„ã ã‚ˆğŸ§ âœ¨

---

## 13.9 ãƒŸãƒ‹ã¾ã¨ã‚ğŸ§âœ¨

* ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•Œï¼**ã¾ã¨ã‚ã¦æˆåŠŸ/å¤±æ•—ã«ã™ã‚‹ç¯„å›²**ğŸ§±âš›ï¸
* DBã§ã¯ `BEGIN / COMMIT / ROLLBACK` ãŒåŸºæœ¬ğŸ”([sqlite.org][2])
* SQLiteã¯ACIDãªãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’æä¾›ã™ã‚‹å‰æã§èª¬æ˜ã•ã‚Œã¦ã‚‹âœ…([sqlite.org][1])
* å°ã•ã„å®Ÿè£…ã§ã‚‚ã€Œå¤±æ•—ã—ãŸã‚‰å…¨éƒ¨æˆ»ã‚‹ã€ã‚’ä½“é¨“ã™ã‚‹ã¨ä¸€æ°—ã«è…‘ã«è½ã¡ã‚‹ğŸ§ªğŸ”¥

---

## ç« æœ«ãƒã‚§ãƒƒã‚¯âœ…ğŸ“ï¼ˆ3å•ã ã‘ï¼ï¼‰

1. ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•Œã‚’ä¸€è¨€ã§ã„ã†ã¨ï¼ŸğŸ§±
2. æ³¨æ–‡ä½œæˆãƒ»æ˜ç´°ä½œæˆãƒ»åœ¨åº«æ¸›å°‘ã®ã†ã¡1ã¤å¤±æ•—ã—ãŸã‚‰ã€ä½•ãŒèµ·ãã‚‹ã¹ãï¼Ÿâ†©ï¸
3. `ROLLBACK` ã¯ä½•ã‚’ã™ã‚‹ï¼ŸğŸ”([sqlite.org][2])

[1]: https://www.sqlite.org/transactional.html?utm_source=chatgpt.com "SQLite Is Transactional"
[2]: https://www.sqlite.org/lang_transaction.html?utm_source=chatgpt.com "Transaction"
[3]: https://github.com/WiseLibs/better-sqlite3 "GitHub - WiseLibs/better-sqlite3: The fastest and simplest library for SQLite3 in Node.js."
[4]: https://nodejs.org/en/about/previous-releases "Node.js â€” Node.js Releases"
