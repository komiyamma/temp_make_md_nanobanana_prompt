# ç¬¬11ç« ï¼šæ•´åˆæ€§ãƒ¬ãƒ™ãƒ«â‘  Strong vs Eventual ğŸ§±ğŸ•Šï¸

**çµè«–1è¡Œâœï¸**ï¼š**Strongï¼ˆå¼·æ•´åˆï¼‰**ã¯ã€Œä»Šã“ã®ç¬é–“ã«å¿…ãšä¸€è‡´ã€ã‚’å®ˆã‚‹ä»£ã‚ã‚Šã«**é…ããªã‚ŠãŒã¡ï¼†åˆ†æ–­ã«å¼±ã„**ğŸ˜µâ€ğŸ’«ã€**Eventualï¼ˆæœ€çµ‚çš„æ•´åˆï¼‰**ã¯ã€Œã¾ãšè¿”äº‹ã—ã¦ã‚ã¨ã§ä¸€è‡´ã€ã§**é€Ÿã„ï¼†å¼·ã„**ã‘ã©**ã‚ºãƒ¬ãŒèµ·ãã‚‹**ã®ã§**UXã§æ”¯ãˆã‚‹**ğŸ¨â³

---

## 11.0 ã“ã®ç« ã§ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã“ã¨ ğŸ¯âœ¨

* Strong / Eventual ã‚’ **ã¾ãš2æŠã§èª¬æ˜**ã§ãã‚‹ğŸ—£ï¸ğŸ’¡
* ã€Œé€Ÿã„ã‘ã©ã‚ºãƒ¬ã‚‹ã€ã€Œé…ã„ã‘ã©ä¸€è‡´ã™ã‚‹ã€ã‚’ **æ‰‹å…ƒã®å®Ÿé¨“ã§ä½“æ„Ÿ**ã§ãã‚‹ğŸ§ªâš¡
* ã©ã£ã¡ã‚’é¸ã¶ã‹ã‚’ã€ŒãŠé‡‘ğŸ’¸ã€ã€Œæ³•å‹™âš–ï¸ã€ã€ŒUXğŸ˜Œã€ã§ã–ã£ãã‚Šåˆ¤æ–­ã§ãã‚‹âœ…

---

## 11.1 Strong ã¨ Eventual ã‚’â€œ1åˆ†ã§â€ã¤ã‹ã‚€ â±ï¸ğŸ§ 

### âœ… Strongï¼ˆå¼·æ•´åˆï¼‰ã£ã¦ï¼Ÿ

ã€Œæ›¸ã„ãŸã‚‰ã€**æ¬¡ã®èª­ã¿å–ã‚Šã§å¿…ãšãã®çµæœãŒè¦‹ãˆã‚‹**ã€ã‚’å¼·ãå®ˆã‚‹ã‚„ã¤ğŸ’ª
ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼šãƒ¬ã‚¸ã§ä¼šè¨ˆã—ãŸç¬é–“ã«ã€åœ¨åº«ãŒ**ã©ã®ç«¯æœ«ã§ã‚‚åŒã˜æ•°**ã«ãªã‚‹ğŸ§¾ğŸ“¦âœ¨

### âœ… Eventualï¼ˆæœ€çµ‚çš„æ•´åˆï¼‰ã£ã¦ï¼Ÿ

ã€Œæ›¸ã„ãŸç›´å¾Œã¯ã‚ºãƒ¬ã¦ã‚‚ã„ã„ã‘ã©ã€**æ™‚é–“ãŒãŸã¦ã°ä¸€è‡´ã™ã‚‹**ã€ã‚„ã¤ğŸ•Šï¸
ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼šä¼šè¨ˆã¯ã™ãçµ‚ã‚ã‚‹ã‘ã©ã€åœ¨åº«è¡¨ç¤ºãŒ**æ•°ç§’ã‚ã¨ã«è¿½ã„ã¤ã**â³ğŸ“¦

---

## 11.2 Strong ã¯ãªãœé…ããªã‚ŠãŒã¡ï¼Ÿï¼ˆè¶…ã–ã£ãã‚Šï¼‰ğŸ¢ğŸ’¥

ã¤ã¾ã‚Š Strong ã¯ã€**ä¸€è‡´ã®ä¿è¨¼ã®ã¶ã‚“ã€å¾…ã¡æ™‚é–“ãŒå¢—ãˆã‚‹** or **åˆ†æ–­æ™‚ã«æ­¢ã¾ã‚Šã‚„ã™ã„**ã®ãŒâ€œè‚Œæ„Ÿè¦šâ€ğŸŒâš–ï¸

![å¼·æ•´åˆæ€§ã®èª¿æ•´ï¼ˆã‚³ãƒ¼ãƒ‡ã‚£ãƒãƒ¼ã‚¿ãƒ¼ï¼‰](./picture/cap_ts_study_011_2pc_coordinator.png)

---

## 11.3 ã–ã£ãã‚Šæ¯”è¼ƒè¡¨ï¼ˆã¾ãšã“ã‚Œã ã‘è¦šãˆã‚ˆğŸ“Šâœ¨ï¼‰

| è¦³ç‚¹        | Strongï¼ˆå¼·æ•´åˆï¼‰ğŸ§±         | Eventualï¼ˆæœ€çµ‚çš„æ•´åˆï¼‰ğŸ•Šï¸      |
| --------- | --------------------- | ----------------------- |
| è¿”äº‹ã®é€Ÿã•     | é…ããªã‚ŠãŒã¡ğŸ¢              | é€Ÿã„ã“ã¨ãŒå¤šã„âš¡                |
| åˆ†æ–­/éšœå®³ã«å¼·ã„ï¼Ÿ | å¼±ããªã‚ŠãŒã¡ï¼ˆæ­¢ã‚ã‚‹/æ‹’å¦ã™ã‚‹ï¼‰ğŸ’¥    | å¼·ããªã‚ŠãŒã¡ï¼ˆå—ã‘ä»˜ã‘ã‚‹ï¼‰ğŸ›¡ï¸        |
| èª­ã¿å–ã‚Šã®æ–°ã—ã•  | ã„ã¤ã‚‚æ–°ã—ã„âœ¨               | å¤ã„èª­ã¿å–ã‚ŠãŒèµ·ãã‚‹ğŸ˜µâ€ğŸ’«         |
| å®Ÿè£…ã®é›£ã—ã•    | ä»•çµ„ã¿ãŒé‡ã„/è¤‡é›‘ã«ãªã‚ŠãŒã¡ğŸ§°      | UXãƒ»å†è©¦è¡Œãƒ»è¡çªãŒèª²é¡ŒğŸ¨ğŸ”        |
| å‘ã„ã¦ã‚‹æ‰€     | æ±ºæ¸ˆğŸ’³ã€æ®‹é«˜ğŸ’°ã€åœ¨åº«ã®ç¢ºä¿ï¼ˆå³å¯†ï¼‰ğŸ“¦ | ã„ã„ã­ğŸ‘ã€é–²è¦§æ•°ğŸ‘€ã€é€šçŸ¥ğŸ””ã€é›†è¨ˆğŸ“ˆ   |
| ä»£è¡¨çš„ãªâ€œã¤ã‚‰ã¿â€ | é…å»¶ãƒ»ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãƒ»å¯ç”¨æ€§ä½ä¸‹â³      | ç”»é¢ã«ã‚ºãƒ¬ãŒå‡ºã‚‹ï¼ˆã ã‹ã‚‰è¦‹ã›æ–¹å¤§äº‹ï¼‰ğŸ§‘â€ğŸ¨ |

---

# 11.4 ãƒãƒ³ã‚ºã‚ªãƒ³ï¼šStrongç‰ˆ/ Eventualç‰ˆã‚’ä½œã£ã¦â€œå·®â€ã‚’ä½“æ„Ÿã—ã‚ˆã† ğŸ§ªğŸ”¥

ã“ã“ã§ã¯ **ã€ŒWorkerï¼ä¸»ãƒ‡ãƒ¼ã‚¿ï¼ˆPrimaryï¼‰ã€**ã€**ã€ŒAPIï¼ãƒ¬ãƒ—ãƒªã‚«ï¼ˆReplicaï¼‰ã‚’æŒã£ã¦èª­ã‚€ã€** ã¿ãŸã„ãªå½¢ã§ä½œã‚‹ã‚ˆğŸ‘‘ğŸª
ï¼ˆç¾å®Ÿã®DBãã®ã¾ã¾ã§ã¯ãªã„ã‘ã©ã€â€œä½“æ„Ÿâ€ã«ã¯ååˆ†ï¼ï¼‰

## å…¨ä½“å›³ï¼ˆã–ã£ãã‚Šï¼‰ğŸ—ºï¸âœ¨

* Workerï¼šåœ¨åº«ã‚’ä¿æŒï¼ˆPrimaryï¼‰ğŸ“¦ğŸ‘‘
* APIï¼šåœ¨åº«ã®ã‚³ãƒ”ãƒ¼ã‚’ä¿æŒï¼ˆReplicaï¼‰ğŸª
* APIã¯å®šæœŸçš„ã« Worker ã‹ã‚‰ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’å–ã£ã¦ Replica ã‚’æ›´æ–°ï¼ˆï¼ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é…å»¶ã‚’ä½œã‚Œã‚‹ï¼‰â³

```mermaid
sequenceDiagram
    participant C as Client
    participant A as API (Replica)
    participant W as Worker (Primary)
    
    C->>A: èª­ã¿å–ã‚Š
    A-->>C: å¤ã„åœ¨åº« ğŸª
    
    C->>A: æ›¸ãè¾¼ã¿ä¾é ¼
    A->>W: æ›¸ãè¾¼ã¿ (Primaryã¸) ğŸ‘‘âœï¸
    W-->>A: OK (æ–°Version)
    A-->>C: å®Œäº†ãƒ¬ã‚¹ãƒãƒ³ã‚¹
    
    Note over A,W: éåŒæœŸãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ â³
    W-.->A: ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆåŒæœŸ
    
    C->>A: èª­ã¿å–ã‚Š
    A-->>C: æ–°ã—ã„åœ¨åº« âœ…
```

---

## 11.4.1 Worker ã‚’ä½œã‚‹ï¼ˆPrimaryæ‹…å½“ï¼‰ğŸ‘‘ğŸ“¦

`apps/worker/src/index.ts`

```ts
import Fastify from "fastify";

type Inventory = Record<string, number>;

const fastify = Fastify({ logger: true });

// Primaryåœ¨åº«ï¼ˆæœ¬ç‰©ã®ã¤ã‚‚ã‚Šï¼‰
let inventory: Inventory = {
  "apple-juice": 10,
  "cafe-latte": 10,
};

// å¤‰æ›´ã®ãŸã³ã«å¢—ãˆã‚‹ç‰ˆæ•°ï¼ˆâ€œæ–°ã—ã•â€ã®ç›®å°ï¼‰
let version = 0;

// æ•…éšœæ³¨å…¥ï¼šé…å»¶(ms) ã¨ å¤±æ•—ç‡(0ã€œ1)
let writeDelayMs = 0;
let failRate = 0;

function sleep(ms: number) {
  return new Promise((r) => setTimeout(r, ms));
}
function maybeFail() {
  if (Math.random() < failRate) {
    const err = new Error("Injected failure ğŸ’¥ (worker)");
    // FastifyãŒ500ã‚’è¿”ã—ã¦ãã‚Œã‚‹
    throw err;
  }
}

fastify.get("/snapshot", async () => {
  return { version, inventory };
});

fastify.post<{
  Body: { sku: string; qty: number };
}>("/reserve", async (req) => {
  const { sku, qty } = req.body;

  maybeFail();
  if (writeDelayMs > 0) await sleep(writeDelayMs);

  const current = inventory[sku] ?? 0;
  if (qty <= 0) return { ok: false, reason: "qty must be > 0", version, inventory };
  if (current < qty) return { ok: false, reason: "out of stock", version, inventory };

  inventory = { ...inventory, [sku]: current - qty };
  version++;

  return { ok: true, version, inventory };
});

fastify.post<{
  Body: { writeDelayMs?: number; failRate?: number };
}>("/chaos", async (req) => {
  writeDelayMs = req.body.writeDelayMs ?? writeDelayMs;
  failRate = req.body.failRate ?? failRate;
  return { ok: true, writeDelayMs, failRate };
});

await fastify.listen({ port: 4001, host: "127.0.0.1" });
```

> âœ…ãƒã‚¤ãƒ³ãƒˆï¼š`version` ãŒã€Œã©ã®æ›´æ–°ã¾ã§åæ˜ æ¸ˆã¿ï¼Ÿã€ã®ç›®å°ã«ãªã‚‹ã‚ˆğŸ§µâœ¨

---

## 11.4.2 API ã‚’ä½œã‚‹ï¼ˆReplicaæ‹…å½“ï¼‰ğŸªğŸ‘€

`apps/api/src/index.ts`

```ts
import Fastify from "fastify";

type Inventory = Record<string, number>;

const fastify = Fastify({ logger: true });

const WORKER = "http://127.0.0.1:4001";

// APIãŒæŒã¤ãƒ¬ãƒ—ãƒªã‚«ï¼ˆå¤ã„ã‹ã‚‚ã—ã‚Œãªã„åœ¨åº«ï¼‰
let replica: Inventory = {};
let replicaVersion = 0;

// ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é…å»¶ï¼ˆã“ã®å€¤ã‚’å¤‰ãˆã‚‹ã¨â€œå¤ã•â€ãŒå¢—ãˆã‚‹ï¼‰
let replicationLagMs = 800;

// åŒæœŸãƒ«ãƒ¼ãƒ—ï¼ˆWorker â†’ Replicaï¼‰
async function pullSnapshotOnce() {
  const res = await fetch(`${WORKER}/snapshot`);
  const data = (await res.json()) as { version: number; inventory: Inventory };

  // ã“ã“ã§é…å»¶ã‚’å…¥ã‚Œã¦â€œãƒ¬ãƒ—ãƒªã‚«ãŒè¿½ã„ã¤ãã®ãŒé…ã„â€ã‚’å†ç¾â³
  if (replicationLagMs > 0) {
    await new Promise((r) => setTimeout(r, replicationLagMs));
  }

  replica = data.inventory;
  replicaVersion = data.version;
}

setInterval(() => {
  pullSnapshotOnce().catch(() => {
    // å¤±æ•—ã—ã¦ã‚‚æ¬¡ã§å›å¾©ã™ã‚‹æƒ³å®šï¼ˆãƒ­ã‚°ã ã‘ã§OKï¼‰
  });
}, 500);

// èª­ã¿å–ã‚Šï¼šreplica / primary ã‚’åˆ‡ã‚Šæ›¿ãˆ
fastify.get<{
  Params: { sku: string };
  Querystring: { read?: "replica" | "primary" };
}>("/inventory/:sku", async (req) => {
  const sku = req.params.sku;
  const read = req.query.read ?? "replica";

  if (read === "primary") {
    const res = await fetch(`${WORKER}/snapshot`);
    const data = (await res.json()) as { version: number; inventory: Inventory };
    return {
      read,
      version: data.version,
      sku,
      qty: data.inventory[sku] ?? 0,
    };
  }

  return {
    read,
    version: replicaVersion,
    sku,
    qty: replica[sku] ?? 0,
  };
});

// å¼·æ•´åˆã£ã½ã„ï¼šæ›¸ã„ãŸã‚ã¨ã€Œãƒ¬ãƒ—ãƒªã‚«ãŒè¿½ã„ã¤ãã¾ã§å¾…ã¤ã€ğŸ§±
fastify.post<{
  Body: { sku: string; qty: number };
}>("/strong/reserve", async (req, reply) => {
  const started = performance.now();

  const res = await fetch(`${WORKER}/reserve`, {
    method: "POST",
    headers: { "content-type": "application/json" },
    body: JSON.stringify(req.body),
  });

  const write = (await res.json()) as { ok: boolean; version: number; reason?: string };
  if (!write.ok) return reply.code(409).send({ mode: "strong", ...write });

  // âœ…ã“ã“ãŒStrongä½“æ„Ÿãƒã‚¤ãƒ³ãƒˆï¼šreplicaãŒ write.version ã¾ã§è¿½ã„ã¤ãã®ã‚’å¾…ã¤
  const deadline = Date.now() + 2500; // å¾…ã¡ã™ãé˜²æ­¢ï¼ˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼‰
  while (replicaVersion < write.version) {
    if (Date.now() > deadline) {
      // â€œå¼·æ•´åˆãŒã¤ã‚‰ã„ç¬é–“â€ï¼šå¾…ã¡åˆ‡ã‚Œãªã„ãƒ»åˆ†æ–­ä¸­ãªã©ğŸ˜µâ€ğŸ’«
      const ms = Math.round(performance.now() - started);
      return reply.code(504).send({
        mode: "strong",
        ok: false,
        reason: "timeout waiting replica to catch up",
        writeVersion: write.version,
        replicaVersion,
        tookMs: ms,
      });
    }
    await new Promise((r) => setTimeout(r, 50));
  }

  const ms = Math.round(performance.now() - started);
  return {
    mode: "strong",
    ok: true,
    writeVersion: write.version,
    replicaVersion,
    tookMs: ms,
  };
});

// æœ€çµ‚çš„æ•´åˆã£ã½ã„ï¼šæ›¸ã„ãŸã‚‰ã™ãè¿”ã™ï¼ˆè¿½ã„ã¤ãå¾…ã¡ã¯ã—ãªã„ï¼‰ğŸ•Šï¸
fastify.post<{
  Body: { sku: string; qty: number };
}>("/eventual/reserve", async (req) => {
  const started = performance.now();

  const res = await fetch(`${WORKER}/reserve`, {
    method: "POST",
    headers: { "content-type": "application/json" },
    body: JSON.stringify(req.body),
  });

  const write = (await res.json()) as { ok: boolean; version: number; reason?: string };

  const ms = Math.round(performance.now() - started);
  if (!write.ok) return { mode: "eventual", ...write, tookMs: ms };

  // âœ…è¿”äº‹ã¯é€Ÿã„ã‘ã©ã€replicaã¯ã¾ã å¤ã„ã‹ã‚‚ï¼
  return {
    mode: "eventual",
    ok: true,
    writeVersion: write.version,
    replicaVersionAtResponse: replicaVersion,
    tookMs: ms,
    uiHint: "ç”»é¢ã¯ã€åæ˜ å¾…ã¡â€¦ã€ã£ã¦å‡ºã™ã¨å®‰å¿ƒğŸ’¬âœ¨",
  };
});

// é…å»¶ã®èª¿æ•´ï¼ˆä½“æ„Ÿç”¨ï¼‰
fastify.post<{
  Body: { replicationLagMs: number };
}>("/replica/lag", async (req) => {
  replicationLagMs = req.body.replicationLagMs;
  return { ok: true, replicationLagMs };
});

await fastify.listen({ port: 4000, host: "127.0.0.1" });
```

---

## 11.4.3 å‹•ã‹ã—ã¦å®Ÿé¨“ã—ã‚ˆã†ï¼ˆã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼‰ğŸ§ªğŸ’»

### â‘  Worker èµ·å‹•ï¼ˆåˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ï¼‰

* `apps/worker` ã§èµ·å‹•ï¼ˆæ—¢å­˜ã®èµ·å‹•ã‚³ãƒãƒ³ãƒ‰ãŒã‚ã‚‹ãªã‚‰ãã‚Œã§OKï¼‰ğŸš€

### â‘¡ API èµ·å‹•ï¼ˆåˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ï¼‰

* `apps/api` ã§èµ·å‹•ğŸš€

### â‘¢ åœ¨åº«ã‚’è¦‹ã‚‹ï¼ˆReplica ã¨ Primary ã§è¦‹æ¯”ã¹ï¼‰ğŸ‘€ğŸªğŸ‘‘

PowerShell ãªã‚‰ `curl` ãŒåˆ¥ç‰©ã«ãªã‚ŠãŒã¡ãªã®ã§ **`curl.exe`** ã‚’ä½¿ã†ã¨å®‰å…¨ã ã‚ˆğŸ‘âœ¨

```bash
curl.exe http://127.0.0.1:4000/inventory/apple-juice?read=replica
curl.exe http://127.0.0.1:4000/inventory/apple-juice?read=primary
```

---

## 11.4.4 Strong ã¨ Eventual ã®â€œå·®â€ã‚’å‡ºã™å®Ÿé¨“ ğŸ”¥â³

### å®Ÿé¨“Aï¼šãƒ¬ãƒ—ãƒªã‚«é…å»¶ã‚’å¤§ããã™ã‚‹ï¼ˆã‚ºãƒ¬ãŒç›®ç«‹ã¤ï¼‰ğŸªâ³

```bash
curl.exe -X POST http://127.0.0.1:4000/replica/lag ^
  -H "content-type: application/json" ^
  -d "{\"replicationLagMs\":1500}"
```

### å®Ÿé¨“Bï¼šStrong ã§äºˆç´„ï¼ˆé…ããªã‚‹ã®ã‚’æ„Ÿã˜ã‚‹ï¼‰ğŸ§±ğŸ¢

```bash
curl.exe -X POST http://127.0.0.1:4000/strong/reserve ^
  -H "content-type: application/json" ^
  -d "{\"sku\":\"apple-juice\",\"qty\":1}"
```

ğŸ“Œè¦‹ã©ã“ã‚ğŸ‘€

* `tookMs` ãŒ **å¾…ã¡æ™‚é–“ã¶ã‚“å¢—ãˆã‚‹**
* `timeout waiting replica...` ãŒå‡ºãŸã‚‰ã€Œå¼·æ•´åˆãŒã¤ã‚‰ã„ç¬é–“ã€ã‚’å†ç¾ã§ãã¦ã‚‹ğŸ˜µâ€ğŸ’«ğŸ’¥

### å®Ÿé¨“Cï¼šEventual ã§äºˆç´„ï¼ˆè¿”äº‹ãŒé€Ÿã„ï¼‰ğŸ•Šï¸âš¡

```bash
curl.exe -X POST http://127.0.0.1:4000/eventual/reserve ^
  -H "content-type: application/json" ^
  -d "{\"sku\":\"apple-juice\",\"qty\":1}"
```

ãã®ç›´å¾Œã«ğŸ‘‡

```bash
curl.exe http://127.0.0.1:4000/inventory/apple-juice?read=replica
curl.exe http://127.0.0.1:4000/inventory/apple-juice?read=primary
```

ğŸ“Œè¦‹ã©ã“ã‚ğŸ‘€

* **primary ã¯æ¸›ã£ã¦ã‚‹**ã®ã«ã€**replica ã¯ã¾ã å¤ã„**ã“ã¨ãŒã‚ã‚‹ğŸ˜µâ€ğŸ’«
* ã—ã°ã‚‰ãã—ã¦ã¾ãŸ `replica` ã‚’èª­ã‚€ã¨è¿½ã„ã¤ãğŸ•Šï¸âœ¨

---

# 11.5 ä½“æ„Ÿã®ã¾ã¨ã‚ï¼ˆã“ã“ãŒâ€œè‚Œæ„Ÿè¦šâ€ğŸ’¡ï¼‰

* Strong ğŸ§±ï¼š

  * ã€Œ**ä¸€è‡´**ã€ã®ãŸã‚ã« **å¾…ã¤**ï¼ˆ=é…ã„ï¼‰ğŸ¢
  * åˆ†æ–­ã£ã½ã„çŠ¶æ³ã ã¨ **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ/æ‹’å¦** ãŒèµ·ãã‚„ã™ã„ğŸ˜µâ€ğŸ’«ğŸ’¥

* Eventual ğŸ•Šï¸ï¼š

  * ã€Œ**ã¾ãšè¿”ã™**ã€ã®ã§ **é€Ÿã„**âš¡
  * ãŸã ã— **ã‚ºãƒ¬ã‚‹** â†’ ã ã‹ã‚‰ **ç”»é¢ã§æ”¯ãˆã‚‹**ğŸ¨ğŸ’¬

---

# 11.6 â€œé¸ã³æ–¹â€ã®ãƒŸãƒ‹æŒ‡é‡ï¼ˆè¶…ã–ã£ãã‚Šï¼‰ğŸ§­âœ¨

* **Strongå¯„ã‚Š**ã«ã—ãŸã„âœ…

  * ãŠé‡‘ğŸ’¸ï¼ˆäºŒé‡è«‹æ±‚ã¯ãƒ€ãƒ¡ï¼‰
  * åœ¨åº«ç¢ºä¿ğŸ“¦ï¼ˆå£²ã‚Œãªã„ç‰©ã‚’å£²ã£ãŸã‚‰äº‹æ•…ï¼‰
  * æ³•å‹™âš–ï¸ï¼ˆè¦ç´„/å¥‘ç´„ãŒçµ¡ã‚€ï¼‰

* **Eventualå¯„ã‚Š**ã§OKğŸ•Šï¸

  * ã„ã„ã­ğŸ‘ã€é–²è¦§æ•°ğŸ‘€ã€é€šçŸ¥ğŸ””
  * å¤šå°‘ã‚ºãƒ¬ã¦ã‚‚å›°ã‚‰ãªã„é›†è¨ˆğŸ“ˆ
  * â€œåæ˜ å¾…ã¡â€ã‚’å‡ºã›ã°ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç´å¾—ã§ãã‚‹UXğŸ˜Œâœ¨

---

# 11.7 AI ã®ä½¿ã„æ–¹ï¼ˆã“ã®ç« ã¯â€œæ¯”è¼ƒâ€ãŒå¼·ã„ğŸ“ŠğŸ¤–ï¼‰

## âœ… æ¯”è¼ƒè¡¨ã‚’ä½œã‚‰ã›ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹ ğŸ“ŠğŸ¤–

* ã€ŒStrongæ•´åˆæ€§ã¨Eventualæ•´åˆæ€§ã‚’ã€**é€Ÿã•/å¯ç”¨æ€§/å®Ÿè£…ã‚³ã‚¹ãƒˆ/UX**ã®è¦³ç‚¹ã§æ¯”è¼ƒè¡¨ã«ã—ã¦ã€‚æ—¥æœ¬èªã§ã€‚åˆå¿ƒè€…å‘ã‘ã§ã€‚ã€

## âœ… ãƒ­ã‚°ã®èª­ã¿å–ã‚Šã‚’æ‰‹ä¼ã‚ã›ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹ ğŸ•µï¸â€â™€ï¸ğŸ¤–

* ã€Œã“ã® `strong/reserve` ã®çµæœãŒ504ã«ãªã‚‹ç†ç”±ã‚’ã€**replicaVersion ã¨ writeVersion**ã®é–¢ä¿‚ã§èª¬æ˜ã—ã¦ã€‚æ”¹å–„æ¡ˆã‚‚3ã¤ã€‚ã€

## âœ… â€œå®‰å¿ƒã•ã›ã‚‹æ–‡è¨€â€ã‚’ä½œã‚‰ã›ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹ ğŸ’¬ğŸ¤–

* ã€Œæœ€çµ‚çš„æ•´åˆæ€§ã§åæ˜ å¾…ã¡ã«ãªã‚‹ã¨ãã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä¸å®‰ã«ãªã‚‰ãªã„çŸ­ã„æ–‡è¨€ã‚’10å€‹ã€‚ã‹ã‚ã„ã‚ã§ã€‚ã€

---

# 11.8 ãƒŸãƒ‹èª²é¡Œï¼ˆã‚„ã‚‹ã¨ç†è§£ãŒçˆ†ä¸ŠãŒã‚ŠğŸ”¥ï¼‰

1. **Workerã®æ•…éšœæ³¨å…¥**ã‚’ä½¿ã£ã¦ã¿ã‚ˆã†ğŸ’¥

```bash
curl.exe -X POST http://127.0.0.1:4001/chaos ^
  -H "content-type: application/json" ^
  -d "{\"writeDelayMs\":800,\"failRate\":0.2}"
```

â†’ Strong ãŒã€Œæ­¢ã¾ã‚Šã‚„ã™ã„ã€æ„Ÿè¦šãŒã•ã‚‰ã«åˆ†ã‹ã‚‹ğŸ˜µâ€ğŸ’«

2. Eventual ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã« **`status: "PENDING"`** ã‚’å…¥ã‚Œã¦ã€ç”»é¢ã«å‡ºã™å‰æã®å½¢ã«ã—ã¦ã¿ã‚ˆã†ğŸ•Šï¸ğŸ¨

3. `replica/lag` ã‚’ **0 / 300 / 1500** ã«å¤‰ãˆã¦ã€ã‚ºãƒ¬ãŒã©ã‚Œãã‚‰ã„â€œæ°—æŒã¡æ‚ªã„ã‹â€ãƒ¡ãƒ¢ã—ã‚ˆã†ğŸ“ğŸ˜†

---

# 11.9 ã“ã®ç« ã®ã¾ã¨ã‚ âœ…âœ¨

* **Strongï¼ä¸€è‡´ã‚’å®ˆã‚‹ï¼ˆã§ã‚‚é…ã„/æ­¢ã¾ã‚Šã‚„ã™ã„ï¼‰**ğŸ§±ğŸ¢
* **Eventualï¼é€Ÿã„ï¼ˆã§ã‚‚ã‚ºãƒ¬ã‚‹ã®ã§UXã§æ”¯ãˆã‚‹ï¼‰**ğŸ•Šï¸ğŸ¨
* â€œã©ã£ã¡ãŒæ­£ã—ã„â€ã˜ã‚ƒãªãã¦ã€**ä½•ã‚’å®ˆã‚ŠãŸã„ã‹**ã§é¸ã¶ã®ãŒè¨­è¨ˆã®ã‚³ãƒ„ğŸ§ ğŸ§­

---

## å‚è€ƒï¼ˆã“ã®ç« ã®å‰æã«ãªã£ã¦ã‚‹æœ€æ–°æƒ…å ±ï¼‰ğŸ“Œ

* TypeScript ã®æœ€æ–°å®‰å®šç‰ˆã¯ 5.9 ã¨ã—ã¦æ¡ˆå†…ã•ã‚Œã¦ã„ã‚‹ã€‚([typescriptlang.org][1])
* Node.js ã®ãƒªãƒªãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ï¼ˆLTS/Currentï¼‰ã¯å…¬å¼ã§ä¸€è¦§åŒ–ã•ã‚Œã¦ã„ã‚‹ã€‚([nodejs.org][2])
* TypeScript ã® â€œNativeâ€ ç³»ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆé«˜é€ŸåŒ–ã®æµã‚Œï¼‰ãŒé€²è¡Œä¸­ã€‚([developer.microsoft.com][3])

[1]: https://www.typescriptlang.org/download/?utm_source=chatgpt.com "How to set up TypeScript"
[2]: https://nodejs.org/en/about/previous-releases?utm_source=chatgpt.com "Node.js Releases"
[3]: https://developer.microsoft.com/blog/typescript-7-native-preview-in-visual-studio-2026?utm_source=chatgpt.com "TypeScript 7 native preview in Visual Studio 2026"
