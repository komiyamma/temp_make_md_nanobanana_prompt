# ç¬¬21ç« ï¼šé–‹ç™ºä¸­ã«ä¾¿åˆ©ï¼šTurbo/ãƒ“ãƒ«ãƒ‰ã®é›°å›²æ°—ã ã‘çŸ¥ã‚‹âš¡

ã“ã®ç« ã¯ã€Œç´°ã‹ã„ä»•çµ„ã¿ã‚’æš—è¨˜ã™ã‚‹ã€ã˜ã‚ƒãªãã¦ã€**é–‹ç™ºã®ç©ºæ°—æ„Ÿ**ã‚’ã¤ã‹ã‚€å›ã ã‚ˆã€œğŸ˜ŠğŸ’¡
Next.jsã£ã¦ã€ã¡ã‚ƒã‚“ã¨â€œé€Ÿãå‹•ããŸã‚ã®è£å´â€ãŒç”¨æ„ã•ã‚Œã¦ã‚‹ã‚“ã ãªã€œã£ã¦åˆ†ã‹ã‚‹ã¨å®‰å¿ƒã™ã‚‹ğŸ‘âœ¨

---

## ã“ã®ç« ã§ã¤ã‹ã‚€ã“ã¨ğŸ¯âœ¨

* **Turboï¼ˆ= Turbopackï¼‰ã£ã¦ä½•è€…ï¼Ÿ** âš¡ğŸ¦€
* **é–‹ç™ºï¼ˆdevï¼‰ã¨æœ¬ç•ªï¼ˆbuild/startï¼‰ã£ã¦ä½•ãŒé•ã†ï¼Ÿ** ğŸ§ ğŸ”
* ã„ã¤ã‚‚ä½¿ã†3ã¤ã®ã‚³ãƒãƒ³ãƒ‰ã®å½¹å‰²ãŒã‚¹ãƒƒã‚­ãƒªã™ã‚‹ğŸ’ªğŸ§¡

---

## Turboã£ã¦ãªã«ï¼Ÿï¼ˆæ­£ä½“ã¯Turbopackï¼‰âš¡ğŸ¦€

![Turbo Engine](./picture/next_study_021_turbo_engine.png)

Turboã¯ã–ã£ãã‚Šè¨€ã†ã¨ã€**é–‹ç™ºä¸­ã®â€œçµ„ã¿ç«‹ã¦å½¹ï¼ˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ï¼‰â€ãŒã‚ã£ã¡ã‚ƒé€Ÿã„ç‰ˆ**ã ã‚ˆğŸï¸ğŸ’¨
Next.jsã«ã¯ **Turbopack** ã¨ã„ã†ä»•çµ„ã¿ãŒå…¥ã£ã¦ã„ã¦ã€JavaScript/TypeScriptã®é–‹ç™ºã‚’é€Ÿãã™ã‚‹ãŸã‚ã«ä½œã‚‰ã‚Œã¦ã‚‹ã®âœ¨
ä»Šã¯ **Next.jsã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒãƒ³ãƒ‰ãƒ©ãƒ¼**ã«ãªã£ã¦ã„ã¦ã€åŸºæœ¬ã¯è¨­å®šãªã—ã§ä½¿ãˆã‚‹ã‚ˆğŸ™†â€â™€ï¸âœ¨ ([Next.js][1])

> ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼š
> ğŸ§© å¤‰æ›´ã—ãŸã¨ã“ã‚ã ã‘ã‚’è³¢ãä½œã‚Šç›´ã™ â†’ ã ã‹ã‚‰ä½“æ„ŸãŒã‚µã‚¯ã‚µã‚¯âœ¨

---

## dev / build / start ã®é•ã„ï¼ˆè¶…ã ã„ã˜ï¼‰ğŸ§ğŸ“¦ğŸš€

![next_study_021_lifecycle_flow.png](./picture/next_study_021_lifecycle_flow.png)


* `npm run dev`ï¼š**é–‹ç™ºãƒ¢ãƒ¼ãƒ‰**ï¼ˆç·¨é›†â†’ã™ãåæ˜ ã€ã‚¨ãƒ©ãƒ¼ã‚‚è¦ªåˆ‡ï¼‰ğŸ› ï¸âœ¨
* `npm run build`ï¼š**æœ¬ç•ªç”¨ã«æœ€é©åŒ–ã—ã¦çµ„ã¿ç«‹ã¦ã‚‹**ï¼ˆãƒã‚§ãƒƒã‚¯ã‚‚å³ã—ã‚ï¼‰ğŸ“¦ğŸ”
* `npm run start`ï¼š**æœ¬ç•ªãƒ¢ãƒ¼ãƒ‰ã§èµ·å‹•**ï¼ˆâ€» build æ¸ˆã¿ãŒå‰æï¼‰ğŸš€ğŸ ([Next.js][2])

å›³ã§è¦‹ã‚‹ã¨ã“ã‚“ãªæ„Ÿã˜ğŸ‘‡ğŸ€

```mermaid
flowchart TD
  A["npm run dev"] --> B["é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•"]
  B --> C["å¤‰æ›´ã™ã‚‹ã¨éƒ¨åˆ†çš„ã«ä½œã‚Šç›´ã™"]
  C --> D["ãƒ–ãƒ©ã‚¦ã‚¶ã«ã™ãåæ˜ "]
  E["npm run build"] --> F["æœ¬ç•ªç”¨ã«æœ€é©åŒ–ã—ã¦ãƒ“ãƒ«ãƒ‰"]
  F --> G[".next ã«æˆæœç‰©"]
  H["npm run start"] --> I["æœ¬ç•ªãƒ¢ãƒ¼ãƒ‰ã§èµ·å‹•"]
  G --> I
```

---

## 5åˆ†ãƒŸãƒƒã‚·ãƒ§ãƒ³ï¼šé›°å›²æ°—ã‚’ä½“é¨“ã—ã‚ˆğŸ•”âœ¨

### â‘  é–‹ç™ºã§å‹•ã‹ã™ï¼ˆã„ã¤ã‚‚ã®ã‚„ã¤ï¼‰ğŸŒˆ

![next_study_021_dev_mode.png](./picture/next_study_021_dev_mode.png)


```bash
npm run dev
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ `http://localhost:3000` ã‚’é–‹ã„ã¦ã€é©å½“ã«æ–‡å­—ã‚’å¤‰ãˆã¦ä¿å­˜ã—ã¦ã¿ã¦ã­ğŸ“âœ¨
**ã™ãç”»é¢ãŒå¤‰ã‚ã£ãŸã‚‰OKï¼**ï¼ˆã“ã‚ŒãŒé–‹ç™ºã®æ°—æŒã¡ã‚ˆã•ğŸ’–ï¼‰

### â‘¡ æœ¬ç•ªãƒ“ãƒ«ãƒ‰ã—ã¦ã¿ã‚‹ï¼ˆã¡ã‚‡ã„ç·Šå¼µï¼‰ğŸ“¦ğŸ˜³

![next_study_021_build_mode.png](./picture/next_study_021_build_mode.png)


ã„ã£ãŸã‚“ dev ã‚’æ­¢ã‚ã¦ï¼ˆã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ `Ctrl + C`ï¼‰ğŸ‘‡

```bash
npm run build
```

ã“ã“ã§å‡ºã‚‹ã‚¨ãƒ©ãƒ¼ã¯ã€**ã€Œæœ¬ç•ªã§ã¯å±ãªã„ã‹ã‚‚ï¼ã€ã®ã‚µã‚¤ãƒ³**ã«ãªã‚Šã‚„ã™ã„ã‚ˆğŸš¨
ï¼ˆé–‹ç™ºã§å‹•ã„ã¦ã‚‚ã€æœ¬ç•ªãƒ“ãƒ«ãƒ‰ã§è½ã¡ã‚‹ã“ã¨ã¯æ™®é€šã«ã‚ã‚‹ã€œğŸ¥ºï¼‰

### â‘¢ æœ¬ç•ªã£ã½ãèµ·å‹•ã™ã‚‹ğŸš€

![next_study_021_start_mode.png](./picture/next_study_021_start_mode.png)


```bash
npm run start
```

ã“ã‚Œã§ **æœ¬ç•ªã«è¿‘ã„å‹•ã**ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§ç¢ºèªã§ãã‚‹ã‚ˆğŸ‘€âœ¨ ([Next.js][3])

---

## ã‚‚ã—å›°ã£ãŸã‚‰ï¼ˆã‚ã‚ŠãŒã¡3ã¤ï¼‰ğŸ§¯ğŸ’¡

### 1) 3000ç•ªãƒãƒ¼ãƒˆãŒåŸ‹ã¾ã£ã¦ã‚‹ğŸ˜µâ€ğŸ’«

![next_study_021_port_conflict.png](./picture/next_study_021_port_conflict.png)


åˆ¥ãƒãƒ¼ãƒˆã§èµ·å‹•ã—ã‚ˆğŸ‘‡

```bash
npm run dev -- -p 3001
```

`-p`ï¼ˆportï¼‰ã¯Next.js CLIã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã ã‚ˆğŸ”Œâœ¨ ([Next.js][2])

### 2) Turbopackã®ç›¸æ€§ãŒå¾®å¦™ãªã¨ãï¼ˆãŸã¾ã«ã‚ã‚‹ï¼‰ğŸŒ€

ä¸€æ™‚çš„ã« **Webpackã«åˆ‡ã‚Šæ›¿ãˆ**ã§ãã‚‹ã‚ˆï¼ˆãŠåŠ©ã‘ã‚¹ã‚¤ãƒƒãƒï¼‰ğŸ›Ÿ
`package.json` ã® scripts ã‚’ã“ã†ã™ã‚‹ğŸ‘‡

```json
{
  "scripts": {
    "dev": "next dev --webpack",
    "build": "next build --webpack",
    "start": "next start"
  }
}
```

å…¬å¼ã«ã€Œå¿…è¦ãªã‚‰Webpackã¸åˆ‡ã‚Šæ›¿ãˆOKã€ã£ã¦ãªã£ã¦ã‚‹ã‚ˆğŸ™†â€â™€ï¸ ([Next.js][1])

### 3) build ã ã‘å¤±æ•—ã™ã‚‹ğŸ˜­

ã¾ãšã¯è½ã¡ç€ã„ã¦ã€**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å…ˆé ­ã‹ã‚‰èª­ã‚€**ã®ãŒã‚³ãƒ„ğŸ“Œ
buildã¯æœ¬ç•ªãƒã‚§ãƒƒã‚¯ãŒå¼·ã„ã‹ã‚‰ã€ãã“ã§è¦‹ã¤ã‹ã‚‹ã®ã¯ã‚€ã—ã‚è‰¯ã„ã“ã¨âœ¨ï¼ˆäº‹æ•…é˜²æ­¢ğŸ›¡ï¸ï¼‰

---

## ä»Šæ—¥ã®ã¾ã¨ã‚ğŸ€âœ¨

* Turbo = **Turbopack** ã§ã€é–‹ç™ºãŒé€Ÿããªã‚‹ä»•çµ„ã¿âš¡ ([Next.js][1])
* `dev` ã¯é–‹ç™ºç”¨ã€`build` ã¯æœ¬ç•ªç”¨ã®çµ„ã¿ç«‹ã¦ã€`start` ã¯æœ¬ç•ªèµ·å‹•ğŸš€ ([Next.js][2])
* å›°ã£ãŸã‚‰ `-p` ã§ãƒãƒ¼ãƒˆå¤‰æ›´ã€ç›¸æ€§ãŒæ‚ªã‘ã‚Œã° `--webpack` ã§é¿é›£ã§ãã‚‹ğŸ›Ÿâœ¨ ([Next.js][2])

[1]: https://nextjs.org/docs/app/api-reference/turbopack "API Reference: Turbopack | Next.js"
[2]: https://nextjs.org/docs/app/api-reference/cli/next "CLI: next CLI | Next.js"
[3]: https://nextjs.org/docs/pages/getting-started/deploying "Getting Started: Deploying | Next.js"
