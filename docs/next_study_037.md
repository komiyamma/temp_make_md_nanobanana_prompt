# ç¬¬37ç« ï¼šServer Component ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã£ã¦è¦šãˆã‚ˆã†ğŸ§Š

Next.jsï¼ˆApp Routerï¼‰ã§ã¯ã€**ä½•ã‚‚æ›¸ã‹ãªã‘ã‚Œã°åŸºæœ¬ãœã‚“ã¶ Server Component** ã ã‚ˆã€œï¼ğŸ™Œ
ã“ã‚Œã‚’å…ˆã«ä½“ã«å…¥ã‚Œã‚‹ã¨ã€ä»Šå¾Œãœã‚“ãœã‚“è¿·å­ã«ãªã‚‰ãªããªã‚‹ã‚ˆğŸ§­ğŸ’•

---

### 1) Server Component ã£ã¦ãªã«ï¼ŸğŸ§Š

![next_study_037_cloud_vs_laptop](./picture/next_study_037_cloud_vs_laptop.png)

**ã‚µãƒ¼ãƒãƒ¼å´ï¼ˆNode.jså´ï¼‰ã§å‹•ã„ã¦ã€HTMLã‚’ä½œã£ã¦ãƒ–ãƒ©ã‚¦ã‚¶ã«è¿”ã™ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**ã ã‚ˆğŸµ
ãƒã‚¤ãƒ³ãƒˆã¯ã“ã‚ŒğŸ‘‡

* âœ… **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä¸­èº«ï¼ˆJSã®å‡¦ç†ï¼‰ãŒåŸºæœ¬ãƒ–ãƒ©ã‚¦ã‚¶ã«é€ã‚‰ã‚Œãªã„** â†’ é€Ÿã„âš¡è»½ã„ğŸª½

![next_study_037_zero_bundle](./picture/next_study_037_zero_bundle.png)
* âœ… **DBã‚„ç§˜å¯†æƒ…å ±ï¼ˆAPIã‚­ãƒ¼ãªã©ï¼‰ã‚’å®‰å…¨ã«æ‰±ãˆã‚‹**ğŸ”
* âœ… **`async` ã§ãã®ã¾ã¾ãƒ‡ãƒ¼ã‚¿å–å¾—ã—ã‚„ã™ã„**ğŸ“¦

Next.jsã®App Routerã¯ã€**React Server Componentsï¼ˆRSCï¼‰ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ä½¿ã†**è¨­è¨ˆã«ãªã£ã¦ã‚‹ã‚ˆã€œğŸ§Š ([Next.js][1])

---

### 2) ã–ã£ãã‚Šå›³è§£ï¼šã©ã“ã§å‹•ãã®ï¼ŸğŸ§ ğŸ—ºï¸

![Server Default](./picture/next_study_037_server_default.png)

```mermaid
flowchart LR
  U["ãƒ–ãƒ©ã‚¦ã‚¶ğŸ‘©â€ğŸ’»"] -->|"ã‚¢ã‚¯ã‚»ã‚¹"| S["Next.jsã‚µãƒ¼ãƒãƒ¼ğŸ–¥ï¸"]
  S --> R["Server Componentã§æç”»ğŸ§Š"]
  R -->|"HTMLã‚’è¿”ã™"| U
  R -->|"å¿…è¦ãªã‚‰"| C["Client Componentã®JSé…ä¿¡ğŸ®"]
  C --> U
```

* **åŸºæœ¬ã¯ã‚µãƒ¼ãƒãƒ¼ã§ä½œã£ã¦è¿”ã™**ï¼ˆé€Ÿã„ãƒ»è»½ã„ï¼‰ğŸ§Šâœ¨
* **ã‚¯ãƒªãƒƒã‚¯ãªã©â€œæ“ä½œãŒå¿…è¦ãªéƒ¨åˆ†â€ã ã‘**ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®JSãŒæ¥ã‚‹ğŸ®ï¼ˆâ€»ã“ã‚Œã¯æ¬¡ç« ä»¥é™ã§è©³ã—ãï¼ï¼‰

---

### 3) ã€Œãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãŒServerã€ã£ã¦ã€å…·ä½“çš„ã«ä½•ãŒèµ·ãã‚‹ã®ï¼ŸğŸ‘€

![next_study_037_default_stamp](./picture/next_study_037_default_stamp.png)

App Routerï¼ˆ`app/`ï¼‰ã®ä¸–ç•Œã§ã¯â€¦

* `app/page.tsx` ã‚‚
* `app/xxx/page.tsx` ã‚‚
* ãã“ã‹ã‚‰å‘¼ã°ã‚ŒãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚‚ï¼ˆåŸºæœ¬ï¼‰

**ãœãƒ¼ã‚“ã¶ Server Component æ‰±ã„**ã«ãªã‚‹ã®ãŒåŸºæœ¬ã ã‚ˆğŸ§Š ([Next.js][2])

ã ã‹ã‚‰æœ€åˆã«è¦šãˆã‚‹åˆè¨€è‘‰ã¯ã“ã‚ŒğŸ‘‡
**ã€Œè¿·ã£ãŸã‚‰Serverã€**ğŸ§Šâœ¨

---

### 4) Server Component ã§ â€œã§ãã‚‹ã“ã¨ / ã§ããªã„ã“ã¨â€ ğŸ“Œ

#### âœ… ã§ãã‚‹ã“ã¨ï¼ˆå¾—æ„ï¼‰ğŸ’ª

![next_study_037_server_powers](./picture/next_study_037_server_powers.png)

* `fetch()` ã§ãƒ‡ãƒ¼ã‚¿å–å¾—ğŸ“¡ï¼ˆãƒšãƒ¼ã‚¸è¡¨ç¤ºå‰ã«å–ã‚Œã‚‹ã®å¼·ã„ï¼ï¼‰
* DBã‚¢ã‚¯ã‚»ã‚¹ï¼ˆã‚µãƒ¼ãƒãƒ¼ã ã‘ã§å®Œçµï¼‰ğŸ—ƒï¸
* `process.env` ã®**ç§˜å¯†ã®ç’°å¢ƒå¤‰æ•°**ã‚’ä½¿ã†ğŸ”
* é‡ã„å‡¦ç†ã‚’ã‚µãƒ¼ãƒãƒ¼ã§ã‚„ã‚‹ğŸ§ 

#### âŒ ã§ããªã„ã“ã¨ï¼ˆè‹¦æ‰‹ï¼‰ğŸ™…â€â™€ï¸

![next_study_037_no_mouse](./picture/next_study_037_no_mouse.png)

* ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆ`onClick` ãªã©ï¼‰ğŸ–±ï¸
* `useState` / `useEffect` ãªã©ã®React HooksğŸ£
* `window` / `document` ã¿ãŸã„ãªãƒ–ãƒ©ã‚¦ã‚¶APIğŸŒ

ã“ã‚Œã‚‰ã¯ã€Œãƒ–ãƒ©ã‚¦ã‚¶ã§å‹•ãå‰æã€ã ã‹ã‚‰ã€Server Componentã«ã¯å‘ã‹ãªã„ã®ğŸ¥º
å¿…è¦ãªã‚‰ **`"use client"`** ã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã«ã™ã‚‹ã‚ˆï¼ˆã“ã“ã¯æ¬¡ç« ã§ã¡ã‚ƒã‚“ã¨ã‚„ã‚‹ã‚ˆã€œğŸ®ï¼‰ ([Next.js][3])

---

### 5) ãƒŸãƒ‹å®Ÿç¿’ï¼šServer Component ãŒæ™®é€šã«æ›¸ã‘ã‚‹ã®ã‚’ä½“æ„Ÿã—ã‚ˆğŸ§ªâœ¨

![next_study_037_async_fetch_code](./picture/next_study_037_async_fetch_code.png)

#### âœ… æ‰‹é †

1. `app/server-default/page.tsx` ã‚’ä½œã‚‹ğŸ“
2. ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒšã™ã‚‹âœï¸
3. `npm run dev` ã§é–‹ã„ã¦ç¢ºèªğŸ‘€

```tsx
// app/server-default/page.tsx
export default async function Page() {
  // âœ… Server Component ãªã®ã§ async OKï¼
  const res = await fetch("https://jsonplaceholder.typicode.com/users", {
    // å­¦ç¿’ç”¨ï¼šæ¯å›å–ã‚Šç›´ã—ãŸã„ãªã‚‰ã“ã†ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥æŒ™å‹•ã¯å¾Œã®ç« ã§ã‚„ã‚‹ã‚ˆï¼‰
    cache: "no-store",
  });

  if (!res.ok) {
    throw new Error("ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—ã«å¤±æ•—ã—ãŸã‚ˆğŸ¥º");
  }

  const users: Array<{ id: number; name: string; email: string }> = await res.json();

  // âœ… ã“ã‚Œã¯ã‚µãƒ¼ãƒãƒ¼å´ã®ãƒ­ã‚°ï¼ˆã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«å‡ºã‚‹ã‚ˆï¼‰ğŸ–¥ï¸ğŸ“
  console.log("users count:", users.length);

  return (
    <main style={{ padding: 16 }}>
      <h1>Server Component ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆğŸ§Šâœ¨</h1>
      <p>ã“ã®ä¸€è¦§ã¯ã‚µãƒ¼ãƒãƒ¼ã§å–ã£ã¦ã‹ã‚‰è¡¨ç¤ºã—ã¦ã‚‹ã‚ˆã€œğŸ“¡</p>

      <ul>
        {users.slice(0, 5).map((u) => (
          <li key={u.id}>
            {u.name}ï¼ˆ{u.email}ï¼‰
          </li>
        ))}
      </ul>
    </main>
  );
}
```

âœ… è¦‹ã¦ã»ã—ã„ãƒã‚¤ãƒ³ãƒˆğŸ‘€ğŸ’•

* `async` ã§ãã®ã¾ã¾ `fetch` ã§ãã‚‹ï¼ˆæ°—æŒã¡ã„ã„ï¼ï¼‰ğŸ“¡âœ¨
* `console.log` ãŒ **ãƒ–ãƒ©ã‚¦ã‚¶ã˜ã‚ƒãªãã¦ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«å‡ºã‚‹**ğŸ–¥ï¸
* ã“ã‚ŒãŒã€ŒServerãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã€ã£ã¦ã“ã¨ã ã‚ˆğŸ§Š

---

### 6) ã¤ã¾ãšããƒã‚§ãƒƒã‚¯ âœ…ï¼ˆã‚ã‚‹ã‚ã‚‹ï¼‰ğŸ˜µâ€ğŸ’«â¡ï¸ğŸ˜†

* ã€Œ`window` ãŒãªã„ã£ã¦æ€’ã‚‰ã‚ŒãŸï¼ã€ğŸ‘‰ ãã‚Œã€Serverã§å‹•ã„ã¦ã‚‹è¨¼æ‹ ğŸŒâŒ
* ã€Œ`useState` ä½¿ã£ãŸã‚‰ã‚¨ãƒ©ãƒ¼ï¼ã€ğŸ‘‰ ãã‚Œã‚‚Serverã§å‹•ã„ã¦ã‚‹è¨¼æ‹ ğŸ£âŒ
* ã€Œã‚¯ãƒªãƒƒã‚¯å‡¦ç†æ›¸ã‘ãªã„ï¼ã€ğŸ‘‰ æ“ä½œãŒå¿…è¦ãªéƒ¨åˆ†ã ã‘ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ã™ã‚‹ï¼ˆæ¬¡ç« ã§ã‚„ã‚‹ğŸ®ï¼‰

---

### 7) ç·´ç¿’å•é¡Œï¼ˆãƒŸãƒ‹ï¼‰ğŸ“âœ¨

ã§ããŸã‚‰æœ€é«˜ã€œï¼ğŸ’®

1. è¡¨ç¤ºã™ã‚‹äººæ•°ã‚’ `slice(0, 5)` â†’ `slice(0, 10)` ã«å¤‰ãˆã‚‹ğŸ‘¥
2. `<h1>` ã®æ–‡è¨€ã‚’è‡ªåˆ†ã®å¥½ããªã‚¿ã‚¤ãƒˆãƒ«ã«å¤‰ãˆã‚‹ğŸ§¡
3. `console.log` ã‚’å¢—ã‚„ã—ã¦ã€Œã„ã¤å®Ÿè¡Œã•ã‚Œã¦ã‚‹ã‹ã€è¦³å¯Ÿã™ã‚‹ğŸ–¥ï¸ğŸ”

---

### 8) ã¾ã¨ã‚ï¼ˆä»Šæ—¥ã®åˆè¨€è‘‰ï¼‰ğŸ“ŒğŸ§Š

* **App Router ã¯ Server Component ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ**ğŸ§Š ([Next.js][2])
* ã‚µãƒ¼ãƒãƒ¼ã§æç”»ã§ãã‚‹ã¨ **è»½ã„ãƒ»é€Ÿã„ãƒ»å®‰å…¨**âš¡ğŸ”
* è¿·ã£ãŸã‚‰ã¾ãš **Serverã§ä½œã‚‹** â†’ æ“ä½œãŒå¿…è¦ãªã¨ã“ã ã‘ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆğŸ® ([Next.js][3])

æ¬¡ã¯ã€Œã˜ã‚ƒã‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ã™ã‚‹ã®ã¯ã©ã‚“ãªæ™‚ï¼Ÿ `"use client"`ã£ã¦ä½•ï¼Ÿã€ã«é€²ã‚ã°ã€ã‚ã£ã¡ã‚ƒã‚¹ãƒ ãƒ¼ã‚ºã ã‚ˆã€œğŸ€âœ¨

[1]: https://nextjs.org/docs/app/getting-started/server-and-client-components?utm_source=chatgpt.com "Getting Started: Server and Client Components"
[2]: https://nextjs.org/docs/14/app/building-your-application/rendering/server-components?utm_source=chatgpt.com "Server Components - Rendering"
[3]: https://nextjs.org/docs/app/api-reference/directives/use-client?utm_source=chatgpt.com "Directives: use client"
