# ç¬¬14ç« ï¼šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°åŸºç¤ï¼‹â€œç¾å®Ÿã®ã‚¯ã‚»â€äºˆå‘ŠğŸ“¨âš ï¸

## ã“ã®ç« ã§ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã“ã¨ğŸ¯âœ¨

* **ã‚¤ãƒ™ãƒ³ãƒˆ**ã¨**ã‚³ãƒãƒ³ãƒ‰**ã‚’ã€è¿·ã‚ãšè¨€ã„åˆ†ã‘ã‚‰ã‚Œã‚‹ğŸ˜Š
* ã€Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯**å°‘ãªãã¨ã‚‚1å›å±Šã**ï¼ˆ=åŒã˜ã®ãŒæ¥ã‚‹ã‹ã‚‚ï¼‰ã€ã‚’**å‰æ**ã«ã§ãã‚‹ğŸ§ ğŸ›¡ï¸
* CampusCafeã®æµã‚Œï¼ˆæ³¨æ–‡â†’åœ¨åº«â†’æ±ºæ¸ˆâ†’é€šçŸ¥ï¼‰ã‚’ã€**ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¨­è¨ˆ**ã«è½ã¨ã›ã‚‹â˜•ğŸ“¦ğŸ’³ğŸ””

---

## ã¾ãšè¶…é‡è¦ï¼šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°ã¯â€œåˆ†æ•£ã®ç­‹ãƒˆãƒ¬â€ğŸ‹ï¸â€â™€ï¸ğŸ“¨

HTTPã§åŒæœŸé€£é–ã™ã‚‹ã¨ã€ã©ã“ã‹ãŒé…ã„/è½ã¡ãŸç¬é–“ã«å…¨ä½“ãŒå¼•ããšã‚‰ã‚ŒãŒã¡â€¦ğŸ˜µâ€ğŸ’«
ãã“ã§ **ã€Œä»Šã¯ä¾é ¼ã ã‘ã—ã¦ã€å‡¦ç†ã¯å¾Œã§ã€** ã‚’ä½œã‚Œã‚‹ã®ãŒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°ã ã‚ˆğŸ“¬âœ¨

---

# 1) ã‚¤ãƒ™ãƒ³ãƒˆã¨ã‚³ãƒãƒ³ãƒ‰ã€ã„ã¡ã°ã‚“ç°¡å˜ãªè¦‹åˆ†ã‘æ–¹ğŸ”

![cap_cs_study_014_command_event_metaphor](./picture/cap_cs_study_014_command_event_metaphor.png)

## âœ… ã‚³ãƒãƒ³ãƒ‰ï¼ˆCommandï¼‰ğŸ§¾ğŸ‘‰

* **ã€Œã‚„ã£ã¦ï¼ã€**ï¼ˆä¾é ¼ãƒ»å‘½ä»¤ï¼‰
* å®›å…ˆãŒã ã„ãŸã„**1ã¤**ï¼ˆæ‹…å½“è€…/æ‹…å½“ã‚µãƒ¼ãƒ“ã‚¹ãŒã„ã‚‹ï¼‰
* å¤±æ•—ã—ãŸã‚‰ã€Œã§ããªã‹ã£ãŸã€ã£ã¦è¿”ã—ãŸã„æ°—æŒã¡ãŒå¼·ã„ğŸ¥º

ä¾‹ï¼š

* `PlaceOrder`ï¼ˆæ³¨æ–‡ã—ã¦ï¼ï¼‰â˜•
* `ReserveStock`ï¼ˆåœ¨åº«ç¢ºä¿ã—ã¦ï¼ï¼‰ğŸ“¦
* `CapturePayment`ï¼ˆæ±ºæ¸ˆç¢ºå®šã—ã¦ï¼ï¼‰ğŸ’³

## âœ… ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆEventï¼‰ğŸ“£âœ¨

* **ã€Œèµ·ããŸã‚ˆï¼ã€**ï¼ˆäº‹å®Ÿã®é€šçŸ¥ï¼‰
* å®›å…ˆã¯**ä¸ç‰¹å®šå¤šæ•°**ï¼ˆèª°ãŒèã„ã¦ã‚‚ã„ã„ï¼‰
* å¤±æ•—ã—ãŸã‚‰ã€Œã‚¤ãƒ™ãƒ³ãƒˆãŒæ¶ˆãˆã‚‹ã€ã®ãŒä¸€ç•ªã“ã‚ã„ğŸ˜±ï¼ˆå¾Œã§å–ã‚Šè¿”ã›ãªã„ï¼‰

ä¾‹ï¼š

* `OrderPlaced`ï¼ˆæ³¨æ–‡ãŒä½œã‚‰ã‚ŒãŸã‚ˆï¼‰â˜•âœ¨
* `StockReserved`ï¼ˆåœ¨åº«ç¢ºä¿ã§ããŸã‚ˆï¼‰ğŸ“¦âœ…
* `PaymentCaptured`ï¼ˆæ±ºæ¸ˆã§ããŸã‚ˆï¼‰ğŸ’³âœ…
* `CustomerNotified`ï¼ˆé€šçŸ¥ã—ãŸã‚ˆï¼‰ğŸ””âœ…

---

# 2) å‘½åã®é‰„æ¿ãƒ«ãƒ¼ãƒ«ï¼ˆã“ã‚Œã ã‘ã§è¿·ã„æ¿€æ¸›ï¼‰ğŸ§ âœ¨

## å‘½åãƒ†ãƒ³ãƒ—ãƒ¬ğŸ§©

* **ã‚³ãƒãƒ³ãƒ‰**ï¼šå‹•è©ã®åŸå½¢ï¼ˆå‘½ä»¤å½¢ã£ã½ã„ï¼‰

  * `PlaceOrder`, `ReserveStock`, `SendNotification`
* **ã‚¤ãƒ™ãƒ³ãƒˆ**ï¼šéå»å½¢ï¼ˆèµ·ããŸäº‹å®Ÿï¼‰

  * `OrderPlaced`, `StockReserved`, `NotificationSent`

> â€œã‚¤ãƒ™ãƒ³ãƒˆã¯ãƒ­ã‚°ã«æ®‹ã™äº‹å®Ÿâ€ã€ã‚³ãƒãƒ³ãƒ‰ã¯â€œã‚„ã£ã¦ã»ã—ã„ãŠé¡˜ã„â€ã ã‚ˆğŸ˜ŠğŸ“

---

# 3) CampusCafeã‚’ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§è¡¨ã™ã¨ã“ã†ãªã‚‹â˜•ğŸ“¨

## ã–ã£ãã‚Šæµã‚Œï¼ˆç†æƒ³å½¢ï¼‰ğŸ—ºï¸âœ¨

```mermaid
sequenceDiagram
    participant User as ãƒ¦ãƒ¼ã‚¶ãƒ¼ğŸ“±
    participant Order as æ³¨æ–‡ã‚µãƒ¼ãƒ“ã‚¹ğŸ›’
    participant Stock as åœ¨åº«ã‚µãƒ¼ãƒ“ã‚¹ğŸ“¦
    participant Pay as æ±ºæ¸ˆã‚µãƒ¼ãƒ“ã‚¹ğŸ’³
    participant Noti as é€šçŸ¥ã‚µãƒ¼ãƒ“ã‚¹ğŸ””

    User->>Order: æ³¨æ–‡ (PlaceOrder)
    Order->>Order: å—ä»˜ & ä¿å­˜
    Order-->>User: å—ä»˜å®Œäº†âœ…
    
    Order->>Stock: ã‚¤ãƒ™ãƒ³ãƒˆ: OrderPlacedğŸ“£
    Note over Stock: ã‚³ãƒãƒ³ãƒ‰: ReserveStockå—é ˜
    Stock->>Stock: åœ¨åº«ç¢ºä¿
    
    Stock->>Pay: ã‚¤ãƒ™ãƒ³ãƒˆ: StockReservedğŸ“£
    Note over Pay: ã‚³ãƒãƒ³ãƒ‰: CapturePaymentå—é ˜
    Pay->>Pay: æ±ºæ¸ˆå®Ÿè¡Œ
    
    Pay->>Noti: ã‚¤ãƒ™ãƒ³ãƒˆ: PaymentCapturedğŸ“£
    Note over Noti: ã‚³ãƒãƒ³ãƒ‰: SendNotificationå—é ˜
    Noti->>User: é€šçŸ¥é€ä¿¡ğŸ””
```


1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ³¨æ–‡

   * ã‚³ãƒãƒ³ãƒ‰ï¼š`PlaceOrder`
2. æ³¨æ–‡ãŒä½œã‚‰ã‚ŒãŸ

   * ã‚¤ãƒ™ãƒ³ãƒˆï¼š`OrderPlaced`
3. åœ¨åº«ã‚’ç¢ºä¿ã™ã‚‹

   * ã‚³ãƒãƒ³ãƒ‰ï¼š`ReserveStock`
4. åœ¨åº«ãŒç¢ºä¿ã§ããŸ

   * ã‚¤ãƒ™ãƒ³ãƒˆï¼š`StockReserved`
5. æ±ºæ¸ˆã‚’ç¢ºå®šã™ã‚‹

   * ã‚³ãƒãƒ³ãƒ‰ï¼š`CapturePayment`
6. æ±ºæ¸ˆã§ããŸ

   * ã‚¤ãƒ™ãƒ³ãƒˆï¼š`PaymentCaptured`
7. é€šçŸ¥ã™ã‚‹

   * ã‚³ãƒãƒ³ãƒ‰ï¼š`SendNotification`
8. é€šçŸ¥ã—ãŸ

   * ã‚¤ãƒ™ãƒ³ãƒˆï¼š`NotificationSent`

ã€Œã‚¤ãƒ™ãƒ³ãƒˆãŒæ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å‘¼ã¶ã€å½¢ã«ã™ã‚‹ã¨ã€åŒæœŸã®é–ãŒæ¸›ã£ã¦ã€æ­¢ã¾ã‚Šã«ãããªã‚‹ã‚ˆğŸ“£â¡ï¸ğŸ§¾âœ¨

---

# 4) â€œå°‘ãªãã¨ã‚‚1å›å±Šãâ€ã£ã¦ä½•ï¼Ÿï¼ˆã“ã®è¬›åº§ã®è¶…å¤§å‰æï¼‰ğŸ“¨ğŸ“¨ğŸ˜‡

ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°åŸºç›¤ã¯ã€ä¿¡é ¼æ€§ã®ãŸã‚ã«**å†é€**ã™ã‚‹ã“ã¨ãŒã‚ã‚‹ã‚ˆğŸ”
ã ã‹ã‚‰ **åŒã˜ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒ2å›å±Šã** ã®ã¯æ™®é€šã«èµ·ãã‚‹â€¦ï¼ğŸ˜³

* Azure Service Bus ã¯ä¿¡é ¼æ€§æ©Ÿèƒ½ã¨ã—ã¦ **at-least-onceï¼ˆå°‘ãªãã¨ã‚‚1å›ï¼‰é…é€** ã‚„ DLQ ã‚’å«ã‚€ã€ã¨èª¬æ˜ã•ã‚Œã¦ã‚‹ã‚ˆğŸ“¬ğŸ§± ([Microsoft Learn][1])
* RabbitMQ ã‚‚ **ACKï¼ˆç¢ºèªå¿œç­”ï¼‰ã‚’ä½¿ã†ã¨ at-least-once** ã«ãªã‚‹ã€ã£ã¦å…¬å¼ã§è¨€ã£ã¦ã‚‹ã‚ˆğŸ‡ğŸ“¨ ([rabbitmq.com][2])
* è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ã®ä¸–ç•Œã§ã¯ **åŒã˜ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å†å‡¦ç†ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹**ï¼ˆã ã‹ã‚‰å†ªç­‰ãŒå¿…è¦ï¼‰ã¨ã„ã†è©±ã‚‚å®šç•ªã ã‚ˆğŸ”ğŸ›¡ï¸ ([docs.particular.net][3])

âœ… çµè«–ï¼š**ã€Œ1å›ã ã‘æ¥ã‚‹ã€å‰æã¯ç¦æ­¢ğŸ™…â€â™€ï¸**
ä»£ã‚ã‚Šã«ã€å—ã‘æ‰‹ã¯ **â€œã¾ãŸæ¥ã¦ã‚‚å£Šã‚Œãªã„â€** ã‚’ç›®æŒ‡ã™ï¼ˆå†ªç­‰æ€§ã¯æ¬¡ã®ç« ã§æœ¬æ ¼çš„ã«ã‚„ã‚‹ã‚ˆğŸ›¡ï¸âœ¨ï¼‰

---

# 5) æœ€ä½é™ã¤ã‘ãŸã„â€œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å°ç­’ï¼ˆã‚¨ãƒ³ãƒ™ãƒ­ãƒ¼ãƒ—ï¼‰â€âœ‰ï¸ğŸ§¾

ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æœ¬æ–‡ï¼ˆPayloadï¼‰ã ã‘ã ã¨ã€é‹ç”¨ã§è©°ã¿ãŒã¡ğŸ˜‡
ã¾ãšã¯ã“ã®ã¸ã‚“ã‚’æŒãŸã›ã‚‹ã®ãŒè¶…ãŠã™ã™ã‚ğŸ‘‡

* `MessageId`ï¼šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è‡ªä½“ã®IDï¼ˆGuidï¼‰ğŸ†”
* `CorrelationId`ï¼šä¸€é€£ã®æµã‚Œã®IDï¼ˆæ³¨æ–‡å…¨ä½“ã®è¿½è·¡ï¼‰ğŸ§µ
* `CausationId`ï¼šã“ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®åŸå› ã«ãªã£ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸IDï¼ˆå› æœé–¢ä¿‚ï¼‰ğŸ”—
* `OccurredAt`ï¼šç™ºç”Ÿæ™‚åˆ»ğŸ•’
* ï¼ˆã‚ã‚Œã°ï¼‰`IdempotencyKey`ï¼šé‡è¤‡æ’é™¤ã®ã‚­ãƒ¼ğŸ”‘

---

# 6) ãƒŸãƒ‹å®Ÿè£…ï¼šç–‘ä¼¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°ã§â€œ2å›å±Šãä¸–ç•Œâ€ã‚’ä½“é¨“ã—ã‚ˆã†ğŸ§ªğŸ“¨

ã“ã“ã§ã¯æœ¬ç‰©ã®ãƒ–ãƒ­ãƒ¼ã‚«ãƒ¼ã®ä»£ã‚ã‚Šã«ã€**Channel + BackgroundService** ã§ã€Œãã‚Œã£ã½ã„ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°ã‚’ä½œã‚‹ã‚ˆğŸ˜Š
BackgroundService ã¯ .NET ã®ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã§é•·æœŸå‡¦ç†ã‚’ä½œã‚‹å®šç•ªã‚¯ãƒ©ã‚¹ã ã‚ˆğŸ§° ([Microsoft Learn][4])

## 6-1) ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å®šç¾©ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆ/ã‚³ãƒãƒ³ãƒ‰ï¼‰ğŸ§©

```csharp
using System.Text.Json.Serialization;

public interface IMessage
{
    Guid MessageId { get; }
    Guid CorrelationId { get; }
    Guid? CausationId { get; }
    DateTimeOffset OccurredAt { get; }
}

public abstract record MessageBase(
    Guid MessageId,
    Guid CorrelationId,
    Guid? CausationId,
    DateTimeOffset OccurredAt
) : IMessage;

public interface ICommand : IMessage;
public interface IEvent : IMessage;

// Command
public sealed record PlaceOrder(
    Guid MessageId,
    Guid CorrelationId,
    Guid? CausationId,
    DateTimeOffset OccurredAt,
    string UserId,
    string[] ItemIds
) : MessageBase(MessageId, CorrelationId, CausationId, OccurredAt), ICommand;

// Event
public sealed record OrderPlaced(
    Guid MessageId,
    Guid CorrelationId,
    Guid? CausationId,
    DateTimeOffset OccurredAt,
    string OrderId,
    string UserId,
    string[] ItemIds
) : MessageBase(MessageId, CorrelationId, CausationId, OccurredAt), IEvent;
```

## 6-2) â€œã¨ã‚Šã‚ãˆãšå‹•ãâ€ãƒã‚¹ï¼ˆChannelï¼‰ğŸ“¬

```csharp
using System.Threading.Channels;

public interface IMessageBus
{
    ValueTask PublishAsync(IMessage message, CancellationToken ct = default);
    ChannelReader<IMessage> Reader { get; }
}

public sealed class InMemoryMessageBus : IMessageBus
{
    private readonly Channel<IMessage> _channel = Channel.CreateUnbounded<IMessage>();

    public ChannelReader<IMessage> Reader => _channel.Reader;

    public ValueTask PublishAsync(IMessage message, CancellationToken ct = default)
        => _channel.Writer.WriteAsync(message, ct);
}
```

## 6-3) Consumerï¼ˆå—ã‘æ‰‹ï¼‰â€” ã‚ã–ã¨â€œé‡è¤‡â€ã‚’ç™ºç”Ÿã•ã›ã‚‹ğŸ˜ˆğŸ“¨ğŸ“¨

```csharp
using Microsoft.Extensions.Hosting;

public sealed class MessageConsumer : BackgroundService
{
    private readonly IMessageBus _bus;
    private readonly Random _random = new();

    public MessageConsumer(IMessageBus bus) => _bus = bus;

    protected override async Task ExecuteAsync(CancellationToken stoppingToken)
    {
        await foreach (var msg in _bus.Reader.ReadAllAsync(stoppingToken))
        {
            Console.WriteLine($"ğŸ“¨ Received: {msg.GetType().Name} id={msg.MessageId} corr={msg.CorrelationId}");

            // ğŸ’¥ â€œå°‘ãªãã¨ã‚‚1å›â€ã®é›°å›²æ°—ï¼šãŸã¾ã«åŒã˜ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å†æŠ•å…¥ï¼ˆ=é‡è¤‡é…é€ã£ã½ã„ï¼‰
            if (_random.NextDouble() < 0.25)
            {
                Console.WriteLine("âš ï¸ Simulate redelivery (duplicate)!");
                await _bus.PublishAsync(msg, stoppingToken);
            }

            // ã“ã“ã§ã¯å‡¦ç†ã¯æœ€å°é™ï¼šã‚³ãƒãƒ³ãƒ‰ãŒæ¥ãŸã‚‰ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‡ºã™
            if (msg is PlaceOrder cmd)
            {
                var evt = new OrderPlaced(
                    MessageId: Guid.NewGuid(),
                    CorrelationId: cmd.CorrelationId,
                    CausationId: cmd.MessageId,
                    OccurredAt: DateTimeOffset.UtcNow,
                    OrderId: $"ORD-{Guid.NewGuid():N}",
                    UserId: cmd.UserId,
                    ItemIds: cmd.ItemIds
                );

                await _bus.PublishAsync(evt, stoppingToken);
                Console.WriteLine("ğŸ“£ Published: OrderPlaced");
            }
        }
    }
}
```

## 6-4) Minimal APIã§æŠ•å…¥ï¼ˆ/ordersï¼‰â˜•ğŸ“±

Minimal API ã¯ ASP.NET Core ã®è»½é‡APIã®ä½œã‚Šæ–¹ã¨ã—ã¦å…¬å¼ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ãŒã‚ã‚‹ã‚ˆğŸ§°âœ¨ ([Microsoft Learn][5])

```csharp
using Microsoft.AspNetCore.Builder;
using Microsoft.Extensions.DependencyInjection;

var builder = WebApplication.CreateBuilder(args);

builder.Services.AddSingleton<IMessageBus, InMemoryMessageBus>();
builder.Services.AddHostedService<MessageConsumer>();

var app = builder.Build();

app.MapPost("/orders", async (IMessageBus bus) =>
{
    var corr = Guid.NewGuid();

    var cmd = new PlaceOrder(
        MessageId: Guid.NewGuid(),
        CorrelationId: corr,
        CausationId: null,
        OccurredAt: DateTimeOffset.UtcNow,
        UserId: "u-001",
        ItemIds: new[] { "cake-01", "coffee-02" }
    );

    await bus.PublishAsync(cmd);
    return Results.Ok(new { message = "queued", correlationId = corr });
});

app.Run();
```

## 6-5) å‹•ã‹ã—æ–¹ï¼ˆè¶…ã‹ã‚“ãŸã‚“ï¼‰â–¶ï¸âœ¨

1. èµ·å‹•ã—ã¦ `/orders` ã‚’å©ã
2. ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã« **åŒã˜ MessageId ãŒè¤‡æ•°å›å‡ºã‚‹**ã“ã¨ãŒã‚ã‚‹ï¼ˆï¼é‡è¤‡é…é€ã®ä½“é¨“ï¼‰ğŸ“¨ğŸ“¨ğŸ˜‡
3. `OrderPlaced` ãŒ `CausationId` ã§ `PlaceOrder` ã‚’æŒ‡ã—ã¦ã‚‹ã®ã‚‚è¦³å¯ŸğŸ”—âœ¨

---

# 7) ãƒŸãƒ‹æ¼”ç¿’ï¼šã‚¤ãƒ™ãƒ³ãƒˆï¼Ÿã‚³ãƒãƒ³ãƒ‰ï¼Ÿã©ã£ã¡ï¼ŸğŸ“ğŸŒ¸

æ¬¡ã‚’åˆ†é¡ã—ã¦ã¿ã¦ã­ğŸ‘‡ï¼ˆç›´æ„Ÿã§OKï¼ï¼‰

1. `CancelOrder`
2. `OrderCancelled`
3. `ReserveStock`
4. `StockReservationFailed`
5. `SendNotification`
6. `NotificationSent`
7. `CapturePayment`
8. `PaymentCaptured`
9. `RefundPayment`
10. `PaymentRefunded`

## âœ… ç­”ãˆåˆã‚ã›ğŸ¯

* ã‚³ãƒãƒ³ãƒ‰ğŸ§¾ğŸ‘‰ï¼š1, 3, 5, 7, 9
* ã‚¤ãƒ™ãƒ³ãƒˆğŸ“£âœ¨ï¼š2, 4, 6, 8, 10

---

# 8) â€œç¾å®Ÿã®ã‚¯ã‚»â€äºˆå‘Šï¼ˆæ¬¡ç« ã§åœ°ç„ã‚’è¦‹ã‚‹ã‚„ã¤ğŸ˜‡ï¼‰âš ï¸

ã“ã®ç« ã§ä½œã£ãŸãƒŸãƒ‹å®Ÿè£…ã§ã‚‚ã€ã™ã§ã«é›°å›²æ°—ã¯å‡ºã¦ãŸã¯ãšğŸ‘‡

* **é‡è¤‡**ï¼šåŒã˜ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒ2å›ä»¥ä¸Šå±ŠãğŸ“¨ğŸ“¨
* **é †ç•ªå‰å¾Œ**ï¼šå¾Œã§èµ·ããŸã®ãŒå…ˆã«å‡¦ç†ã•ã‚Œã‚‹ğŸ”€
* **é…å»¶/å–ã‚Šã“ã¼ã—**ï¼šæ¥ãªã„/é…ã„/ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆğŸ¢ğŸ•³ï¸

æ¬¡ã®ç« ã‹ã‚‰ã€ã“ã‚Œã‚’ **ã¡ã‚ƒã‚“ã¨è¨­è¨ˆã§å—ã‘æ­¢ã‚ã‚‹** ã‚ˆğŸ›¡ï¸âœ¨

---

# 9) AIæ´»ç”¨ï¼ˆå‘½åã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¨­è¨ˆã®ãƒ–ãƒ¼ã‚¹ãƒˆï¼‰ğŸ¤–âœ¨

## å‘½åæ¡ˆã‚’å¢—ã‚„ã™ğŸ§ ğŸ“›

* ã€ŒCampusCafeã®æ³¨æ–‡ã€œæ±ºæ¸ˆã€œé€šçŸ¥ã§ã€ã‚³ãƒãƒ³ãƒ‰åã¨ã‚¤ãƒ™ãƒ³ãƒˆåã‚’â€œè‹±èªã®è‡ªç„¶ãªå‘½åâ€ã§20å€‹ãšã¤å‡ºã—ã¦ã€‚éå»å½¢/å‘½ä»¤å½¢ãƒ«ãƒ¼ãƒ«ã‚‚å®ˆã£ã¦ã€

## ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ä¸­èº«ã‚’æ•´ãˆã‚‹ğŸ§¾ğŸ§©

* ã€Œ`OrderPlaced` ã® payload ã«å…¥ã‚Œã‚‹ã¹ãæœ€å°é …ç›®ã¨ã€å…¥ã‚Œãªã„æ–¹ãŒã„ã„é …ç›®ã‚’ç†ç”±ã¤ãã§æ•´ç†ã—ã¦ã€

## å› æœé–¢ä¿‚ã‚’ãƒã‚§ãƒƒã‚¯ğŸ”—ğŸ”

* ã€Œã“ã®ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ãƒ•ãƒ­ãƒ¼ã® causation/correlation ã®ä»˜ã‘æ–¹ãŒç ´ç¶»ã—ã¦ãªã„ã‹ã€å¤‰ãªã¨ã“ã‚ã‚’æŒ‡æ‘˜ã—ã¦ã€

---

## å‚è€ƒï¼ˆã“ã®ç« ã§è§¦ã‚ŒãŸâ€œæœ€æ–°ã®æ ¹æ‹ â€ï¼‰ğŸ“šâœ¨

* .NET ã®ç¾è¡Œã‚µãƒãƒ¼ãƒˆè¡¨ï¼ˆ.NET 10 ã¯ LTSã€æœ€æ–°ãƒ‘ãƒƒãƒãªã©ï¼‰ ([Microsoft][6])
* Azure Service Bus ã®ä¿¡é ¼æ€§æ©Ÿèƒ½ï¼ˆat-least-once, DLQ ãªã©ï¼‰ ([Microsoft Learn][1])
* RabbitMQ ã® at-least-once ã¨ ACK ã®èª¬æ˜ ([rabbitmq.com][2])

[1]: https://learn.microsoft.com/en-us/azure/reliability/reliability-service-bus?utm_source=chatgpt.com "Reliability in Azure Service Bus"
[2]: https://www.rabbitmq.com/docs/reliability?utm_source=chatgpt.com "Reliability Guide"
[3]: https://docs.particular.net/nservicebus/azure/ways-to-live-without-transactions?utm_source=chatgpt.com "Avoiding Transactions in Azure â€¢ NServiceBus"
[4]: https://learn.microsoft.com/en-us/dotnet/api/microsoft.extensions.hosting.backgroundservice?view=net-10.0-pp&utm_source=chatgpt.com "BackgroundService Class (Microsoft.Extensions.Hosting)"
[5]: https://learn.microsoft.com/ja-jp/aspnet/core/tutorials/min-web-api?view=aspnetcore-10.0&utm_source=chatgpt.com "ASP.NET Core ã‚’ä½¿ç”¨ã—ã¦æœ€å°é™ã® API ã‚’ä½œæˆã™ã‚‹"
[6]: https://dotnet.microsoft.com/ja-jp/platform/support/policy/dotnet-core?utm_source=chatgpt.com ".NET ãŠã‚ˆã³ .NET Core ã®å…¬å¼ã‚µãƒãƒ¼ãƒˆ ãƒãƒªã‚·ãƒ¼"
