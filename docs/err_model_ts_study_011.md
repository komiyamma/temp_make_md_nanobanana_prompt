# ç¬¬11ç« ï¼šã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ©ãƒ¼å…¥é–€ï¼ˆç¾å®Ÿã¯è½ã¡ã‚‹ğŸŒ©ï¸ï¼‰ğŸ”Œ

å¤–éƒ¨I/Oï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ»DBãƒ»å¤–éƒ¨APIãƒ»ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸â€¦ï¼‰ã£ã¦ã€**ã¡ã‚ƒã‚“ã¨ä½œã£ã¦ã¦ã‚‚æ™®é€šã«è½ã¡ã¾ã™**ğŸ˜‡
ã“ã®ç« ã¯ã€Œè½ã¡ã‚‹å‰æã§ã€è½ã¡æ–¹ã‚’â€œè¨­è¨ˆâ€ã™ã‚‹ã€ãŸã‚ã®å…¥é–€ã ã‚ˆã€œğŸ’ªâœ¨

---

## 1) ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ©ãƒ¼ã£ã¦ãªã«ï¼ŸğŸ¤”ğŸŒ

ã–ã£ãã‚Šè¨€ã†ã¨ **ã€Œè‡ªåˆ†ã®ã‚³ãƒ¼ãƒ‰ã®å¤–ã§èµ·ãã‚‹å¤±æ•—ã€** ã ã‚ˆğŸ”Œ

* ãƒãƒƒãƒˆãŒä¸å®‰å®šğŸ“¶
* DNSãŒå¼•ã‘ãªã„ï¼ˆåå‰è§£æ±ºã§ããªã„ï¼‰ğŸ”
* TLS/è¨¼æ˜æ›¸ã§æ¡æ‰‹ã§ããªã„ğŸ”
* ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆå¾…ã¡ã™ãï¼‰â³
* ç›¸æ‰‹ãŒè½ã¡ã¦ã‚‹ï¼ˆ5xxï¼‰ğŸ§¯
* æ··ã¿ã™ãã§å¼¾ã‹ã‚Œã‚‹ï¼ˆ429ï¼‰ğŸš¦

ã“ã“ã§å¤§äº‹ãªã®ã¯ğŸ‘‡
ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ©ãƒ¼ã¯ã€Œç›´ã™ã€ã‚ˆã‚Š **â€œè€ãˆã‚‹â€** ãŒãƒ¡ã‚¤ãƒ³ã«ãªã‚‹ã“ã¨ãŒå¤šã„ã£ã¦ã“ã¨ğŸ™‚ğŸ›¡ï¸

---

## 2) ã¾ãšæœ€åˆã«è¦šãˆã‚‹2åˆ†é¡ï¼šä¸€æ™‚çš„ï¼Ÿæ’ä¹…çš„ï¼ŸğŸ”ğŸ§±

![Transientï¼ˆä¸€æ™‚çš„ï¼‰ vs Permanentï¼ˆæ°¸ç¶šçš„ï¼‰[(./picture/err_model_ts_study_011_transient_cloud.png)

### âœ… ä¸€æ™‚çš„ï¼ˆãƒªãƒˆãƒ©ã‚¤ã§æ²»ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ï¼‰ğŸ”

* ä¸€ç¬ã®é€šä¿¡ã‚¨ãƒ©ãƒ¼ã€ç¬æ–­ğŸ“¶
* ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆâ³
* 429ï¼ˆæ··é›‘ãƒ»ãƒ¬ãƒ¼ãƒˆåˆ¶é™ï¼‰ğŸš¦
* 502/503/504ï¼ˆç›¸æ‰‹ã®ä¸€æ™‚ä¸èª¿ï¼‰ğŸ§¯
  ã“ã†ã„ã†ã®ã¯ **ã€Œæ™‚é–“ã‚’ç½®ã„ã¦å†è©¦è¡Œã€** ãŒåŠ¹ãã“ã¨ãŒã‚ã‚‹ã‚ˆâœ¨
  ï¼ˆãŸã ã—ç„¡é™ã«ã‚„ã‚‹ã®ã¯ãƒ€ãƒ¡ï¼å¾Œã§ã‚„ã‚‹ã‚ˆğŸ«£ï¼‰

### âŒ æ’ä¹…çš„ï¼ˆãƒªãƒˆãƒ©ã‚¤ã—ã¦ã‚‚ã»ã¼ç„¡æ„å‘³ï¼‰ğŸ§±

* URLãŒé–“é•ã„ï¼ˆãšã£ã¨ãƒ€ãƒ¡ï¼‰ğŸ§©
* èªè¨¼ãƒŸã‚¹ï¼ˆ401/403ï¼‰ğŸ”
* å…¥åŠ›ãŒæ‚ªã„ï¼ˆ400/422ï¼‰âœï¸
* 404ï¼ˆåŸºæœ¬ã¯ç„¡ã„ã‚‚ã®ã¯ç„¡ã„ï¼‰ğŸ« 

---

## 3) â€œå†è©¦è¡Œã—ã¦ã„ã„ã‹â€ã¯ã€å®Ÿã¯ã‚‚ã†1å€‹æ¡ä»¶ãŒã‚ã‚‹âš ï¸ğŸ§¨

ãã‚ŒãŒ **ã€ŒåŒã˜ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚‚ã†ä¸€å›é€ã£ã¦ã‚‚å®‰å…¨ï¼Ÿã€** ã ã‚ˆğŸ™‚

HTTPã«ã¯ã€Œå†ªç­‰ï¼ˆidempotentï¼‰ã€ã£ã¦æ¦‚å¿µãŒã‚ã£ã¦ã€**åŒã˜æ“ä½œã‚’ä½•å›ã‚„ã£ã¦ã‚‚çµæœãŒåŒã˜ã«ãªã‚Šã‚„ã™ã„ãƒ¡ã‚½ãƒƒãƒ‰**ãŒã‚ã‚‹ã®ğŸ‘‡
RFCã§ã¯ **PUT / DELETE ã¨ â€œsafe methodï¼ˆGET/HEADãªã©ï¼‰â€ ã¯å†ªç­‰** ã¨ã•ã‚Œã¦ã‚‹ã‚ˆğŸ“˜âœ¨ ([RFCã‚¨ãƒ‡ã‚£ã‚¿][1])

* âœ… å†è©¦è¡Œã—ã‚„ã™ã„ï¼šGET / HEAD / PUT / DELETE ğŸ‘
* âš ï¸ æ³¨æ„ï¼šPOSTï¼ˆåŒã˜æ³¨æ–‡ãŒ2å›é€šã£ãŸã‚‰åœ°ç„ğŸ˜±ï¼‰

> ã ã‹ã‚‰ã€Œä¸€æ™‚çš„ã«è½ã¡ãŸã‹ã‚‰ãƒªãƒˆãƒ©ã‚¤ã—ã‚ˆã€œã€ã¯ã€**æ“ä½œã®ç¨®é¡**ã‚‚ã‚»ãƒƒãƒˆã§åˆ¤æ–­ãŒå¿…è¦ãªã‚“ã ã‚ˆã­ğŸ§ ğŸ’¡

---

## 4) fetchã®â€œè¶…é‡è¦ãƒã‚¤ãƒ³ãƒˆâ€ğŸŒğŸ§ ï¼ˆã“ã“ã§äº‹æ•…ã‚‹äººãŒå¤šã„ï¼‰

### âœ… fetchã¯ã€ŒHTTPã‚¨ãƒ©ãƒ¼ï¼ˆ404ã¨ã‹ï¼‰ã€ã§ã¯å¤±æ•—æ‰±ã„ã«ãªã‚‰ãªã„ğŸ˜³

`fetch()` ã® Promise ãŒ reject ã•ã‚Œã‚‹ã®ã¯ã€ä¸»ã« **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ç­‰**ã®ã¨ãã€‚
**404/500ã¿ãŸã„ãªHTTPã‚¨ãƒ©ãƒ¼ã§ã‚‚ã€Promiseã¯æˆåŠŸï¼ˆresolveï¼‰ã—ã¦ Response ãŒè¿”ã‚‹**ã‹ã‚‰ã€`response.ok` / `response.status` ã‚’è‡ªåˆ†ã§ãƒã‚§ãƒƒã‚¯ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‚ˆğŸ‘€âœ¨ ([MDN Web Docs][2])

```mermaid
flowchart TD
    Fetch["fetch('http://api...')"] --> Result{çµæœã¯ï¼Ÿ}
    Result -- "Network Error\n(DNS/Timeout)" --> Reject["Reject ğŸ’¥\n(catchã¸)"]
    Result -- "HTTP 404/500" --> Resolve["Resolve âœ…\n(ok: false)"]
    Result -- "HTTP 200" --> ResolveOK["Resolve âœ…\n(ok: true)"]
    
    Resolve --> Check{res.ok Check}
    Check -- false --> ManualErr[è‡ªåˆ†ã§ Error ã‚’æŠ•ã’ã‚‹]
```

---

## 5) ã¾ãšã¯â€œã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆâ€ã‚’æ¨™æº–è£…å‚™ã—ã‚ˆâ³ğŸ›‘

ã€Œå¾…ã¡ç¶šã‘ã‚‹ã€ã¯æœ€æ‚ªã®UXï¼†æœ€æ‚ªã®é‹ç”¨â€¦ğŸ˜‡
æœ€è¿‘ã¯ `AbortSignal.timeout()` ãŒä½¿ã„ã‚„ã™ã„ã‚ˆâœ¨
ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚‚ç¾è¡Œç’°å¢ƒã§åºƒãä½¿ãˆã‚‹æ‰±ã„ã«ãªã£ã¦ã‚‹ã‚ˆğŸ“Œ ([MDN Web Docs][3])ï¼‰
Nodeå´ã§ã‚‚ `AbortSignal.timeout(delay)` ãŒç”¨æ„ã•ã‚Œã¦ã‚‹ã‚ˆğŸ§° ([Node.js][4])

```ts
// ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆä»˜ã fetchï¼ˆåŸºæœ¬å½¢ï¼‰â³
export async function fetchWithTimeout(
  input: RequestInfo | URL,
  init: RequestInit & { timeoutMs?: number } = {}
) {
  const { timeoutMs = 10_000, ...rest } = init;

  // timeoutã‚·ã‚°ãƒŠãƒ«ï¼ˆç¾è¡Œç’°å¢ƒã§ä¾¿åˆ©ï¼‰âœ¨
  const signal = AbortSignal.timeout(timeoutMs);

  return fetch(input, { ...rest, signal });
}
```

---

## 6) ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ©ãƒ¼ã‚’â€œç¨®é¡â€ã§æ‰±ã†ï¼ˆæ–‡å­—åˆ—ã§åˆ¤å®šã—ãªã„ğŸ˜µâ€ğŸ’«ï¼‰

ã“ã®ç« ã§ã¯ã€ã¾ãš **ã€Œã‚¤ãƒ³ãƒ•ãƒ©å¤±æ•—ã€ã‚’1ã¤ã®å½¢ã«ã¾ã¨ã‚ã‚‹** ã¨ã“ã‚ã¾ã§ã‚„ã‚ã†ğŸ™‚âœ¨
ï¼ˆæ¬¡ã®ç« ä»¥é™ã§ã€ã‚‚ã£ã¨ç¶ºéº—ã«â€œæ­£è¦åŒ–â€ã—ã¦ã„ãã‚ˆğŸ§¼ï¼‰

```ts
// ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ©ãƒ¼ï¼ˆå…¥é–€ç‰ˆï¼‰ğŸ”Œ
export type InfraError =
  | { kind: "timeout"; retryable: true; message: string }
  | { kind: "network"; retryable: true; message: string }
  | { kind: "rate_limit"; retryable: true; retryAfterMs?: number; message: string }
  | { kind: "http"; retryable: boolean; status: number; message: string }
  | { kind: "unknown_infra"; retryable: false; message: string; original?: unknown };
```

---

## 7) ã€Œå†è©¦è¡ŒOK/NGã€ã®ãƒ«ãƒ¼ãƒ«ï¼ˆå…¥é–€ã®ãŠã™ã™ã‚ï¼‰ğŸ§¾âœ…

ã‚¯ãƒ©ã‚¦ãƒ‰ç³»ã®å…¬å¼ã‚¬ã‚¤ãƒ‰ã§ã‚‚ã€**408 / 429 / 5xx** ã¨ã€ã‚½ã‚±ãƒƒãƒˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚„TCPåˆ‡æ–­ãªã©ãŒ â€œãƒªãƒˆãƒ©ã‚¤å¯¾è±¡â€ ã¨ã—ã¦æŒ™ã’ã‚‰ã‚Œã‚‹ã“ã¨ãŒå¤šã„ã‚ˆğŸ“Œ ([Google Cloud Documentation][5])

### âœ… ãƒªãƒˆãƒ©ã‚¤ã—ã‚„ã™ã„HTTPï¼ˆå…¥é–€ã‚»ãƒƒãƒˆï¼‰

* 408 Request Timeout
* 429 Too Many Requestsï¼ˆæ··é›‘ï¼‰ğŸš¦
* 500 / 502 / 503 / 504ï¼ˆç›¸æ‰‹ã®ä¸€æ™‚ä¸èª¿ï¼‰ğŸ§¯

### âŒ åŸºæœ¬ãƒªãƒˆãƒ©ã‚¤ã—ãªã„

* 400/422ï¼ˆå…¥åŠ›ãŒæ‚ªã„ï¼‰
* 401/403ï¼ˆèªè¨¼/æ¨©é™ï¼‰
* 404ï¼ˆåŸºæœ¬ã¯ç„¡ã„ã‚‚ã®ã¯ç„¡ã„ï¼‰

---

## 8) 429 ã¯ â€œRetry-Afterâ€ ã‚’å°Šé‡ã—ã‚ˆã†â±ï¸ğŸ™

429ã‚„ãƒ¡ãƒ³ãƒ†ç³»ã®å¿œç­”ã§ `Retry-After` ãŒæ¥ã‚‹ã“ã¨ãŒã‚ã‚‹ã‚ˆã€‚
ã“ã‚Œã¯ã€Œã©ã‚Œãã‚‰ã„å¾…ã£ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ã­ã€ã‚’ä¼ãˆã‚‹ãƒ˜ãƒƒãƒ€ãƒ¼ğŸ“® ([MDN Web Docs][6])

```ts
function parseRetryAfterMs(retryAfter: string | null): number | undefined {
  if (!retryAfter) return undefined;

  // ã¾ãšã¯ã€Œç§’ã€å½¢å¼ã ã‘å¯¾å¿œï¼ˆå…¥é–€ï¼‰â±ï¸
  const sec = Number(retryAfter);
  if (Number.isFinite(sec) && sec >= 0) return sec * 1000;

  // HTTP-dateå½¢å¼ã¯æ¬¡ã®ç« ä»¥é™ã§æ‹¡å¼µã—ã¦OKğŸ™‚
  return undefined;
}
```

---

## 9) ãƒãƒƒã‚¯ã‚ªãƒ•ï¼ˆå¾…ã¡æ™‚é–“ï¼‰ï¼‹ã‚¸ãƒƒã‚¿ãƒ¼ï¼ˆã‚†ã‚‰ãï¼‰ã§å®‰å…¨ã«ãƒªãƒˆãƒ©ã‚¤ğŸ”ğŸ²

![ãƒãƒƒã‚¯ã‚ªãƒ•ï¼ˆå¾…ã¡æ™‚é–“ï¼‰ï¼‹ã‚¸ãƒƒã‚¿ãƒ¼ï¼ˆã‚†ã‚‰ãï¼‰ã§å®‰å…¨ã«ãƒªãƒˆãƒ©ã‚¤[(./picture/err_model_ts_study_011_backoff_steps.png)

ãƒªãƒˆãƒ©ã‚¤ã‚’é›‘ã«ã‚„ã‚‹ã¨ã€ã¿ã‚“ãªä¸€æ–‰ã«çªæ’ƒã—ã¦ **éšœå®³ãŒæ‚ªåŒ–**ã™ã‚‹ã“ã¨ãŒã‚ã‚‹ã‚ˆğŸ˜±ï¼ˆãƒªãƒˆãƒ©ã‚¤åµğŸŒªï¸ï¼‰

ãã“ã§å®šç•ªãŒğŸ‘‡

* **Exponential backoffï¼ˆæŒ‡æ•°çš„ã«å¾…ã¡æ™‚é–“ã‚’å¢—ã‚„ã™ï¼‰**
* **Jitterï¼ˆå¾…ã¡æ™‚é–“ã«ãƒ©ãƒ³ãƒ€ãƒ æ€§ã‚’è¶³ã™ï¼‰**

AWSã‚‚ã“ã®è€ƒãˆæ–¹ï¼ˆãƒãƒƒã‚¯ã‚ªãƒ•ï¼†ã‚¸ãƒƒã‚¿ãƒ¼ï¼‰ã‚’æ¨ã—ã¦ã‚‹ã‚ˆğŸ“Œ ([Amazon Web Services, Inc.][7])
Googleã®ã‚¬ã‚¤ãƒ‰ã§ã‚‚ã€ŒæŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ï¼‹ã‚¸ãƒƒã‚¿ãƒ¼ã€ã‚’æ¨å¥¨ã—ã¦ã‚‹ã‚ˆğŸ“Œ ([Google Cloud Documentation][5])

```ts
function calcBackoffMs(attempt: number, base = 200, cap = 5_000): number {
  // attempt: 1,2,3... ã¨ã—ã¦
  const exp = Math.min(cap, base * 2 ** (attempt - 1));
  // jitter: 0.5xã€œ1.0x ãã‚‰ã„ï¼ˆå…¥é–€ï¼‰ğŸ²
  const jitter = 0.5 + Math.random() * 0.5;
  return Math.floor(exp * jitter);
}

function sleep(ms: number): Promise<void> {
  return new Promise((resolve) => setTimeout(resolve, ms));
}
```

---

## 10) fetch ã‚’ InfraError ã«å¤‰æ›ã™ã‚‹ï¼ˆå…¥é–€ç‰ˆï¼‰ğŸ§©âœ¨

```ts
function isRetryableStatus(status: number): boolean {
  return status === 408 || status === 429 || (status >= 500 && status <= 599);
}

export async function fetchJsonAsInfra<T>(
  url: string,
  init: RequestInit & { timeoutMs?: number } = {}
): Promise<{ ok: true; data: T } | { ok: false; error: InfraError }> {
  try {
    const res = await fetchWithTimeout(url, init);

    // fetchã¯HTTPã‚¨ãƒ©ãƒ¼ã§ã‚‚rejectã—ãªã„ã®ã§è‡ªåˆ†ã§è¦‹ã‚‹ğŸ‘€
    if (!res.ok) {
      if (res.status === 429) {
        const retryAfterMs = parseRetryAfterMs(res.headers.get("Retry-After"));
        return {
          ok: false,
          error: {
            kind: "rate_limit",
            retryable: true,
            retryAfterMs,
            message: "æ··é›‘ã—ã¦ã‚‹ã¿ãŸã„ã€‚å°‘ã—å¾…ã£ã¦ã‹ã‚‰ã‚‚ã†ä¸€å›ã‚„ã£ã¦ã­ğŸ™",
          },
        };
      }

      return {
        ok: false,
        error: {
          kind: "http",
          status: res.status,
          retryable: isRetryableStatus(res.status),
          message: `é€šä¿¡ã¯ã§ããŸã‘ã©ã‚¨ãƒ©ãƒ¼ã ã£ãŸã‚ˆï¼ˆHTTP ${res.status}ï¼‰ğŸ’¦`,
        },
      };
    }

    const data = (await res.json()) as T;
    return { ok: true, data };
  } catch (e: unknown) {
    // ã“ã“ã«æ¥ã‚‹ã®ã¯ä¸»ã«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯/ä¸­æ–­/å¤‰ãªURLãªã©ğŸ“¶
    // fetchã¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç­‰ã§rejectã™ã‚‹ã‚ˆğŸ“Œ
    // ï¼ˆHTTP 404/500ã§ã¯rejectã—ãªã„ï¼‰ :contentReference[oaicite:8]{index=8}

    // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã®è¦‹åˆ†ã‘ã¯ç’°å¢ƒå·®ãŒã‚ã‚‹ã®ã§ã€å…¥é–€ã¯ã€Œtimeoutã£ã½ã„/ãã‚Œä»¥å¤–ã€ãã‚‰ã„ã§OKğŸ™‚
    const msg = e instanceof Error ? e.message : "ä¸æ˜ãªã‚¨ãƒ©ãƒ¼";

    const maybeTimeout = msg.toLowerCase().includes("timeout");
    return {
      ok: false,
      error: maybeTimeout
        ? { kind: "timeout", retryable: true, message: "æ™‚é–“åˆ‡ã‚Œã ã£ãŸã‚ˆâ³ ã‚‚ã†ä¸€å›ã‚„ã£ã¦ã¿ã‚ˆğŸ”" }
        : { kind: "network", retryable: true, message: "é€šä¿¡ãŒã†ã¾ãã„ã‹ãªã‹ã£ãŸã‚ˆğŸ“¶ ã‚‚ã†ä¸€å›è©¦ã—ã¦ã¿ã‚ˆğŸ”" },
    };
  }
}
```

---

## 11) â€œå†è©¦è¡ŒOK/NGè¡¨â€ã‚’ä½œã‚‹ãƒŸãƒ‹æ¼”ç¿’ğŸ“ğŸ”

ã‚ãªãŸã®ã‚¢ãƒ—ãƒªã‚’æƒ³åƒã—ã¦ã€å¤–éƒ¨I/Oã‚’10å€‹ãã‚‰ã„æ›¸ã„ã¦ã¿ã¦ã­âœï¸âœ¨
ä¾‹ï¼šå¤–éƒ¨APIã€ç”»åƒCDNã€æ±ºæ¸ˆã€ãƒ­ã‚°é€ä¿¡ã€DBã€ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜â€¦ãªã©

### ã‚¹ãƒ†ãƒƒãƒ—â‘ ï¼šå¤±æ•—ä¾‹ã‚’åˆ—æŒ™ã™ã‚‹ğŸ“‹

* ä¾‹ï¼‰ã€Œå¤–éƒ¨APIãŒ503ã€
* ä¾‹ï¼‰ã€ŒDNSå¼•ã‘ãªã„ã€
* ä¾‹ï¼‰ã€Œ429ã§å¼¾ã‹ã‚ŒãŸã€
* ä¾‹ï¼‰ã€Œè¨¼æ˜æ›¸ã‚¨ãƒ©ãƒ¼ã€

### ã‚¹ãƒ†ãƒƒãƒ—â‘¡ï¼šãƒªãƒˆãƒ©ã‚¤OK/NGã‚’æ±ºã‚ã‚‹âœ…âŒ

æ±ºã‚ã‚‹ã¨ãã®è¦³ç‚¹ã¯ã“ã®2ã¤ã ã‚ˆğŸ™‚

1. **ä¸€æ™‚çš„ï¼Ÿæ’ä¹…çš„ï¼Ÿ** ğŸ”ğŸ§±
2. **åŒã˜æ“ä½œã‚’ã‚‚ã†ä¸€å›ã‚„ã£ã¦å®‰å…¨ï¼Ÿï¼ˆå†ªç­‰ï¼Ÿï¼‰** ğŸ§¨ğŸ›¡ï¸ ([RFCã‚¨ãƒ‡ã‚£ã‚¿][1])

### ã‚¹ãƒ†ãƒƒãƒ—â‘¢ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®è¦‹ã›æ–¹ã‚‚1è¡Œæ·»ãˆã‚‹ğŸ’¬

* ã€Œå†è©¦è¡Œãƒœã‚¿ãƒ³ã‚’å‡ºã™ã€ğŸ”
* ã€Œè‡ªå‹•ã§1å›ã ã‘å†è©¦è¡Œã€ğŸ¤–
* ã€Œå•ã„åˆã‚ã›å°ç·šã€ğŸ“©

---

## 12) AIæ´»ç”¨ï¼ˆã“ã®ç« ã§ã‚ã£ã¡ã‚ƒåŠ¹ãã‚„ã¤ğŸ¤–ğŸ’–ï¼‰

### âœ… å¤±æ•—ã®æ´—ã„å‡ºã—ï¼ˆæ¼ã‚Œé˜²æ­¢ï¼‰

* ã€Œã“ã®æ©Ÿèƒ½ã®å¤–éƒ¨ä¾å­˜ã‚’åˆ—æŒ™ã—ã¦ã€èµ·ãã†ã‚‹ã‚¤ãƒ³ãƒ•ãƒ©å¤±æ•—ã‚’20å€‹å‡ºã—ã¦ã€ğŸ¤–ğŸ§¾

### âœ… ãƒªãƒˆãƒ©ã‚¤è¡¨ã®ä¸‹æ›¸ã

* ã€Œæ¬¡ã®å¤±æ•—ã‚’ â€œä¸€æ™‚çš„/æ’ä¹…çš„â€ ã«åˆ†é¡ã—ã¦ã€ãƒªãƒˆãƒ©ã‚¤å¯å¦ã‚‚ææ¡ˆã—ã¦ï¼šâ€¦ã€ğŸ”âœ…âŒ

### âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼æ–‡è¨€ã®çµ±ä¸€

* ã€Œå¥³å­å¤§ç”Ÿå‘ã‘ã«ã€å®‰å¿ƒã•ã›ã‚‹æ„Ÿã˜ã§â€œå†è©¦è¡Œâ€ã®æ–‡è¨€ã‚’5æ¡ˆã¡ã‚‡ã†ã ã„ã€ğŸ«¶ğŸ’¬âœ¨

### âœ… å®Ÿè£…ã®å©ãå°

* ã€Œfetchã®å¤±æ•—ã‚’ network/http/rate_limit/timeout ã«åˆ†é¡ã—ã¦æˆ»ã™TSé–¢æ•°ã‚’æ›¸ã„ã¦ã€ğŸ§©ğŸ› ï¸

---

## ã¾ã¨ã‚ï¼ˆã“ã®ç« ã®ã‚´ãƒ¼ãƒ«ï¼‰ğŸ¯âœ¨

* ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ©ãƒ¼ã¯ **â€œè½ã¡ã‚‹å‰æâ€** ã§è¨­è¨ˆã™ã‚‹ğŸŒ©ï¸ğŸ”Œ
* ã¾ãšã¯ **ä¸€æ™‚çš„/æ’ä¹…çš„** ã®2åˆ†é¡ãŒè¶…å¤§äº‹ğŸ”ğŸ§±
* ãƒªãƒˆãƒ©ã‚¤ã¯ **å†ªç­‰æ€§ï¼ˆå®‰å…¨ã«ç¹°ã‚Šè¿”ã›ã‚‹ã‹ï¼‰** ã¨ã‚»ãƒƒãƒˆã§è€ƒãˆã‚‹ğŸ§  ([RFCã‚¨ãƒ‡ã‚£ã‚¿][1])
* `fetch` ã¯ **HTTPã‚¨ãƒ©ãƒ¼ã§ã¯rejectã—ãªã„** ã®ã§ `res.ok` ã‚’å¿…ãšè¦‹ã‚‹ğŸ‘€ ([MDN Web Docs][2])
* ãƒªãƒˆãƒ©ã‚¤ã¯ **ãƒãƒƒã‚¯ã‚ªãƒ•ï¼‹ã‚¸ãƒƒã‚¿ãƒ¼** ã§å®‰å…¨ã«ğŸ”ğŸ² ([Amazon Web Services, Inc.][7])
* 429ã¯ `Retry-After` ã‚’å°Šé‡â±ï¸ğŸ™ ([MDN Web Docs][6])

---

æ¬¡ã®ç« ï¼ˆç¬¬12ç« ï¼‰ã§ã¯ã€ã€Œã“ã“ã«æ¥ãŸã‚‰ãŠã‹ã—ã„âš¡ï¼ˆãƒã‚°/ä¸å¤‰æ¡ä»¶é•åï¼‰ã€ã‚’**ã‚¤ãƒ³ãƒ•ãƒ©ã‚„ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨åˆ†é›¢**ã—ã¦ã€ã‚‚ã£ã¨è¨­è¨ˆãŒã‚¹ãƒƒã‚­ãƒªã™ã‚‹æ„Ÿã˜ã«é€²ã‚ã‚‹ã‚ˆã€œğŸ§±âœ¨

[1]: https://www.rfc-editor.org/rfc/rfc9110.html?utm_source=chatgpt.com "RFC 9110: HTTP Semantics"
[2]: https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch?utm_source=chatgpt.com "Using the Fetch API - MDN Web Docs"
[3]: https://developer.mozilla.org/ja/docs/Web/API/AbortSignal/timeout_static?utm_source=chatgpt.com "AbortSignal: timeout() é™çš„ãƒ¡ã‚½ãƒƒãƒ‰ - Web API | MDN"
[4]: https://nodejs.org/api/globals.html "Global objects | Node.js v25.3.0 Documentation"
[5]: https://docs.cloud.google.com/storage/docs/retry-strategy?utm_source=chatgpt.com "Retry strategy | Cloud Storage"
[6]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Retry-After?utm_source=chatgpt.com "Retry-After header - HTTP - MDN Web Docs"
[7]: https://aws.amazon.com/builders-library/timeouts-retries-and-backoff-with-jitter/?utm_source=chatgpt.com "Timeouts, retries and backoff with jitter"
